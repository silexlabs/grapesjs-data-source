{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@silexlabs/grapesjs-data-source/webpack/universalModuleDefinition","webpack://@silexlabs/grapesjs-data-source/./node_modules/dedent-js/lib/index.js","webpack://@silexlabs/grapesjs-data-source/webpack/bootstrap","webpack://@silexlabs/grapesjs-data-source/webpack/runtime/compat get default export","webpack://@silexlabs/grapesjs-data-source/webpack/runtime/define property getters","webpack://@silexlabs/grapesjs-data-source/webpack/runtime/hasOwnProperty shorthand","webpack://@silexlabs/grapesjs-data-source/webpack/runtime/make namespace object","webpack://@silexlabs/grapesjs-data-source/./src/types.ts","webpack://@silexlabs/grapesjs-data-source/./src/model/state.ts","webpack://@silexlabs/grapesjs-data-source/./node_modules/@lit/reactive-element/css-tag.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/@lit/reactive-element/reactive-element.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-html/lit-html.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-element/lit-element.js","webpack://@silexlabs/grapesjs-data-source/./src/model/token.ts","webpack://@silexlabs/grapesjs-data-source/./src/datasources/graphql-introspection-query.ts","webpack://@silexlabs/grapesjs-data-source/./src/datasources/GraphQL.ts","webpack://@silexlabs/grapesjs-data-source/./src/model/dataSourceRegistry.ts","webpack://@silexlabs/grapesjs-data-source/./src/utils.ts","webpack://@silexlabs/grapesjs-data-source/./src/model/DataTree.ts","webpack://@silexlabs/grapesjs-data-source/./src/filters/liquid.ts","webpack://@silexlabs/grapesjs-data-source/./src/model/queryBuilder.ts","webpack://@silexlabs/grapesjs-data-source/./src/model/previewDataLoader.ts","webpack://@silexlabs/grapesjs-data-source/./src/model/dataSourceManager.ts","webpack://@silexlabs/grapesjs-data-source/./src/commands.ts","webpack://@silexlabs/grapesjs-data-source/./src/storage.ts","webpack://@silexlabs/grapesjs-data-source/./src/view/defaultStyles.ts","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-html/directive-helpers.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-html/directive.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-html/async-directive.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-html/directives/ref.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-html/directives/repeat.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/@lit/reactive-element/decorators/custom-element.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/@lit/reactive-element/decorators/property.js","webpack://@silexlabs/grapesjs-data-source/./src/view/settings.ts","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-html/directives/class-map.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/@silexlabs/expression-input/dist/styles.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/@silexlabs/expression-input/dist/input-chain.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/@silexlabs/expression-input/dist/expression-input.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/@silexlabs/expression-input/dist/popin-overlay.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/@silexlabs/expression-input/dist/popin-form.js","webpack://@silexlabs/grapesjs-data-source/./node_modules/lit-html/directives/style-map.js","webpack://@silexlabs/grapesjs-data-source/./src/model/completion.ts","webpack://@silexlabs/grapesjs-data-source/./src/view/state-editor.ts","webpack://@silexlabs/grapesjs-data-source/./src/view/properties-editor.ts","webpack://@silexlabs/grapesjs-data-source/./src/view/custom-states-editor.ts","webpack://@silexlabs/grapesjs-data-source/./src/view/canvas.ts","webpack://@silexlabs/grapesjs-data-source/./src/view/index.ts","webpack://@silexlabs/grapesjs-data-source/./src/api.ts","webpack://@silexlabs/grapesjs-data-source/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@silexlabs/grapesjs-data-source\"] = factory();\n\telse\n\t\troot[\"@silexlabs/grapesjs-data-source\"] = factory();\n})(typeof globalThis !== 'undefined' ? globalThis : (typeof window !== 'undefined' ? window : this), () => {\nreturn ","module.exports = function dedent(templateStrings) {\r\n    var values = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        values[_i - 1] = arguments[_i];\r\n    }\r\n    var matches = [];\r\n    var strings = typeof templateStrings === 'string' ? [templateStrings] : templateStrings.slice();\r\n    // 1. Remove trailing whitespace.\r\n    strings[strings.length - 1] = strings[strings.length - 1].replace(/\\r?\\n([\\t ]*)$/, '');\r\n    // 2. Find all line breaks to determine the highest common indentation level.\r\n    for (var i = 0; i < strings.length; i++) {\r\n        var match = void 0;\r\n        if (match = strings[i].match(/\\n[\\t ]+/g)) {\r\n            matches.push.apply(matches, match);\r\n        }\r\n    }\r\n    // 3. Remove the common indentation from all strings.\r\n    if (matches.length) {\r\n        var size = Math.min.apply(Math, matches.map(function (value) { return value.length - 1; }));\r\n        var pattern = new RegExp(\"\\n[\\t ]{\" + size + \"}\", 'g');\r\n        for (var i = 0; i < strings.length; i++) {\r\n            strings[i] = strings[i].replace(pattern, '\\n');\r\n        }\r\n    }\r\n    // 4. Remove leading whitespace.\r\n    strings[0] = strings[0].replace(/^\\r?\\n/, '');\r\n    // 5. Perform interpolation.\r\n    var string = strings[0];\r\n    for (var i = 0; i < values.length; i++) {\r\n        string += values[i] + strings[i + 1];\r\n    }\r\n    return string;\r\n};\r\n//# sourceMappingURL=index.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Component } from 'grapesjs'\nimport { TemplateResult } from 'lit'\nimport { Button } from 'grapesjs'\n\n\nexport interface DataSourceEditorViewOptions {\n  el?: HTMLElement | string | undefined | (() => HTMLElement)\n  settingsEl?: HTMLElement | string | (() => HTMLElement)\n  button?: Button | (() => Button)\n  styles?: string\n  optionsStyles?: string\n  defaultFixed?: boolean\n  disableStates?: boolean\n  disableAttributes?: boolean\n  disableProperties?: boolean\n  previewDebounceDelay?: number,\n  previewRefreshEvents?: string, // used in tests\n}\n\n/**\n * Options for the DataSourceEditor plugin\n */\nexport interface DataSourceEditorOptions {\n  dataSources: IDataSourceOptions[],\n  view: DataSourceEditorViewOptions,\n  filters: Filter[] | string,\n  previewActive: boolean,\n}\n\n// Queries\nexport type PageId = string // GrapesJs page id type\nexport interface Query {\n  expression: Expression\n}\n\n/**\n * Tree structure for creating query from components states\n */\nexport interface Tree {\n  token: Property\n  children: Tree[]\n}\n\n// Data sources must implement this interface\nexport type DataSourceId = string | number\nexport interface IDataSource {\n  // For reference in expressions\n  id: DataSourceId\n\n  // Basic properties\n  label: string\n  url: string\n  type: DataSourceType\n  method?: string\n  headers?: Record<string, string>\n\n  // Hide from users settings\n  hidden?: boolean\n  readonly?: boolean\n\n  // Initialization\n  connect(): Promise<void>\n  isConnected(): boolean\n\n  // Introspection\n  getTypes(): Type[]\n  getQueryables(): Field[]\n  getQuery(trees: Tree[]): string\n\n  // Access data\n  fetchValues(query: string): Promise<unknown>\n\n  // Event handling\n  on?(event: any, callback?: any, context?: any): any\n  off?(event?: any, callback?: any, context?: any): any\n  trigger?(event: any, ...args: unknown[]): any\n}\nexport const DATA_SOURCE_READY = 'data-source:ready'\nexport const DATA_SOURCE_ERROR = 'data-source:error'\nexport const DATA_SOURCE_CHANGED = 'data-source:changed'\nexport const COMPONENT_STATE_CHANGED = 'component:state:changed'\nexport const DATA_SOURCE_DATA_LOAD_START = 'data-source:data-load:start'\nexport const DATA_SOURCE_DATA_LOAD_END = 'data-source:data-load:end'\nexport const DATA_SOURCE_DATA_LOAD_CANCEL= 'data-source:data-load:cancel'\n\nexport const PREVIEW_RENDER_START = 'data-source:start:preview'\nexport const PREVIEW_RENDER_END = 'data-source:start:end'\nexport const PREVIEW_RENDER_ERROR = 'data-source:start:error'\n\nexport const COMMAND_REFRESH = 'data-source:refresh'\nexport const COMMAND_PREVIEW_ACTIVATE = 'data-source:preview:activate'\nexport const COMMAND_PREVIEW_DEACTIVATE = 'data-source:preview:deactivate'\nexport const COMMAND_PREVIEW_REFRESH = 'data-source:preview:refresh'\n\nexport type DataSourceType = 'graphql'\n\n// Options of a data source\nexport interface IDataSourceOptions {\n  id: DataSourceId\n  label: string\n  type: DataSourceType\n  readonly?: boolean\n}\n\n// Types\nexport type TypeId = string\nexport type Type = {\n  id: TypeId\n  label: string\n  fields: Field[]\n  dataSourceId?: DataSourceId // Not required for builtin types\n}\n\n// From https://graphql.org/graphql-js/basic-types/\nexport const builtinTypeIds = ['String', 'Int', 'Float', 'Boolean', 'ID', 'Unknown']\nexport const builtinTypes: Type[] = builtinTypeIds.map(id => ({\n  id,\n  label: id,\n  fields: [],\n}))\n\n// Fileds\nexport type FieldId = string\nexport type FieldKind = 'scalar' | 'object' | 'list' | 'unknown'\nexport interface FieldArgument {\n  name: string\n  typeId: TypeId\n  defaultValue?: unknown\n}\nexport interface Field {\n  id: FieldId\n  label: string\n  typeIds: TypeId[]\n  kind: FieldKind\n  dataSourceId?: DataSourceId\n  arguments?: FieldArgument[]\n  previewIndex?: number\n}\n\n// **\n// Data tree\n/**\n * A token can be a property or a filter\n */\nexport type Token = Property | Filter | State\n\n/**\n * Stored tokens are how the tokens are stored in the component as JSON\n * Use DataTree#fromStored to convert them back to tokens\n */\nexport type StoredToken = StoredProperty | StoredFilter | State\nexport type Options = Record<string, unknown>\n\n/**\n * A property is used to make expressions and access data from the data source\n */\nexport interface BaseProperty {\n  type: 'property'\n  propType: /*'type' |*/ 'field'\n  dataSourceId?: DataSourceId\n}\n\nexport type PropertyOptions = Record<string, unknown>\nexport interface StoredProperty extends BaseProperty {\n  typeIds: TypeId[]\n  fieldId: FieldId\n  label: string\n  kind: FieldKind\n  options?: PropertyOptions\n  previewIndex?: number\n}\nexport interface Property extends StoredProperty {\n  optionsForm?: (selected: Component, input: Field | null, options: Options, stateName: string) => TemplateResult | null\n}\n\n/**\n * A filter is used to alter data in an expression\n * It is provided in the options\n */\nexport type FilterId = string\nexport interface StoredFilter {\n  type: 'filter'\n  id: FilterId\n  filterName?: FilterId // Override the id for the filter name if present\n  label: string\n  options: Options\n  quotedOptions?: string[]\n  optionsKeys?: string[] // Optional, used to set a specific order\n  previewIndex?: number\n}\nexport interface Filter extends StoredFilter {\n  optionsForm?: (selected: Component, input: Field | null, options: Options, stateName: string) => TemplateResult | null\n  validate: (input: Field | null) => boolean\n  output: (input: Field | null, options: Options) => Field | null\n  apply: (input: unknown, options: Options) => unknown\n}\n\n/**\n * A component state\n */\nexport type StateId = string\nexport interface State {\n  type: 'state'\n  storedStateId: StateId // Id of the state stored in the component\n  previewIndex?: number\n  label: string\n  componentId: string\n  exposed: boolean\n  forceKind?: FieldKind\n}\n\n///**\n// * A fixed value\n// */\n//export interface Fixed extends Step {\n//  type: 'fixed'\n//  options: {\n//    value: string\n//    inpuType: FixedType\n//  }\n//}\n\n/**\n * A context is a list of available tokens for a component\n */\nexport type Context = Token[]\n\n\n/**\n * An expression is a list of tokens which can be evaluated to a value\n * It is used to access data from the data source\n */\nexport type Expression = StoredToken[]\n\n/**\n * Operators for condition in visibility property\n */\nexport enum UnariOperator {\n  TRUTHY = 'truthy',\n  FALSY = 'falsy',\n  EMPTY_ARR = 'empty array',\n  NOT_EMPTY_ARR = 'not empty array',\n}\n\n/**\n * Operators for condition in visibility property\n */\nexport enum BinariOperator {\n  EQUAL = '==',\n  NOT_EQUAL = '!=',\n  GREATER_THAN = '>',\n  LESS_THAN = '<',\n  GREATER_THAN_OR_EQUAL = '>=',\n  LESS_THAN_OR_EQUAL = '<=',\n}\n\n/**\n * Properties of elements\n * What is not a property is an attribute or a state\n */\nexport enum Properties {\n  innerHTML = 'innerHTML',\n  condition = 'condition',\n  condition2 = 'condition2',\n  __data = '__data',\n}\n\nexport interface ComponentExpression {\n  expression: Expression\n  component: Component\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Component, Editor } from 'grapesjs'\nimport { Expression, StateId, State } from '../types'\n\n/**\n * @fileoverview This file contains the model for components states\n * A state is a value which can be used in expressions\n * If exported it will be available in the context of child components\n */\n\n// Keys to store the states in the component\nconst EXPORTED_STATES_KEY = 'publicStates'\nconst PRIVATE_STATES_KEY = 'privateStates'\n\n/**\n * Persistant ID is used to identify a component reliably\n * It will be stored with the website data\n */\nconst PERSISTANT_ID_KEY = 'id-plugin-data-source'\n\n/**\n * Override the prefix of state names\n */\nexport const COMPONENT_NAME_PREFIX = 'nameForDataSource'\n\n/**\n * Types\n */\nexport interface StoredState {\n  label?: string\n  hidden?: boolean\n  expression: Expression\n}\n\nexport interface StoredStateWithId extends StoredState {\n  id: StateId\n}\n\nexport type PersistantId = string\n\n/**\n * Get the persistant ID of a component\n */\nexport function getPersistantId(component: Component): PersistantId | null {\n  return component.get(PERSISTANT_ID_KEY) ?? null\n}\n\n/**\n * Get the persistant ID of a component and create it if it does not exist\n */\nexport function getOrCreatePersistantId(component: Component): PersistantId {\n  const persistantId = component.get(PERSISTANT_ID_KEY)\n  if(persistantId) return persistantId\n  const newPersistantId = `${component.ccid}-${Math.round(Math.random() * 10000)}` as PersistantId\n  component.set(PERSISTANT_ID_KEY, newPersistantId)\n  return newPersistantId\n}\n\n/**\n * Find a component by its persistant ID in the current page\n */\nexport function getComponentByPersistentId(id: PersistantId, editor: Editor): Component | null {\n  const pages = editor.Pages.getAll()\n  for(const page of pages) {\n    const body = page.getMainComponent()\n    const component = getChildByPersistantId(id, body)\n    if(component) return component\n  }\n  return null\n}\n\n/**\n * Find a component by its persistant ID in\n */\nexport function getChildByPersistantId(id: PersistantId, parent: Component): Component | null {\n  if(getPersistantId(parent) === id) return parent\n  for(const child of parent.components()) {\n    const component = getChildByPersistantId(id, child)\n    if(component) return component\n  }\n  return null\n}\n\n/**\n * Find a component by its persistant ID in the current page\n */\nexport function getParentByPersistentId(id: PersistantId, component: Component | undefined): Component | null {\n  if(!component) return null\n  if(getPersistantId(component) === id) return component\n  return getParentByPersistentId(id, component.parent())\n}\n\n/**\n * Get the display name of a state\n */\nexport function getStateDisplayName(child: Component, state: State): string {\n  const component = getParentByPersistentId(state.componentId, child)\n  //const name = component?.getName() ?? '[Not found]'\n  const prefix = component?.get(COMPONENT_NAME_PREFIX) ?? '' // `${name}'s`\n  return  `${prefix ? prefix + ' ' : ''}${state.label || state.storedStateId}`\n}\n\n/**\n * Callbacks called when a state is changed\n * @returns A function to remove the callback\n */\nconst _callbacks: ((state: StoredState | null, component: Component) => void)[] = []\nexport function onStateChange(callback: (state: StoredState | null, component: Component) => void): () => void {\n  _callbacks.push(callback)\n  return () => {\n    const index = _callbacks.indexOf(callback)\n    if(index >= 0) _callbacks.splice(index, 1)\n  }\n}\nfunction fireChange(state: StoredState | null, component: Component) {\n  _callbacks.forEach(callback => callback(state, component))\n}\n\n/**\n * List all exported states\n */\nexport function getStateIds(component: Component, exported: boolean = true, before?: StateId): StateId[] {\n  try {\n    const states = component.get(exported ? EXPORTED_STATES_KEY : PRIVATE_STATES_KEY) as StoredStateWithId[] ?? []\n    const allStates = states\n      .sort(a => a.hidden ? -1 : 0) // Hidden states first\n      .map(state => state.id)\n    if(before) {\n      const index = allStates.indexOf(before)\n      if(index < 0) return allStates\n      return allStates.slice(0, index)\n    }\n    return allStates\n  } catch(e) {\n    // this happens when the old deprecated state system is used\n    console.error('Error while getting state ids', e)\n    return []\n  }\n}\n\n/**\n * List all exported states\n */\nexport function getStates(component: Component, exported: boolean = true): StoredState[] {\n  const states = component.get(exported ? EXPORTED_STATES_KEY : PRIVATE_STATES_KEY) as StoredStateWithId[] ?? []\n  return states.map(state => ({\n    label: state.label,\n    hidden: state.hidden,\n    expression: state.expression,\n  }))\n}\n\n/**\n * Get the name of a state variable\n * Useful to generate code\n */\nexport function getStateVariableName(componentId: string, stateId: StateId): string {\n  return `state_${ componentId }_${ stateId }`\n}\n\n/**\n * Get a state\n */\nexport function getState(component: Component, id: StateId, exported: boolean = true): StoredState | null {\n  const states = component.get(exported ? EXPORTED_STATES_KEY : PRIVATE_STATES_KEY) as StoredStateWithId[] ?? []\n  const state = states.find(state => state.id === id) ?? null\n  if(!state) {\n    return null\n  }\n  return {\n    label: state.label,\n    hidden: state.hidden,\n    expression: state.expression,\n  }\n}\n\n/**\n * Set a state\n * The state will be updated or created at the end of the list\n * Note: index is not used in this project anymore (maybe in apps using this plugins)\n */\nexport function setState(component: Component, id: StateId, state: StoredState, exported = true, index = -1): void {\n  const key = exported ? EXPORTED_STATES_KEY : PRIVATE_STATES_KEY\n  const states = component.get(key) as StoredStateWithId[] ?? []\n  const existing = states.find(s => s.id === id) ?? null\n  if(existing) {\n    component.set(key, states.map(s => s.id !== id ? s : {\n      id,\n      ...state,\n    }))\n  } else {\n    component.set(key, [\n      ...states,\n      {\n        id,\n        ...state,\n      }\n    ])\n  }\n  // Set the index if needed\n  if(index >= 0) {\n    const states = [...component.get(key) as StoredStateWithId[]]\n    const state = states.find(s => s.id === id)\n    if(state && index < states.length) {\n      states.splice(states.indexOf(state), 1)\n      states.splice(index, 0, state)\n      component.set(key, states)\n    }\n  }\n  // Notify the change\n  fireChange({\n    label: state.label,\n    hidden: state.hidden,\n    expression: state.expression,\n  }, component)\n}\n\n/**\n * Remove a state\n */\nexport function removeState(component: Component, id: StateId, exported: boolean = true): void {\n  const key = exported ? EXPORTED_STATES_KEY : PRIVATE_STATES_KEY\n  const states = component.get(key) as StoredStateWithId[] ?? []\n  const newStates = states.filter(s => s.id !== id)\n  component.set(key, newStates)\n  fireChange(null, component)\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,e=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&\"adoptedStyleSheets\"in Document.prototype&&\"replace\"in CSSStyleSheet.prototype,s=Symbol(),o=new WeakMap;class n{constructor(t,e,o){if(this._$cssResult$=!0,o!==s)throw Error(\"CSSResult is not constructable. Use `unsafeCSS` or `css` instead.\");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const s=this.t;if(e&&void 0===t){const e=void 0!==s&&1===s.length;e&&(t=o.get(s)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),e&&o.set(s,t))}return t}toString(){return this.cssText}}const r=t=>new n(\"string\"==typeof t?t:t+\"\",void 0,s),i=(t,...e)=>{const o=1===t.length?t[0]:e.reduce(((e,s,o)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if(\"number\"==typeof t)return t;throw Error(\"Value passed to 'css' function must be a 'css' function result: \"+t+\". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.\")})(s)+t[o+1]),t[0]);return new n(o,t,s)},S=(s,o)=>{if(e)s.adoptedStyleSheets=o.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const e of o){const o=document.createElement(\"style\"),n=t.litNonce;void 0!==n&&o.setAttribute(\"nonce\",n),o.textContent=e.cssText,s.appendChild(o)}},c=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e=\"\";for(const s of t.cssRules)e+=s.cssText;return r(e)})(t):t;export{n as CSSResult,S as adoptStyles,i as css,c as getCompatibleStyle,e as supportsAdoptingStyleSheets,r as unsafeCSS};\n//# sourceMappingURL=css-tag.js.map\n","import{getCompatibleStyle as t,adoptStyles as s}from\"./css-tag.js\";export{CSSResult,css,supportsAdoptingStyleSheets,unsafeCSS}from\"./css-tag.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{is:i,defineProperty:e,getOwnPropertyDescriptor:h,getOwnPropertyNames:r,getOwnPropertySymbols:o,getPrototypeOf:n}=Object,a=globalThis,c=a.trustedTypes,l=c?c.emptyScript:\"\",p=a.reactiveElementPolyfillSupport,d=(t,s)=>t,u={toAttribute(t,s){switch(s){case Boolean:t=t?l:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,s){let i=t;switch(s){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},f=(t,s)=>!i(t,s),b={attribute:!0,type:String,converter:u,reflect:!1,useDefault:!1,hasChanged:f};Symbol.metadata??=Symbol(\"metadata\"),a.litPropertyMetadata??=new WeakMap;class y extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,s=b){if(s.state&&(s.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((s=Object.create(s)).wrapped=!0),this.elementProperties.set(t,s),!s.noAccessor){const i=Symbol(),h=this.getPropertyDescriptor(t,i,s);void 0!==h&&e(this.prototype,t,h)}}static getPropertyDescriptor(t,s,i){const{get:e,set:r}=h(this.prototype,t)??{get(){return this[s]},set(t){this[s]=t}};return{get:e,set(s){const h=e?.call(this);r?.call(this,s),this.requestUpdate(t,h,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??b}static _$Ei(){if(this.hasOwnProperty(d(\"elementProperties\")))return;const t=n(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(d(\"finalized\")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d(\"properties\"))){const t=this.properties,s=[...r(t),...o(t)];for(const i of s)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const s=litPropertyMetadata.get(t);if(void 0!==s)for(const[t,i]of s)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,s]of this.elementProperties){const i=this._$Eu(t,s);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const i=[];if(Array.isArray(s)){const e=new Set(s.flat(1/0).reverse());for(const s of e)i.unshift(t(s))}else void 0!==s&&i.push(t(s));return i}static _$Eu(t,s){const i=s.attribute;return!1===i?void 0:\"string\"==typeof i?i:\"string\"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,s=this.constructor.elementProperties;for(const i of s.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return s(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,s,i){this._$AK(t,i)}_$ET(t,s){const i=this.constructor.elementProperties.get(t),e=this.constructor._$Eu(t,i);if(void 0!==e&&!0===i.reflect){const h=(void 0!==i.converter?.toAttribute?i.converter:u).toAttribute(s,i.type);this._$Em=t,null==h?this.removeAttribute(e):this.setAttribute(e,h),this._$Em=null}}_$AK(t,s){const i=this.constructor,e=i._$Eh.get(t);if(void 0!==e&&this._$Em!==e){const t=i.getPropertyOptions(e),h=\"function\"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:u;this._$Em=e,this[e]=h.fromAttribute(s,t.type)??this._$Ej?.get(e)??null,this._$Em=null}}requestUpdate(t,s,i){if(void 0!==t){const e=this.constructor,h=this[t];if(i??=e.getPropertyOptions(t),!((i.hasChanged??f)(h,s)||i.useDefault&&i.reflect&&h===this._$Ej?.get(t)&&!this.hasAttribute(e._$Eu(t,i))))return;this.C(t,s,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,s,{useDefault:i,reflect:e,wrapped:h},r){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,r??s??this[t]),!0!==h||void 0!==r)||(this._$AL.has(t)||(this.hasUpdated||i||(s=void 0),this._$AL.set(t,s)),!0===e&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,s]of this._$Ep)this[t]=s;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[s,i]of t){const{wrapped:t}=i,e=this[s];!0!==t||this._$AL.has(s)||void 0===e||this.C(s,void 0,i,e)}}let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),this._$EO?.forEach((t=>t.hostUpdate?.())),this.update(s)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(s)}willUpdate(t){}_$AE(t){this._$EO?.forEach((t=>t.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((t=>this._$ET(t,this[t]))),this._$EM()}updated(t){}firstUpdated(t){}}y.elementStyles=[],y.shadowRootOptions={mode:\"open\"},y[d(\"elementProperties\")]=new Map,y[d(\"finalized\")]=new Map,p?.({ReactiveElement:y}),(a.reactiveElementVersions??=[]).push(\"2.1.0\");export{y as ReactiveElement,s as adoptStyles,u as defaultConverter,t as getCompatibleStyle,f as notEqual};\n//# sourceMappingURL=reactive-element.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,i=t.trustedTypes,s=i?i.createPolicy(\"lit-html\",{createHTML:t=>t}):void 0,e=\"$lit$\",h=`lit$${Math.random().toFixed(9).slice(2)}$`,o=\"?\"+h,n=`<${o}>`,r=document,l=()=>r.createComment(\"\"),c=t=>null===t||\"object\"!=typeof t&&\"function\"!=typeof t,a=Array.isArray,u=t=>a(t)||\"function\"==typeof t?.[Symbol.iterator],d=\"[ \\t\\n\\f\\r]\",f=/<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))/g,v=/-->/g,_=/>/g,m=RegExp(`>|${d}(?:([^\\\\s\"'>=/]+)(${d}*=${d}*(?:[^ \\t\\n\\f\\r\"'\\`<>=]|(\"|')|))|$)`,\"g\"),p=/'/g,g=/\"/g,$=/^(?:script|style|textarea|title)$/i,y=t=>(i,...s)=>({_$litType$:t,strings:i,values:s}),x=y(1),b=y(2),w=y(3),T=Symbol.for(\"lit-noChange\"),E=Symbol.for(\"lit-nothing\"),A=new WeakMap,C=r.createTreeWalker(r,129);function P(t,i){if(!a(t)||!t.hasOwnProperty(\"raw\"))throw Error(\"invalid template strings array\");return void 0!==s?s.createHTML(i):i}const V=(t,i)=>{const s=t.length-1,o=[];let r,l=2===i?\"<svg>\":3===i?\"<math>\":\"\",c=f;for(let i=0;i<s;i++){const s=t[i];let a,u,d=-1,y=0;for(;y<s.length&&(c.lastIndex=y,u=c.exec(s),null!==u);)y=c.lastIndex,c===f?\"!--\"===u[1]?c=v:void 0!==u[1]?c=_:void 0!==u[2]?($.test(u[2])&&(r=RegExp(\"</\"+u[2],\"g\")),c=m):void 0!==u[3]&&(c=m):c===m?\">\"===u[0]?(c=r??f,d=-1):void 0===u[1]?d=-2:(d=c.lastIndex-u[2].length,a=u[1],c=void 0===u[3]?m:'\"'===u[3]?g:p):c===g||c===p?c=m:c===v||c===_?c=f:(c=m,r=void 0);const x=c===m&&t[i+1].startsWith(\"/>\")?\" \":\"\";l+=c===f?s+n:d>=0?(o.push(a),s.slice(0,d)+e+s.slice(d)+h+x):s+h+(-2===d?i:x)}return[P(t,l+(t[s]||\"<?>\")+(2===i?\"</svg>\":3===i?\"</math>\":\"\")),o]};class N{constructor({strings:t,_$litType$:s},n){let r;this.parts=[];let c=0,a=0;const u=t.length-1,d=this.parts,[f,v]=V(t,s);if(this.el=N.createElement(f,n),C.currentNode=this.el.content,2===s||3===s){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(r=C.nextNode())&&d.length<u;){if(1===r.nodeType){if(r.hasAttributes())for(const t of r.getAttributeNames())if(t.endsWith(e)){const i=v[a++],s=r.getAttribute(t).split(h),e=/([.?@])?(.*)/.exec(i);d.push({type:1,index:c,name:e[2],strings:s,ctor:\".\"===e[1]?H:\"?\"===e[1]?I:\"@\"===e[1]?L:k}),r.removeAttribute(t)}else t.startsWith(h)&&(d.push({type:6,index:c}),r.removeAttribute(t));if($.test(r.tagName)){const t=r.textContent.split(h),s=t.length-1;if(s>0){r.textContent=i?i.emptyScript:\"\";for(let i=0;i<s;i++)r.append(t[i],l()),C.nextNode(),d.push({type:2,index:++c});r.append(t[s],l())}}}else if(8===r.nodeType)if(r.data===o)d.push({type:2,index:c});else{let t=-1;for(;-1!==(t=r.data.indexOf(h,t+1));)d.push({type:7,index:c}),t+=h.length-1}c++}}static createElement(t,i){const s=r.createElement(\"template\");return s.innerHTML=t,s}}function S(t,i,s=t,e){if(i===T)return i;let h=void 0!==e?s._$Co?.[e]:s._$Cl;const o=c(i)?void 0:i._$litDirective$;return h?.constructor!==o&&(h?._$AO?.(!1),void 0===o?h=void 0:(h=new o(t),h._$AT(t,s,e)),void 0!==e?(s._$Co??=[])[e]=h:s._$Cl=h),void 0!==h&&(i=S(t,h._$AS(t,i.values),h,e)),i}class M{constructor(t,i){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:i},parts:s}=this._$AD,e=(t?.creationScope??r).importNode(i,!0);C.currentNode=e;let h=C.nextNode(),o=0,n=0,l=s[0];for(;void 0!==l;){if(o===l.index){let i;2===l.type?i=new R(h,h.nextSibling,this,t):1===l.type?i=new l.ctor(h,l.name,l.strings,this,t):6===l.type&&(i=new z(h,this,t)),this._$AV.push(i),l=s[++n]}o!==l?.index&&(h=C.nextNode(),o++)}return C.currentNode=r,e}p(t){let i=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(t,s,i),i+=s.strings.length-2):s._$AI(t[i])),i++}}class R{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,i,s,e){this.type=2,this._$AH=E,this._$AN=void 0,this._$AA=t,this._$AB=i,this._$AM=s,this.options=e,this._$Cv=e?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const i=this._$AM;return void 0!==i&&11===t?.nodeType&&(t=i.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,i=this){t=S(this,t,i),c(t)?t===E||null==t||\"\"===t?(this._$AH!==E&&this._$AR(),this._$AH=E):t!==this._$AH&&t!==T&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):u(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==E&&c(this._$AH)?this._$AA.nextSibling.data=t:this.T(r.createTextNode(t)),this._$AH=t}$(t){const{values:i,_$litType$:s}=t,e=\"number\"==typeof s?this._$AC(t):(void 0===s.el&&(s.el=N.createElement(P(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===e)this._$AH.p(i);else{const t=new M(e,this),s=t.u(this.options);t.p(i),this.T(s),this._$AH=t}}_$AC(t){let i=A.get(t.strings);return void 0===i&&A.set(t.strings,i=new N(t)),i}k(t){a(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let s,e=0;for(const h of t)e===i.length?i.push(s=new R(this.O(l()),this.O(l()),this,this.options)):s=i[e],s._$AI(h),e++;e<i.length&&(this._$AR(s&&s._$AB.nextSibling,e),i.length=e)}_$AR(t=this._$AA.nextSibling,i){for(this._$AP?.(!1,!0,i);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class k{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,i,s,e,h){this.type=1,this._$AH=E,this._$AN=void 0,this.element=t,this.name=i,this._$AM=e,this.options=h,s.length>2||\"\"!==s[0]||\"\"!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=E}_$AI(t,i=this,s,e){const h=this.strings;let o=!1;if(void 0===h)t=S(this,t,i,0),o=!c(t)||t!==this._$AH&&t!==T,o&&(this._$AH=t);else{const e=t;let n,r;for(t=h[0],n=0;n<h.length-1;n++)r=S(this,e[s+n],i,n),r===T&&(r=this._$AH[n]),o||=!c(r)||r!==this._$AH[n],r===E?t=E:t!==E&&(t+=(r??\"\")+h[n+1]),this._$AH[n]=r}o&&!e&&this.j(t)}j(t){t===E?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??\"\")}}class H extends k{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===E?void 0:t}}class I extends k{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==E)}}class L extends k{constructor(t,i,s,e,h){super(t,i,s,e,h),this.type=5}_$AI(t,i=this){if((t=S(this,t,i,0)??E)===T)return;const s=this._$AH,e=t===E&&s!==E||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,h=t!==E&&(s===E||e);e&&this.element.removeEventListener(this.name,this,s),h&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){\"function\"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class z{constructor(t,i,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=i,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){S(this,t)}}const Z={M:e,P:h,A:o,C:1,L:V,R:M,D:u,V:S,I:R,H:k,N:I,U:L,B:H,F:z},j=t.litHtmlPolyfillSupport;j?.(N,R),(t.litHtmlVersions??=[]).push(\"3.3.0\");const B=(t,i,s)=>{const e=s?.renderBefore??i;let h=e._$litPart$;if(void 0===h){const t=s?.renderBefore??null;e._$litPart$=h=new R(i.insertBefore(l(),t),t,void 0,s??{})}return h._$AI(t),h};export{Z as _$LH,x as html,w as mathml,T as noChange,E as nothing,B as render,b as svg};\n//# sourceMappingURL=lit-html.js.map\n","import{ReactiveElement as t}from\"@lit/reactive-element\";export*from\"@lit/reactive-element\";import{render as e,noChange as r}from\"lit-html\";export*from\"lit-html\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const s=globalThis;class i extends t{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=e(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return r}}i._$litElement$=!0,i[\"finalized\"]=!0,s.litElementHydrateSupport?.({LitElement:i});const o=s.litElementPolyfillSupport;o?.({LitElement:i});const n={_$AK:(t,e,r)=>{t._$AK(e,r)},_$AL:t=>t._$AL};(s.litElementVersions??=[]).push(\"4.2.0\");export{i as LitElement,n as _$LE};\n//# sourceMappingURL=lit-element.js.map\n","import { Component } from 'grapesjs'\nimport { Expression, Field, FieldArgument, Filter, Options, Property, PropertyOptions, StoredToken, Token, Type, TypeId } from '../types'\nimport { DataTree } from './DataTree'\nimport { getParentByPersistentId, getState } from './state'\nimport { TemplateResult, html } from 'lit'\n\n/**\n * Add missing methonds to the filter\n * When filters are stored they lose their methods\n * @throws Error if the filter is not found\n */\nexport function getFilterFromToken(token: Filter, filters: Filter[]): Filter {\n  if(token.type !== 'filter') throw new Error('Token is not a filter')\n  const filter = filters.find(filter => filter.id === token.id)\n  if (!filter) {\n    console.error('Filter not found', token)\n    throw new Error(`Filter ${token.id} not found`)\n  }\n  return {\n    ...token,\n    ...filter,\n    // Keep the options as they are stored\n    options: token.options,\n  }\n}\n\n/**\n * Get the token from its stored form\n * @throws Error if the token type is not found\n */\nexport function fromStored<T extends Token = Token>(token: StoredToken, dataTree: DataTree, componentId: string | null): T {\n  switch (token.type) {\n  case 'filter': {\n    if ((token as Filter).optionsForm) return token as T\n    const original = dataTree.filters.find(filter => filter.id === token.id) as T | undefined\n    if (!original) {\n      console.error('Filter not found', token)\n      throw new Error(`Filter ${token.id} not found`)\n    }\n    return {\n      ...original,\n      ...token,\n    } as T\n  }\n  case 'property': {\n    if ((token as Property).optionsForm) return token as T\n    const field = propertyToField(token, dataTree, componentId)\n    if (!field) {\n      console.error('Field not found for token', token)\n      throw new Error(`Field ${token.fieldId} not found`)\n    }\n    return {\n      ...getTokenOptions(field) ?? {},\n      ...token,\n    } as T\n  }\n  case 'state':\n    return token as T\n  default:\n    console.error('Unknown token type (reading type)', token)\n    throw new Error('Unknown token type')\n  }\n}\n\n/**\n * Get the type corresponding to a token\n */\nexport function tokenToField(token: Token, prev: Field | null, component: Component, dataTree: DataTree): Field | null {\n  switch (token.type) {\n  case 'filter': {\n    try {\n      const filter = getFilterFromToken(token, dataTree.filters)\n      try {\n        if (filter.validate(prev)) {\n          return filter.output(prev, filter.options ?? {})\n        }\n      } catch (e) {\n        console.warn('Filter validate error:', e, {token, prev})\n        return null\n      }\n      return null\n    } catch {\n      // FIXME: notify user\n      console.error('Error while getting filter result type', {token, prev, component, dataTree})\n      return null\n    }\n  }\n  case 'property':\n    try {\n      return propertyToField(token, dataTree, component.getId())\n    } catch {\n      // FIXME: notify user\n      console.error('Error while getting property result type', {token, component, dataTree})\n      return null\n    }\n  case 'state': {\n    const parent = getParentByPersistentId(token.componentId, component)\n    if (!parent) {\n      console.warn('Component not found for state', token)\n      // TODO: notification\n      return null\n    }\n    const expression = getState(parent, token.storedStateId, token.exposed)?.expression\n    if (!expression) {\n      console.warn('State is not defined on component', { component: parent, token })\n      // TODO: notification\n      return null\n    }\n    try {\n      const field = getExpressionResultType(expression, parent, dataTree)\n      return field ? {\n        ...field,\n        kind: token.forceKind ?? field.kind,\n      } : null\n    } catch {\n      // FIXME: notify user\n      console.error('Error while getting expression result type in tokenToField', {expression, parent, dataTree, component, token, prev})\n      return null\n    }\n  }\n  default:\n    console.error('Unknown token type (reading type)', token)\n    throw new Error('Unknown token type')\n  }\n}\n\n/**\n * Get the type corresponding to a property\n * @throws Error if the type is not found\n */\nexport function propertyToField(property: Property, dataTree: DataTree, componentId: string | null): Field {\n  const typeNames = property.typeIds\n    .map((typeId: TypeId) => dataTree.getType(typeId, property.dataSourceId ?? null, componentId))\n    .map((type: Type | null) => type?.label)\n\n  const args = property.options ? Object.entries(property.options).map(([name, value]) => ({\n    typeId: 'JSON', // FIXME: Why is this hardcoded?\n    name,\n    defaultValue: value, // FIXME: Why is this value, it should keep the inital default\n  })) : undefined\n  return {\n    id: property.fieldId,\n    label: typeNames.join(', '),\n    typeIds: property.typeIds,\n    kind: property.kind,\n    dataSourceId: property.dataSourceId,\n    arguments: args,\n    previewIndex: property.previewIndex,\n  }\n}\n\n/**\n * Evaluate the types of each token in an expression\n */\nexport function expressionToFields(expression: Expression, component: Component, dataTree: DataTree): Field[] {\n  // Resolve type of the expression 1 step at a time\n  let prev: Field | null = null\n  const unknownField: Field = {\n    id: 'unknown',\n    label: 'unknown',\n    typeIds: [],\n    kind: 'scalar',\n  }\n  return expression.map((token) => {\n    try {\n      const field = tokenToField(fromStored(token, dataTree, component.getId()), prev, component, dataTree)\n      if (!field) {\n        console.warn('Type not found for token in expressionToFields', { token, expression })\n        return unknownField\n      }\n      prev = field\n      return field\n    } catch {\n      // FIXME: notify user\n      console.error('Error while getting expression result type in expressionToFields', {expression, component, dataTree, token, prev})\n      return unknownField\n    }\n  })\n}\n\n/**\n * Evaluate an expression to a type\n * This is used to validate expressions and for autocompletion\n * @throws Error if the token type is not found\n */\nexport function getExpressionResultType(expression: Expression, component: Component, dataTree: DataTree): Field | null {\n  // Resolve type of the expression 1 step at a time\n  return expression.reduce((prev: Field | null, token: StoredToken) => {\n    return tokenToField(fromStored(token, dataTree, component.getId()), prev, component, dataTree)\n  }, null)\n}\n\n/**\n * Get the options of a token\n */\nexport function getTokenOptions(field: Field): { optionsForm: (selected: Component, input: Field | null, options: Options) => TemplateResult, options: Options } | null {\n  if (field.arguments && field.arguments.length > 0) {\n    return {\n      optionsForm: optionsToOptionsForm(field.arguments.map((arg) => ({ name: arg.name, value: arg.defaultValue }))),\n      options: field.arguments.reduce((options: Record<string, unknown>, arg: FieldArgument) => {\n        options[arg.name] = arg.defaultValue\n        return options\n      }, {}),\n    }\n  }\n  return null\n}\n\n/**\n * Get the options of a token or a field\n */\nexport function optionsToOptionsForm(arr: { name: string, value: unknown }[]): (selected: Component, input: Field | null, options: Options) => TemplateResult {\n  return (selected: Component, input: Field | null, options: Options) => {\n    return html`\n              ${arr.map((obj) => {\n    const value = options[obj.name] ?? obj.value ?? ''\n    return html`<label>${obj.name}</label><input type=\"text\" name=${obj.name} .value=${value}>`\n  })\n}\n          `\n  }\n}\n\n/**\n * Utility function to shallow compare two objects\n * Used to compare options of tree items\n */\nexport function getOptionObject(option1: PropertyOptions | undefined, option2: PropertyOptions | undefined): { error: boolean, result: PropertyOptions | undefined } {\n  // Handle the case where one or both are undefined or empty\n  if(!option1 && !option2) return { error: false, result: undefined }\n  if(isEmpty(option1) && isEmpty(option2)) return { error: false, result: undefined }\n  // Handle the case where one is undefined or empty and the other is not\n  if(!option1 || !option2) return { error: true, result: undefined }\n  if(isEmpty(option1) || isEmpty(option2)) return { error: true, result: undefined }\n\n  const keys1 = Object.keys(option1)\n  const keys2 = Object.keys(option2)\n\n  if (keys1.length !== keys2.length) {\n    return { error: true, result: undefined }\n  }\n\n  for (const key of keys1) {\n    if (option1[key] !== option2[key]) {\n      return { error: true, result: undefined }\n    }\n  }\n\n  return { error: false, result: option1 }\n}\n\nfunction isJson(str: string) {\n  if(typeof str !== 'string') return false\n  if(str.length === 0) return false\n  try {\n    JSON.parse(str)\n  } catch {\n    return false\n  }\n  return true\n}\n\nfunction isEmpty(value: unknown): boolean {\n  if(value === null || typeof value === 'undefined') return true\n  const isString = typeof value === 'string'\n  const isJsonString = isString && isJson(value)\n  if (isString && !isJsonString) return value === ''\n  const json = isJsonString ? JSON.parse(value) : value\n  if (Array.isArray(json)) return json.length === 0\n  if (typeof json === 'object') return Object.values(json).filter(v => !!v).length === 0\n  return false\n}\n\nexport function buildArgs(options: PropertyOptions | undefined): string {\n  const args = options ? `(${Object\n    .keys(options)\n    .map(key => ({ key, value: options![key] }))\n    .filter(({ value }) => !isEmpty(value))\n    .map(({ key, value }) => {\n      //return typeof value === 'string' && !isJson(value) ? `${key}: \"${value}\"` : `${key}: ${value}`\n      return `${key}: ${value}`\n    })\n    .join(', ')\n  })` : ''\n  // Valid args for GraphQL canot be just ()\n  const validArgs = args === '()' ? '' : args\n  return validArgs\n}\n","export default `\n  query IntrospectionQuery {\n    __schema {\n      queryType {\n        name\n      }\n      types {\n        ...FullType\n      }\n    }\n  }\n  fragment FullType on __Type {\n    kind\n    name\n    description\n    fields(includeDeprecated: true) {\n      name\n      description\n      args {\n        ...InputValue\n      }\n      type {\n        ...TypeRef\n      }\n      isDeprecated\n      deprecationReason\n    }\n    inputFields {\n      ...InputValue\n    }\n    interfaces {\n      ...TypeRef\n    }\n    enumValues(includeDeprecated: true) {\n      name\n      description\n      isDeprecated\n      deprecationReason\n    }\n    possibleTypes {\n      ...TypeRef\n    }\n  }\n  fragment InputValue on __InputValue {\n    name\n    description\n    type {\n      ...TypeRef\n    }\n    defaultValue\n  }\n  fragment TypeRef on __Type {\n    kind\n    name\n    possibleTypes {\n      kind\n      name\n    }\n    ofType {\n      kind\n      name\n      possibleTypes {\n        kind\n        name\n      }\n      ofType {\n        kind\n        name\n        possibleTypes {\n          kind\n          name\n        }\n        ofType {\n          kind\n          name\n          possibleTypes {\n            kind\n            name\n          }\n          ofType {\n            kind\n            name\n            possibleTypes {\n              kind\n              name\n            }\n            ofType {\n              kind\n              name\n              possibleTypes {\n                kind\n                name\n              }\n              ofType {\n                kind\n                name\n                possibleTypes {\n                  kind\n                  name\n                }\n                ofType {\n                  kind\n                  name\n                  possibleTypes {\n                    kind\n                    name\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n`","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { IDataSourceOptions, Type, Field, Tree, TypeId, IDataSource, DATA_SOURCE_ERROR, builtinTypeIds, builtinTypes, FieldKind, DATA_SOURCE_READY, DATA_SOURCE_CHANGED } from '../types'\nimport graphqlIntrospectionQuery from './graphql-introspection-query'\nimport dedent from 'dedent-js'\nimport { FIXED_TOKEN_ID } from '../utils'\nimport { buildArgs } from '../model/token'\n\n/**\n * @fileoverview GraphQL DataSource implementation\n */\n\n/**\n * GraphQL Data source options\n */\ninterface GraphQLQueryOptions {\n  url: string\n  headers: Record<string, string>\n  method: 'GET' | 'POST'\n  queryable?: TypeId[]\n  readonly?: boolean\n}\n\n/**\n * GraphQL Data source options with server to server options\n */\nexport interface GraphQLOptions extends GraphQLQueryOptions, IDataSourceOptions {\n  serverToServer?: GraphQLQueryOptions\n  hidden?: boolean\n}\n\n// GraphQL specific types\n// Exported for unit tests\nexport type GQLKind = 'SCALAR' | 'OBJECT' | 'LIST' | 'NON_NULL' | 'UNION'\n\nexport interface GQLOfType {\n  name?: string,\n  kind: GQLKind,\n  ofType?: GQLOfType,\n  possibleTypes?: {name: string, kind: GQLKind}[],\n}\nexport interface GQLField {\n  name: string,\n  type: GQLOfType,\n  args?: {\n    name: string,\n    type: GQLOfType,\n    defaultValue?: string,\n  }[],\n}\nexport interface GQLType {\n  name: string,\n  fields: GQLField[],\n}\n\n/**\n * GraphQL DataSource implementation\n * Simple JS object that implements IDataSource interface\n */\nexport default class GraphQL implements IDataSource {\n  id: string\n  label: string\n  url: string\n  type = 'graphql' as const\n  method: 'GET' | 'POST' = 'POST'\n  headers: Record<string, string> = {}\n  queryable?: TypeId[]\n  readonly?: boolean\n  hidden?: boolean\n\n  protected types: Type[] = []\n  protected queryables: Field[] = []\n  protected queryType: string = ''\n  protected ready = false\n  private eventListeners: Record<string, ((...args: unknown[]) => void)[]> = {}\n\n  constructor(options: GraphQLOptions) {\n    this.id = options.id.toString()\n    this.label = options.label\n    this.url = options.url\n    this.type = options.type\n    this.method = options.method || 'POST'\n    this.headers = options.headers || {}\n    this.queryable = options.queryable\n    this.readonly = options.readonly\n    this.hidden = options.hidden\n  }\n\n  // Simple event handling\n  on(event: string, callback: (...args: unknown[]) => void): void {\n    if (!this.eventListeners[event]) {\n      this.eventListeners[event] = []\n    }\n    this.eventListeners[event].push(callback)\n  }\n\n  off(event: string, callback?: (...args: unknown[]) => void): void {\n    if (!this.eventListeners[event]) return\n    if (callback) {\n      this.eventListeners[event] = this.eventListeners[event].filter(cb => cb !== callback)\n    } else {\n      this.eventListeners[event] = []\n    }\n  }\n\n  trigger(event: string, ...args: unknown[]): void {\n    if (!this.eventListeners[event]) return\n    this.eventListeners[event].forEach(callback => callback(...args))\n  }\n\n  /**\n   * @throws Error\n   */\n  protected triggerError<T>(message: string): T {\n    console.error('GraphQL error:', message)\n    this.trigger(DATA_SOURCE_ERROR, message, this)\n    throw new Error(message)\n  }\n  protected async loadData(): Promise<[Type[], Field[], string]> {\n    try {\n      const result = await this.call(graphqlIntrospectionQuery) as {data: {__schema: {types: GQLType[], queryType: {name: string}}}}\n      if (!result.data?.__schema?.types) return this.triggerError(`Invalid response: ${JSON.stringify(result)}`)\n      const allTypes = result.data.__schema.types.map((type: GQLType) => type.name)\n        .concat(builtinTypeIds)\n\n      const queryType: string = result.data.__schema.queryType?.name\n      if(!queryType) return this.triggerError(`Invalid response, queryType not found: ${JSON.stringify(result)}`)\n\n      const query: GQLType | undefined = result.data.__schema.types.find((type: GQLType) => type.name === queryType)\n      if(!query) return this.triggerError(`Invalid response, query not found: ${JSON.stringify(result)}`)\n\n      // Get non-queryable types\n      const nonQueryables = result.data.__schema.types\n        // Filter out Query, Mutation, Subscription\n        //.filter((type: GQLType) => !['Query', 'Mutation', 'Subscription'].includes(type.name))\n        // Filter out introspection types\n        .filter((type: GQLType) => !type.name.startsWith('__'))\n        // Filter out types that are not in Query\n        //.map((type: GQLType) => query?.fields.find((field: GQLField) => field.name === type.name) ?? type)\n        // Filter out types that are in Query (the queryables are handled separately)\n        .filter((type: GQLType) => !query?.fields.find((field: GQLField) => field.name === type.name))\n\n        // Map to Type\n        .map((type: GQLType) => this.graphQLToType(allTypes, type, 'SCALAR', false))\n        // Add builtin types\n        .concat(builtinTypes)\n\n      if(!query) {\n        return this.triggerError('Query type not found in GraphQL schema')\n      }\n\n      // Get queryable types\n      const queryableTypes = query.fields\n        // Map to GQLType, keeping kind for later\n        .map((field: GQLField) => ({\n          type: {\n            ...result.data.__schema.types.find((type: GQLType) => type.name === this.getOfTypeProp<string>('name', field.type, field.name)),\n            name: field.name,\n          } as GQLType,\n          kind: this.ofKindToKind(field.type),\n        }))\n        // Map to Type\n        .map(({type, kind}) => this.graphQLToType(allTypes, type, kind, true))\n\n      // Get all queryables as fields\n      const queryableFields = query.fields\n        // Map to Field\n        .map((field: GQLField) => this.graphQLToField(field))\n\n      // Return all types, queryables and non-queryables\n      return [queryableTypes.concat(nonQueryables), queryableFields, queryType]\n    } catch (e) {\n      return this.triggerError(`GraphQL introspection failed: ${(e as Error).message}`)\n    }\n  }\n  protected graphQLToField(field: GQLField): Field {\n    const kind = this.ofKindToKind(field.type)\n    return {\n      id: field.name,\n      dataSourceId: this.id,\n      label: field.name,\n      typeIds: this.graphQLToTypes(field),\n      kind: kind ? this.graphQLToKind(kind) : 'unknown',\n      arguments: field.args?.map(arg => ({\n        name: arg.name,\n        typeId: this.getOfTypeProp<string>('name', arg.type, arg.name),\n        defaultValue: arg.defaultValue,\n      })),\n    }\n  }\n\n  /**\n   * Recursively search for a property on a GraphQL type\n   * Check the deepest values in ofType first\n   */\n  protected getOfTypeProp<T>(prop: string, type: GQLOfType, defaultValue?: T): T {\n    const result = this.getOfTypePropRecursive<T>(prop, type)\n    if(result) return result\n    if(defaultValue) return defaultValue\n    throw new Error(`Type ${JSON.stringify(type)} has no property ${prop} and no default was provided`)\n  }\n\n  protected getOfTypePropRecursive<T>(prop: string, type: GQLOfType): T | undefined {\n    if(!type) {\n      console.error('Invalid type', type)\n      throw new Error('Invalid type')\n    }\n    if(type.ofType) {\n      const ofTypeResult = this.getOfTypePropRecursive<T>(prop, type.ofType)\n      if(ofTypeResult) return ofTypeResult\n    }\n    return type[prop as keyof GQLOfType] as T\n  }\n\n  /**\n   * Recursively search for a property on a GraphQL type\n   * Handles Union types with possibleTypes\n   * Handles list and object and non-null types with ofType\n   */\n  protected graphQLToTypes(field: GQLField): TypeId[] {\n    const possibleTypes = this.getOfTypeProp<{name: string, kind: GQLKind}[]>('possibleTypes', field.type, [])\n    if(possibleTypes.length > 0) return possibleTypes.map(type => type.name)\n    return [this.getOfTypeProp<string>('name', field.type, field.name)]\n  }\n\n  /**\n   * Convert GraphQL kind to FieldKind\n   * @throws Error if kind is not valid or is NON_NULL\n   */\n  protected graphQLToKind(kind: GQLKind): FieldKind {\n    switch(kind) {\n    case 'LIST': return 'list'\n    case 'OBJECT': return 'object'\n    case 'SCALAR': return 'scalar'\n    case 'UNION':\n    case 'NON_NULL':\n    default:\n      throw new Error(`Unable to find a valid kind for ${kind}`)\n    }\n  }\n\n  /**\n   * Check if a GraphQL kind has a valid FieldKind equivalent\n   */\n  protected validKind(kind: GQLKind): boolean {\n    return ['LIST', 'OBJECT', 'SCALAR'].includes(kind)\n  }\n\n  /**\n   * Recursively search for a GraphQL kind of type list, object or scalar\n   */\n  protected ofKindToKind(ofKind: GQLOfType): GQLKind | null {\n    if(ofKind.possibleTypes) {\n      const foundKind = ofKind.possibleTypes\n        .reduce((prev: GQLKind | null, type: {kind: GQLKind, name: string}) => {\n          if(!prev) return type.kind as GQLKind\n          if(prev !== type.kind) {\n            throw new Error(`Unable to find a valid kind for ${ofKind.kind}. Union types with different kind is not supported`)\n          }\n          return prev as GQLKind\n        }, null)\n      if(!foundKind) {\n        console.error('Unable to find a valid kind (1)', ofKind)\n        return null\n      }\n      return foundKind\n    }\n    if(this.validKind(ofKind.kind)) return ofKind.kind\n    if(ofKind.ofType) return this.ofKindToKind(ofKind.ofType)\n    // This happens when the type is missing\n    // Remove the warning because it happens with directus and polutes the logs\n    // console.error('Unable to find a valid kind (2)', ofKind)\n    return null\n  }\n\n  /**\n   * Convert a GraphQL type to a Type\n   */\n  protected graphQLToType(allTypes: TypeId[], type: GQLType, kind: GQLKind | null, queryable: boolean): Type {\n    const queryableOverride = this.queryable\n    const result = {\n      id: type.name,\n      dataSourceId: this.id,\n      label: type.name,\n      fields: type.fields\n        // Do not include fields that are not in the schema\n        // FIXME: somehow this happens with fields of type datetime_functions for directus\n        //?.filter((field: {name: string, type: any}) => allTypes.includes(field.name))\n        ?.filter((field) => allTypes.includes(this.getOfTypeProp<string>('name', field.type, field.name)))\n        ?.map(field => this.graphQLToField(field))\n        ?? [],\n      queryable: queryable && (!queryableOverride || queryableOverride!.includes(type.name)),\n    }\n    return result\n  }\n\n  /**\n   * Connect to the GraphQL endpoint and load the schema\n   * This has to be implemented as it is a DataSource method\n   */\n  async connect(): Promise<void> {\n    try {\n      // const result = await this.call(`\n      //     query {\n      //       __typename\n      //     }\n      //   `) as any\n      // if (!result?.data?.__typename) return this.triggerError(`Invalid response: ${JSON.stringify(result)}`)\n      const [types, fields, queryType] = await this.loadData()\n      if(types.length === 0) return this.triggerError('No types found in GraphQL schema')\n      if(fields.length === 0) return this.triggerError('No fields found in GraphQL schema')\n      if(!queryType) return this.triggerError('No query type found in GraphQL schema')\n      this.types = types\n      this.queryables = fields\n      this.queryType = queryType\n      if (this.ready) {\n        this.trigger(DATA_SOURCE_CHANGED, this)\n      } else {\n        this.ready = true\n        this.trigger(DATA_SOURCE_READY, this)\n      }\n    } catch (e) {\n      return this.triggerError(`GraphQL connection failed: ${(e as Error).message}`)\n    }\n  }\n\n  /**\n   * Check if the DataSource is ready\n   * This has to be implemented as it is a DataSource method\n   */\n  isConnected(): boolean {\n    return this.ready\n  }\n\n  /**\n   * Get all types\n   * This has to be implemented as it is a DataSource method\n   */\n  getTypes(): Type[] {\n    if (!this.ready) {\n      console.error('DataSource is not ready. Attempted to get types before ready status was achieved.')\n      throw new Error('DataSource is not ready. Ensure it is connected and ready before querying.')\n    }\n\n    if (this.types.length === 0) {\n      console.error('No types available. It seems the data source may not be connected or the schema is incomplete.', this.ready)\n      throw new Error('No types found. The data source may not be connected or there might be an issue with the schema.')\n    }\n    return this.types\n  }\n\n  /**\n   * Get all queryable fields\n   * This has to be implemented as it is a DataSource method\n   */\n  getQueryables(): Field[] {\n    return this.queryables\n  }\n\n  /**\n   * Call the GraphQL endpoint\n   */\n  protected async call(query: string): Promise<unknown> {\n    // Retrieve the URL for the GraphQL endpoint\n    const url = this.url\n    if (!url) return this.triggerError('Missing GraphQL URL') // Ensure the URL is provided\n\n    // Retrieve the headers for the GraphQL request\n    const headers = this.headers\n    if (!headers) return this.triggerError('Missing GraphQL headers') // Ensure headers are provided\n\n    // Ensure the Content-Type header is set to 'application/json', normalizing the case\n    const key = Object.keys(headers).find(name => name.toLowerCase() === 'content-type')\n    headers[key || 'Content-Type'] = headers[key || 'Content-Type'] || 'application/json'\n\n    // Retrieve the HTTP method (defaulting to 'POST' for GraphQL queries)\n    const method = this.method ?? 'POST'\n\n    // Make the HTTP request to the GraphQL endpoint\n    const response = await fetch(url, {\n      method,\n      headers,\n      // Include a body only for POST requests\n      ...(method === 'POST' ? {\n        body: JSON.stringify({ query }),\n      } : {}),\n    })\n\n    // Handle non-OK responses with detailed error logging\n    if (!response?.ok) {\n      console.error('GraphQL call failed', response?.status, response?.statusText, query)\n      return this.triggerError(`GraphQL call failed with \\`${response?.statusText}\\` and status ${response?.status}`)\n    }\n\n    // Return the parsed JSON response\n    return response.json()\n  }\n\n  /**\n   * Build a GraphQL query from a tree\n   */\n  getQuery(children: Tree[]): string {\n    return this.getQueryRecursive({\n      // Add the main query object which is the root of the tree\n      token: {\n        dataSourceId: this.id,\n        fieldId: 'query',\n        kind: 'object',\n        typeIds: [this.queryType],\n      },\n      children,\n    } as Tree)\n  }\n\n  protected getQueryRecursive(tree: Tree, indent = '', fragment = ''): string {\n    // Check if the tree is a fragment\n    const typeOrFragment = fragment ? `...on ${fragment}` : `${tree.token.fieldId}${buildArgs(tree.token.options)}`\n\n    // Build the value\n    switch(tree.token.kind) {\n    case 'scalar':\n      if(tree.token.fieldId === FIXED_TOKEN_ID) return ''\n      return indent + typeOrFragment\n    case 'object':\n    case 'list': {\n      const types = this.getTypes().filter(t => tree.token.typeIds?.includes(t.id))\n      if(types.length === 0) {\n        throw new Error(`Type not found for ${tree.token.fieldId} (${tree.token.typeIds})`)\n      } else if(types.length > 1) throw new Error(`Multiple types found for ${tree.token.fieldId}`)\n      const type = types[0] as Type\n      const fieldTypes = tree.children\n        .map(child => {\n          const fieldType = type.fields.find(f => f.id === child.token.fieldId)\n          if(!fieldType) {\n            // Not a queryable type\n            return null\n          }\n          return {\n            fieldType,\n            child,\n          }\n        })\n          // Remove non-queryable types\n        .filter(fieldType => fieldType !== null) as {fieldType: Field, child: Tree}[]\n\n      // Handle fragments\n      const fragments = fieldTypes\n        .filter(({fieldType}) => fieldType.typeIds.length > 1)\n        .map(({child}) => {\n          return {\n            query: this.getQueryRecursive(child, indent + '  ', child.token.typeIds[0]),\n            child,\n          }\n        })\n\n      const fragmentsQuery = fragments\n        .map(({query, child}) => dedent`\n            ${indent}${child.token.fieldId} {\n              ${query}\n            }\n          `)\n        .join('\\n')\n\n      // Handle simple case, no fragment\n      const childQuery = fieldTypes\n        .filter(({fieldType}) => fieldType.typeIds.length === 1)\n        .map(({child}) => {\n          return this.getQueryRecursive(child, indent + '  ')\n        })\n        .join('\\n')\n\n      return dedent`${indent}${typeOrFragment} {\n        ${indent}  __typename\n        ${childQuery}\n        ${fragmentsQuery}\n        ${indent}}`\n    }\n    default:\n      console.error('Unable to build GraphQL query', tree)\n      throw new Error(`Unable to build GraphQL query: unable to build tree ${JSON.stringify(tree)}`)\n    }\n  }\n\n  async fetchValues(query: string): Promise<unknown[]> {\n    const result = await this.call(query) as { data: unknown[] }\n    return result.data\n  }\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { DataSourceId, IDataSource, DATA_SOURCE_CHANGED } from '../types'\nimport { Editor } from 'grapesjs'\n\n/**\n * Data source registry state\n */\ninterface DataSourceRegistryState {\n  dataSources: IDataSource[]\n  editor: Editor\n}\n\n// Global registry instance\nlet globalRegistry: DataSourceRegistryState | null = null\n\n/**\n * Initialize the data source registry\n */\nexport function initializeDataSourceRegistry(editor: Editor): void {\n  globalRegistry = {\n    dataSources: [],\n    editor\n  }\n}\n\n/**\n * Get the global registry (throws if not initialized)\n */\nfunction getRegistry(): DataSourceRegistryState {\n  if (!globalRegistry) {\n    throw new Error('DataSourceRegistry not initialized. Call initializeDataSourceRegistry first.')\n  }\n  return globalRegistry\n}\n\n/**\n * Get all data sources\n */\nexport function getAllDataSources(): IDataSource[] {\n  return [...getRegistry().dataSources]\n}\n\n/**\n * Add a data source\n */\nexport function addDataSource(dataSource: IDataSource): void {\n  const registry = getRegistry()\n  registry.dataSources.push(dataSource)\n  registry.editor.trigger(DATA_SOURCE_CHANGED)\n}\n\n/**\n * Remove a data source\n */\nexport function removeDataSource(dataSource: IDataSource): void {\n  const registry = getRegistry()\n  const index = registry.dataSources.indexOf(dataSource)\n  if (index > -1) {\n    registry.dataSources.splice(index, 1)\n    registry.editor.trigger(DATA_SOURCE_CHANGED)\n  }\n}\n\n/**\n * Get a data source by ID\n */\nexport function getDataSource(id: DataSourceId): IDataSource | undefined {\n  return getRegistry().dataSources.find(ds => ds.id === id)\n}\n\n/**\n * Set all data sources (replaces existing)\n */\nexport function setDataSources(dataSources: IDataSource[]): void {\n  const registry = getRegistry()\n  registry.dataSources = [...dataSources]\n  registry.editor.trigger(DATA_SOURCE_CHANGED)\n}\n\n/**\n * Convert to JSON for storage\n */\nexport function dataSourcesToJSON(): unknown[] {\n  return getRegistry().dataSources.map(ds => ({\n    id: ds.id,\n    label: ds.label,\n    url: ds.url,\n    type: ds.type,\n    method: ds.method,\n    headers: ds.headers,\n    readonly: ds.readonly,\n    hidden: ds.hidden\n  }))\n}\n","import { Expression, Field, FieldKind, IDataSource, Options, Token, TypeId } from './types'\nimport { Editor } from 'grapesjs'\nimport { getParentByPersistentId, getStateDisplayName } from './model/state'\nimport { TemplateResult, html } from 'lit'\nimport { Component } from 'grapesjs'\nimport { fromStored, getExpressionResultType } from './model/token'\nimport GraphQL, { GraphQLOptions } from './datasources/GraphQL'\nimport { getDataTree as getGlobalDataTree } from './model/dataSourceManager'\nimport { getDataSource } from './model/dataSourceRegistry'\n\nexport const NOTIFICATION_GROUP = 'Data source'\n\n/**\n * Get the DataTree instance using the global manager\n * Uses the new functional approach\n */\nexport function getDataTreeFromUtils(editor?: Editor) {\n  return getGlobalDataTree()\n}\n\n/**\n * Get the display name of a field\n */\nexport function cleanStateName(name: string | null) {\n  return name?.toLowerCase()\n    ?.replace(/[^a-z-1-9:]/g, '-')\n    ?.replace(/-+$/g, '') // do not end with -\n}\n\n/**\n * Get the display type of a field\n * For the dropdown in expressions\n * @example \"String\", \"String [ ]\", \"String { }\"\n */\nfunction getTypeDisplayName(typeIds: TypeId[], kind: FieldKind | null): string {\n  const typeIdsStr = typeIds.join(', ').toLowerCase()\n  return kind === 'list' ? ` (${typeIdsStr}[])` : kind === 'object' ? ` (${typeIdsStr}{})` : ` (${typeIdsStr})`\n}\n\nexport function getComponentDebug(component: Component): string {\n  const parent = component.parent()\n  const parentName = parent?.getName()\n  const parentTagName = parent?.get('tagName')\n  const parentDebug = parentName ? `${parentName} (${parentTagName})` : parentTagName\n  const id = component.cid\n  const tagName = component.get('tagName')\n  const classes = component.getClasses()\n  const classesStr = classes.length ? `.${classes.join('.')}` : ''\n  const name = component.getName()\n  return `${parentDebug} > ${name} (${tagName}#${id}${classesStr})`\n}\n\n/**\n * Concatenate strings to get a desired length string as result\n * Exported for tests\n */\nexport function concatWithLength(desiredNumChars: number, ...strings: string[]): string {\n  // const diff = desiredNumChars - `${token.label} ${type}`.length\n  // return `${token.label}${'\\xA0'.repeat(diff * 2)} ${type} ${desiredNumChars}`\n  // Get current string length\n  const len = strings.reduce((acc, str) => acc + str.length, 0)\n  const diff = Math.max(desiredNumChars - len, 0)\n  // Give the fist string the desired length\n  const [first, ...rest] = strings\n  const newFirst = first + '\\xA0'.repeat(diff)\n  // Return the concatenated string\n  return [newFirst, ...rest].join('')\n}\n\n/**\n * Get the label for a token\n * This is mostly about formatting a string for the dropdowns\n */\nexport function getTokenDisplayName(component: Component, token: Token): string {\n  switch (token.type) {\n  case 'property': {\n    const type = getTypeDisplayName(token.typeIds, token.kind)\n    return `${token.label} ${type}`\n  }\n  case 'filter': return token.label\n  case 'state':\n    return getStateDisplayName(component, token)\n  default:\n    console.error('Unknown token type (reading type)', token)\n    throw new Error('Unknown token type')\n  }\n}\n\n/**\n * Group tokens by type\n * This is used to create the groups in dropdowns\n */\nexport function groupByType(editor: Editor, component: Component, completion: Token[], expression: Expression): Record<string, Token[]> {\n  return completion\n    .reduce((acc, token) => {\n      let label\n      switch (token.type) {\n      case 'filter': label = 'Filters'; break\n      case 'property': {\n        if(token.dataSourceId) {\n          if(expression.length > 0) {\n            try {\n              const type = getExpressionResultType(expression, component, getDataTreeFromUtils(editor))\n              label = type?.label ?? type?.id ?? 'Unknown'\n            } catch(e) {\n              // FIXME: notify user\n              console.error('Error while getting expression result type in groupByType', {expression, component, dataTree: getDataTreeFromUtils(editor)})\n              label = 'Unknown'\n            }\n          } else {\n            const dataSource = getDataSource(token.dataSourceId)\n            if(dataSource) {\n              label = (dataSource as any).label || (dataSource as any).get?.('label') || token.dataSourceId\n            } else {\n              console.error('Data source not found', token.dataSourceId)\n              editor.runCommand('notifications:add', {\n                type: 'error',\n                group: NOTIFICATION_GROUP,\n                message: `Data source not found: ${token.dataSourceId}`,\n              })\n              throw new Error(`Data source not found: ${token.dataSourceId}`)\n            }\n          }\n        } else {\n          label = 'Fields'\n        }\n        break\n      }\n      case 'state': {\n        const parent = getParentByPersistentId(token.componentId, component)\n        const name = parent?.get('tagName') === 'body' ? 'Website' : parent?.getName()\n        label = name ? `${name}'s states` : 'States'\n        break\n      }\n      default:\n        console.error('Unknown token type (reading type)', token)\n        throw new Error('Unknown token type')\n      }\n      if (!acc[label]) acc[label] = []\n      acc[label].push(token)\n      return acc\n    }, {} as Record<string, Token[]>)\n}\n\n/**\n * Create a \"fixed\" token\n * It is a hard coded content with which you can start an expression\n */\nexport const FIXED_TOKEN_ID = 'fixed'\nexport function getFixedToken(value: string): Token {\n  return {\n    type: 'property',\n    propType: 'field',\n    fieldId: FIXED_TOKEN_ID,\n    label: 'Fixed value',\n    kind: 'scalar',\n    typeIds: ['String'],\n    options: {\n      value,\n    },\n    optionsForm: () => html`\n        <label>Value\n          <input type=\"text\" name=\"value\" .value=${value}>\n        </label>\n    `,\n  }\n}\n\n/**\n * Convert a token to a string\n * This is used to store the token in the component\n */\nexport function toValue(token: Token): string {\n  return JSON.stringify({\n    ...token,\n  })\n}\n\n/**\n * Convert a token to an option's tag value (json string)\n */\nexport function toId(token: Token): string {\n  switch (token.type) {\n  case 'property': return `property__${token.dataSourceId || ''}__${token.fieldId}__${token.kind}__${token.typeIds.join(',')}`\n  case 'filter': return `filter____${token.id}`\n  case 'state': return `state__${token.componentId}__${token.storedStateId}`\n  default:\n    console.error('Unknown token type (reading type)', token)\n    throw new Error('Unknown token type')\n  }\n}\n\n/**\n * Revert an option's tag value to a token\n * @throws Error if the token type is not found\n */\nexport function fromString(editor: Editor, id: string, componentId: string | null): Token {\n  return fromStored(JSON.parse(id), getDataTreeFromUtils(editor), componentId) as Token\n}\n\n/**\n * Check if a json is an expression, i.e. an array of tokens\n */\nexport function isExpression(json: unknown): boolean {\n  if(typeof json === 'string') throw new Error('json must be parsed')\n  if (!Array.isArray(json)) return false\n  return json.every(token => {\n    if (typeof token !== 'object') return false\n    if (!token.type) return false\n    switch (token.type) {\n    case 'property': {\n      if (!token.fieldId) return false\n      if (token.fieldId === FIXED_TOKEN_ID) {\n        if (!token.options?.value) return false\n      }\n      break\n    }\n    case 'state': {\n      if (!token.componentId) return false\n      if (!token.storedStateId) return false\n      break\n    }\n    case 'filter': {\n      if (!token.id) return false\n      break\n    }\n    }\n    return true\n  })\n}\n\n/**\n * Convert a json to an expression\n */\nexport function toExpression(json: unknown | string): Expression | null {\n  try {\n    if(typeof json === 'string') json = JSON.parse(json)\n    if(isExpression(json)) return json as Expression\n    return null\n  } catch(e) {\n    return null\n  }\n}\n\n/**\n * Apply a kind to a field\n */\nexport function convertKind(field: Field | null, from: FieldKind, to: FieldKind): Field | null {\n  if (!field) {\n    return null\n  }\n  if (field.kind !== from) {\n    console.error(`Field is not a ${from}`, field)\n    throw new Error(`Field ${field.label} is not a ${from}`)\n  }\n  return {\n    ...field,\n    kind: to,\n  }\n}\n\n/**\n * Get the type of a field, as provided by the data source\n * @throws Error if the field has a token with an unknown type\n */\nexport function getFieldType(editor: Editor, field: Field | null, key: string | undefined, componentId: string | null): Field | null {\n  const dataTree = getDataTreeFromUtils(editor)\n  if (!field || !key) return null\n  const types = field.typeIds.map(typeId => dataTree.getType(typeId, field.dataSourceId ?? null, componentId))\n  const fields = types.map(type => type?.fields.find(field => field.label === key))\n  switch (fields.length) {\n  case 0: return null\n  case 1: return fields[0]!\n  default: return {\n    id: `${field.id}.${key}`,\n    label: `${field.label}.${key}`,\n    typeIds: fields.reduce((typeIds, field) => typeIds\n    // Add typeIds of the field if not already present\n      .concat(field!.typeIds.filter(t => !typeIds.includes(t)))\n    , [] as string[]),\n    kind: 'object',\n    dataSourceId: field.dataSourceId,\n  }\n  }\n}\n\n/**\n * Generate a form to edit the options of a token\n * @throws Error if the field has a token with an unknown type\n */\nexport function optionsFormKeySelector(editor: Editor, field: Field | null, options: Options, name: string): TemplateResult {\n  const dataTree = getDataTreeFromUtils(editor)\n  if (!field) return html`\n      <label>${name}\n        <input type=\"text\" name=${name} />\n      </label>\n    `\n  return html`\n      <select name=${name}>\n        <option value=\"\">Select a ${name}</option>\n        ${field ? field.typeIds\n    .flatMap(typeId => dataTree.getType(typeId, field.dataSourceId ?? null, null)!.fields)\n    .map(f => html`<option value=${f.label} .selected=${f.label === options.key}>${f.label}</option>`)\n    : html``\n}\n      </select>\n    `\n}\n\n/**\n * Get a container element from an option\n * @throws Error if the option is not a string or an HTMLElement or a function\n * @throws Error if the element is not found\n */\nexport function getElementFromOption(option: HTMLElement | string | (() => HTMLElement) | undefined, optionNameForError: string): HTMLElement {\n  // Get the container element for the UI\n  if (typeof option === 'undefined') {\n    // This should never happen as we set a default value in /index.ts\n    throw new Error('el option must be set')\n  } else if (typeof option === 'string') {\n    const el = document.querySelector(option)\n    if (!el) throw new Error(`Element ${option} not found`)\n    return el as HTMLElement\n  } else if (typeof option === 'function') {\n    const el = option()\n    if (!el) throw new Error('el option must be a returned by the provided function')\n    return el\n  } else if (option instanceof HTMLElement) {\n    return option\n  }\n  throw new Error(`${optionNameForError} must be a string or an HTMLElement or a function`)\n}\n\nexport function getDefaultOptions(postFix = Math.random().toString(36).slice(2, 8)): GraphQLOptions {\n  return {\n    id: `ds-${postFix}`,\n    label: 'New data source',\n    type: 'graphql',\n    url: '',\n    method: 'POST',\n    headers: {},\n    readonly: false,\n  }\n}\n\nexport function createDataSource(opts: Partial<GraphQLOptions> = {}, postFix?: string): IDataSource {\n  const options = {\n    ...getDefaultOptions(postFix),\n    ...opts,\n  }\n  switch (options.type) {\n    case 'graphql':\n      return new GraphQL(options)\n    default:\n      throw new Error(`Unknown data source type: ${options.type}`)\n  }\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Component, Page, Editor } from 'grapesjs'\nimport { ComponentExpression, DATA_SOURCE_CHANGED, DATA_SOURCE_READY, DataSourceId, Expression, Field, Filter, IDataSource, Property, State, StoredToken, Tree, Type, TypeId } from '../types'\nimport { getState, getParentByPersistentId, getStates, getPersistantId } from './state'\nimport { fromStored, getOptionObject } from './token'\nimport { FIXED_TOKEN_ID, getComponentDebug, NOTIFICATION_GROUP, toExpression } from '../utils'\n\n/**\n * Options of the data tree\n * They can be set on the instance too\n */\nexport interface DataTreeOptions {\n  filters: Partial<Filter>[] | string\n  dataSources: IDataSource[]\n}\n\nexport const STANDARD_TYPES: Type[] = [\n  {\n    id: 'string',\n    label: 'String',\n    fields: [],\n  },\n  {\n    id: 'number',\n    label: 'Number',\n    fields: [],\n  },\n  {\n    id: 'boolean',\n    label: 'Boolean',\n    fields: [],\n  },\n  {\n    id: 'date',\n    label: 'Date',\n    fields: [],\n  },\n  {\n    id: 'unknown',\n    label: 'Unknown',\n    fields: [],\n  },\n]\n\n///**\n// * TODO\n// * Error thrown when a query cannot be built\n// */\n//export interface BuildQueryErrorOptions {\n//  expression: Expression\n//  component: Component\n//  token: Token\n//}\n//export class BuildQueryError extends Error {\n//  public expression: Expression\n//  public component: Component\n//  public token: Token\n//\n//  constructor(message: string, options: BuildQueryErrorOptions) {\n//    super(message)\n//    this.expression = options.expression\n//    this.component = options.component\n//    this.token = options.token\n//  }\n//}\n\nexport class DataTree {\n  public dataSources: IDataSource[] = []\n  // Preview data returned by all APIs (for canvas preview only)\n  public previewData: Record<DataSourceId, unknown> = {}\n  public filters: Filter[] = []\n\n  /**\n   * All types from all data sources\n   * Read only, updated when data sources are updated\n   */\n  protected _allTypes: Type[] = []\n  public get allTypes(): Type[] {\n    return this._allTypes\n  }\n\n  /**\n   * All queryable fields from all data sources\n   */\n  protected _queryables: Field[] = []\n  public get queryables(): Field[] {\n    return this._queryables\n  }\n\n  constructor(protected editor: Editor, protected options: {dataSources: IDataSource[], filters: Filter[]}) {\n    this.dataSources = options.dataSources\n    this.filters = options.filters\n\n    // Check that all filters have required fields\n    this.filters.forEach((filter: Filter) => {\n      if(!filter.id) throw new Error('Filter id is required')\n      if(!filter.label) throw new Error('Filter name is required')\n      if(!filter.validate) throw new Error('Filter validate is required')\n      if(!filter.output) throw new Error('Filter outputType is required')\n      if(!filter.apply) throw new Error('Filter apply is required')\n    })\n    editor.on(`${DATA_SOURCE_CHANGED} ${DATA_SOURCE_READY}`, () => {\n      this._allTypes = this.getAllTypes()\n      this._queryables = this.getAllQueryables()\n    })\n  }\n\n  /**\n   * Get type from typeId and dataSourceId\n   */\n  getTypes(dataSourceId?: DataSourceId): Type[] {\n    // Get the data source\n    const ds = this.dataSources\n      .find((dataSource: IDataSource) => dataSource.id === dataSourceId)\n    if(!ds) throw new Error(`Data source not found ${dataSourceId}`)\n    if(!ds.isConnected()) throw new Error(`Data source ${dataSourceId} is not ready (not connected)`)\n    return ds.getTypes()\n  }\n\n  /**\n   * Get type from typeId and dataSourceId\n   * @throws Error if type is not found\n   * @param componentId is used for error messages\n   */\n  getType(typeId: TypeId, dataSourceId: DataSourceId | null, componentId: string | null): Type {\n    if(dataSourceId) {\n      // Get the data source\n      const dataSource = this.dataSources\n        .find((dataSource: IDataSource) => !dataSourceId || dataSource.id === dataSourceId)\n      if(!dataSource) throw new Error(`Data source not found ${dataSourceId}`)\n      // Get its types\n      const types = dataSource?.getTypes()\n      // Return the requested type\n      const type = types.find((type: Type) => type.id === typeId)\n      if (!type) {\n        this.editor.runCommand('notifications:add', {\n          type: 'error',\n          group: NOTIFICATION_GROUP,\n          message: `Type not found ${dataSourceId ?? ''}.${typeId}`,\n          componentId,\n        })\n        throw new Error(`Type not found ${dataSourceId ?? ''}.${typeId}`)\n      }\n      return type\n    } else {\n      // No data source id: search in standard types\n      const standardType = STANDARD_TYPES.find(type => type.id === typeId.toLowerCase())\n      if(standardType) return standardType\n      // No data source id: search in all types\n      const type = this.allTypes.find(type => type.id === typeId)\n      if (!type) throw new Error(`Unknown type ${typeId}`)\n      return type\n    }\n  }\n\n  /**\n   * Get all types from all data sources\n   */\n  getAllTypes(): Type[] {\n    return this.dataSources\n      .filter((dataSource: IDataSource) => dataSource.isConnected())\n      .flatMap((dataSource: IDataSource) => {\n        return dataSource.getTypes()\n      })\n  }\n\n  /**\n   * Get all queryable fields from all data sources\n   */\n  getAllQueryables(): Field[] {\n    return this.dataSources\n      .filter((dataSource: IDataSource) => dataSource.isConnected())\n      .flatMap((dataSource: IDataSource) => {\n        return dataSource.getQueryables()\n      })\n  }\n\n  /**\n   * Evaluate an expression to a value\n  */\n  getValue(\n    expression: Expression,\n    component: Component,\n    resolvePreviewIndex = true, // False only for loop\n    prevValues: unknown = null,\n  ): unknown {\n    if (expression.length === 0) {\n      return prevValues\n    }\n\n    const [token, ...rest] = expression\n\n    switch (token.type) {\n    case 'state': {\n      const state = token as State\n      const resolvedExpression = this.resolveState(state, component)\n      if (!resolvedExpression) {\n        throw new Error(`Unable to resolve state: ${JSON.stringify(state)}`)\n      }\n\n      // Special handling for items state - always wrap result in array when resolvePreviewIndex is true\n      const previewIndex = resolvedExpression[resolvedExpression.length - 1].previewIndex\n      if (state.storedStateId === 'items' && typeof previewIndex !== 'undefined') {\n        // @ts-expect-error - Adding runtime property for items state handling\n        resolvedExpression[0].isItems = true\n      }\n      return this.getValue(resolvedExpression.concat(...rest), component, resolvePreviewIndex, prevValues)\n    }\n\n    case 'property': {\n      // Handle the case of a \"fixed\" property (hard coded string set by the user)\n      if (token.fieldId === FIXED_TOKEN_ID) {\n        return this.getValue(rest, component, resolvePreviewIndex, token.options?.value)\n      }\n\n      // Handle the case where the property refers to the first level of the data source\n      // Or it can be a key in the previewly computed data\n      let prevObj\n      if (typeof prevValues === 'undefined' || prevValues === null) {\n        if (!token.dataSourceId) {\n          throw new Error(`Data source ID is missing for token: ${JSON.stringify(token)}`)\n        }\n        prevObj = this.previewData[token.dataSourceId]\n      } else {\n        prevObj = prevValues\n      }\n\n      // Now get the next value\n      let value = prevObj ? (prevObj as Record<string, unknown>)[token.fieldId] : null\n\n      // Always handle preview index if resolvePreviewIndex is true\n      if (resolvePreviewIndex) {\n        value = this.handlePreviewIndex(value, token)\n      }\n\n      // For non-final tokens, always handle preview index regardless of resolvePreviewIndex\n      if (rest.length > 0 && !resolvePreviewIndex) {\n        value = this.handlePreviewIndex(value, token)\n      }\n      // @ts-expect-error - Runtime property check for items handling\n      if (token.isItems && typeof token.previewIndex !== 'undefined') {\n        if(rest.length > 0) {\n          value = [value]\n        }\n      }\n      return this.getValue(rest, component, resolvePreviewIndex, value)\n    }\n    case 'filter': {\n      const options = Object.entries(token.options).reduce((acc, [key, value]) => {\n        acc[key] = this.getValue(toExpression(value) || [], component, resolvePreviewIndex, null)\n        return acc\n      }, {} as Record<string, unknown>)\n\n      const filter = this.filters.find(f => f.id === token.id)\n      if (!filter) {\n        throw new Error(`Filter not found: ${token.id}`)\n      }\n\n      let value\n      try {\n        // value = filter.apply([prevValues], options)\n        value = filter.apply(prevValues, options)\n      } catch(e) {\n        console.warn(`Filter \"${filter.id}\" error:`, e, {\n          filter: filter.id,\n          prevValues,\n          options,\n          valueType: typeof prevValues,\n          isArray: Array.isArray(prevValues),\n          isNull: prevValues === null\n        })\n        // Mimic behavior of liquid - return the input value unchanged\n        return null\n        // return this.getValue(rest, component, resolvePreviewIndex, prevValues)\n      }\n\n      // Always handle preview index if resolvePreviewIndex is true, or if there are more tokens\n      if (resolvePreviewIndex || rest.length > 0) {\n        value = this.handlePreviewIndex(value, token)\n      }\n\n      return this.getValue(rest, component, resolvePreviewIndex, value)\n    }\n\n    default:\n      throw new Error(`Unsupported token type: ${token}`)\n    }\n  }\n\n  /**\n   * Handle preview index for a given value and token\n   */\n  handlePreviewIndex(value: unknown, token: StoredToken): unknown {\n    if (typeof token.previewIndex === 'undefined') {\n      return value\n    }\n\n    if(Array.isArray(value)) {\n      return value[token.previewIndex]\n    }\n    return value\n  }\n\n  /**\n   * Get all expressions used in all pages\n   */\n  getAllPagesExpressions(): { page: Page, expressions: ComponentExpression[] }[] {\n    return this.editor.Pages.getAll()\n      .map((page: Page) => ({\n        page,\n        expressions: this.getPageExpressions(page),\n      }))\n  }\n\n  /**\n   * Get all expressions used in a page\n   * This will be used to fetch data for the page\n   */\n  getPageExpressions(page: Page): ComponentExpression[] {\n    return this.getComponentExpressionsRecursive(page.getMainComponent())\n  }\n\n  /**\n   * Get all expressions used by a component and its children\n   */\n  getComponentExpressionsRecursive(component: Component): ComponentExpression[] {\n    const queries = [] as ComponentExpression[]\n    queries.push(...this.getComponentExpressions(component))\n    component.components()\n      .forEach((child: Component) => {\n        queries.push(...this.getComponentExpressionsRecursive(child))\n      })\n    return queries\n  }\n\n  /**\n   * Get all expressions used by a component\n   */\n  getComponentExpressions(component: Component): ComponentExpression[] {\n    const publicStates = getStates(component, true)\n    const privateStates = getStates(component, false)\n\n    return ([] as ComponentExpression[])\n      // Visible states (custom / user defined)\n      .concat(\n        // For each state\n        publicStates\n          // Add the component\n          .map(({expression}) => ({expression, component}))\n      )\n      // Hidden states (loop / internals)\n      .concat(\n        // For each state\n        privateStates\n          // Add the component\n          .map(({expression}) => ({expression, component}))\n      )\n  }\n\n  /**\n   * Build a tree of expressions\n   */\n  getTrees({expression, component}: ComponentExpression, dataSourceId: DataSourceId): Tree[] {\n    if(expression.length === 0) return []\n    const next = expression[0]\n    switch(next.type) {\n    case 'property': {\n      if(next.dataSourceId !== dataSourceId) return []\n      const trees = this.getTrees({expression: expression.slice(1), component}, dataSourceId)\n      if(trees.length === 0) return [{\n        token: next,\n        children: [],\n      }]\n      return trees\n        .flatMap(tree => {\n          // Check if this is a \"relative\" property or \"absolute\" (a root type)\n          if(this.isRelative(next, tree.token, dataSourceId)) {\n            return {\n              token: next,\n              children: [tree],\n            }\n          } else {\n            return [{\n              token: next,\n              children: [],\n            }, tree]\n          }\n        })\n    }\n    case 'filter': {\n      const options = Object.values(next.options)\n        .map((value: unknown) => toExpression(value))\n        .filter((exp: Expression | null) => !!exp && exp.length > 0)\n        .flatMap(exp => this.getTrees({expression: exp!, component}, dataSourceId))\n\n      const trees = this.getTrees({expression: expression.slice(1), component}, dataSourceId)\n      if(trees.length === 0) return options\n      return trees.flatMap(tree => [tree, ...options])\n    }\n    case 'state': {\n      const resolved = this.resolveState(next, component)\n      if(!resolved) {\n        this.editor.runCommand('notifications:add', {\n          type: 'error',\n          group: NOTIFICATION_GROUP,\n          message: `Unable to resolve state <pre>${JSON.stringify(next)}</pre>`,\n          componentId: component.getId(),\n        })\n        throw new Error(`Unable to resolve state ${JSON.stringify(next)}. State defined on component ${getComponentDebug(component)}`)\n      }\n      return this.getTrees({expression: resolved, component}, dataSourceId)\n    }\n    default:\n      this.editor.runCommand('notifications:add', {\n        type: 'error',\n        group: NOTIFICATION_GROUP,\n        message: `Invalid expression <pre>${JSON.stringify(expression)}</pre>`,\n        componentId: component.getId(),\n      })\n      throw new Error(`Invalid expression ${JSON.stringify(expression)}. Expression used on component ${getComponentDebug(component)}`)\n    }\n  }\n\n  /**\n   * Check if a property is relative to a type\n   * A type is \"relative\" if parent has a type which has a field of type tree.token\n   * FIXME: need a better way to check if a property is relative, e.g. have a \"relative\" flag on the property, set depending on <state-editor root-type\n   */\n  isRelative(parent: Property, child: Property, dataSourceId: DataSourceId): boolean {\n    const parentTypes = this.getTypes(dataSourceId).filter(t => parent.typeIds.includes(t.id))\n    const parentFieldsTypes = parentTypes.flatMap(t => t.fields.map(f => f.typeIds).flat())\n    return parentFieldsTypes.length > 0 && child.typeIds.some(typeId => parentFieldsTypes.includes(typeId))\n  }\n\n  /**\n   * From expressions to a tree\n   */\n  toTrees(expressions: ComponentExpression[], dataSourceId: DataSourceId): Tree[] {\n    if(expressions.length === 0) return []\n    return expressions\n      // From Expression to Tree\n      .flatMap(expression => this.getTrees(expression, dataSourceId))\n      // Group by root token\n      .reduce((acc: Tree[][], tree: Tree) => {\n        const existing = acc.find(t => t[0].token.fieldId === tree.token.fieldId && (!tree.token.dataSourceId || t[0].token.dataSourceId === tree.token.dataSourceId))\n        if(existing) {\n          existing.push(tree)\n        } else {\n          acc.push([tree])\n        }\n        return acc\n      }, [] as Tree[][])\n      // Merge all trees from the root\n      .map((grouped: Tree[]) => {\n        try {\n          const merged = grouped.reduce((acc, tree) => this.mergeTrees(acc, tree))\n          return merged\n        } catch(e) {\n          this.editor.runCommand('notifications:add', {\n            type: 'error',\n            group: NOTIFICATION_GROUP,\n            message: `Unable to merge trees <pre>${JSON.stringify(grouped)}</pre>`,\n            componentId: expressions[0].component.getId(),\n          })\n          throw e\n        }\n      })\n  }\n\n  /**\n   * Recursively merge two trees\n   */\n  protected mergeTrees(tree1: Tree, tree2: Tree): Tree {\n    // Check if the trees have the same fieldId\n    if (tree1.token.dataSourceId !== tree2.token.dataSourceId\n    // Don't check for kind because it can be different for the same fieldId\n    // For example `blog` collection (kind: list) for a loop/repeat\n    //   and `blog` item (kind: object) from inside the loop\n    // FIXME: why is this?\n    // || tree1.token.kind !== tree2.token.kind\n    ) {\n      console.error('Unable to merge trees', tree1, tree2)\n      throw new Error(`Unable to build GraphQL query: unable to merge trees ${JSON.stringify(tree1)} and ${JSON.stringify(tree2)}`)\n    }\n\n    // Check if there are children with the same fieldId but different options\n    // FIXME: we should use graphql aliases: https://graphql.org/learn/queries/#aliases but then it changes the variable name in the result\n    const errors = tree1.children\n      .filter(child1 => tree2.children.find(child2 =>\n        child1.token.fieldId === child2.token.fieldId\n        && getOptionObject(child1.token.options, child2.token.options).error\n      ))\n      .map(child1 => {\n        const child2 = tree2.children.find(child2 => child1.token.fieldId === child2.token.fieldId)\n        return `${child1.token.fieldId} appears twice with different options: ${JSON.stringify(child1.token.options)} vs ${JSON.stringify(child2?.token.options)}`\n      })\n\n    if(errors.length > 0) {\n      console.error('Unable to merge trees', errors)\n      throw new Error(`Unable to build GraphQL query: unable to merge trees: \\n* ${errors.join('\\n* ')}`)\n    }\n\n    const different = tree1.children\n      .filter(child1 => !tree2.children.find(child2 =>\n        child1.token.fieldId === child2.token.fieldId\n        && child1.token.typeIds.join(',') === child2.token.typeIds.join(',')\n        && !getOptionObject(child1.token.options, child2.token.options).error\n      ))\n      .concat(tree2.children\n        .filter(child2 => !tree1.children.find(child1 =>\n          child1.token.fieldId === child2.token.fieldId\n          && child1.token.typeIds.join(',') === child2.token.typeIds.join(',')\n          && !getOptionObject(child1.token.options, child2.token.options).error\n        ))\n      )\n    const same = tree1.children\n      .filter(child1 => tree2.children.find(child2 =>\n        child1.token.fieldId === child2.token.fieldId\n        && child1.token.typeIds.join(',') === child2.token.typeIds.join(',')\n        && !getOptionObject(child1.token.options, child2.token.options).error\n      ))\n\n    return {\n      token: tree1.token,\n      children: different\n        .concat(same\n          .map(child1 => {\n            const child2 = tree2.children.find(child2 => child1.token.fieldId === child2.token.fieldId)\n            return this.mergeTrees(child1, child2!)\n          })),\n    }\n  }\n\n  /**\n   * Get all expressions used by a component\n   * Resolves all states token as expressions recursively\n   * Resulting expressions contain properties and filters only, no states anymore\n   */\n  resolveState(state: State, component: Component): Expression | null {\n    const parent = getParentByPersistentId(state.componentId, component)\n    if (!parent) {\n      console.error('Component not found for state', state, component.get('id-plugin-data-source'), component.parent()?.get('id-plugin-data-source'), getPersistantId(component.parent()!))\n      return null\n    }\n    // Get the expression of the state\n    const storedState = getState(parent, state.storedStateId, state.exposed)\n    if (!storedState?.expression) {\n      console.warn('State is not defined on component', parent.getId(), state, storedState)\n      return null\n    }\n    return storedState.expression\n      .flatMap((token: StoredToken) => {\n        switch (token.type) {\n        case 'state': {\n          return this.resolveState(fromStored(token, this, component.getId()), parent) ?? []\n        }\n        default:\n          return token\n        }\n      })\n  }\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Field, Filter, Options } from '../types'\nimport { html } from 'lit'\nimport { convertKind, getFieldType } from '../utils'\nimport { Component, Editor } from 'grapesjs'\n\n/**\n * Check if a field is a number\n */\nfunction isNumber(field: Field | null, scalarOnly = true): boolean {\n  if (!field || (scalarOnly && field.kind !== 'scalar')) return false\n  const typeIds = field.typeIds.map(typeId => typeId.toLowerCase())\n  return typeIds.includes('number') || typeIds.includes('int')\n}\n\n/**\n * Check if a field is a string\n * Exported for testing\n */\nexport function isString(field: Field | null, scalarOnly = true): boolean {\n  if (!field || (scalarOnly && field.kind !== 'scalar')) return false\n  return field.typeIds.map(typeId => typeId.toLowerCase()).includes('string')\n}\n\n/**\n * Check if a field is a date\n * Exported for testing\n */\nexport function isDate(field: Field | null, scalarOnly = true): boolean {\n  if (!field || (scalarOnly && field.kind !== 'scalar')) return false\n  return field.typeIds.map(typeId => typeId.toLowerCase()).some(typeId => ['date', 'instant'].includes(typeId))\n}\n\n/**\n * Liquid filters\n */\nexport default function(editor: Editor): Filter[] {\n  return [\n    {\n      type: 'filter',\n      id: 'strip_html',\n      label: 'strip_html',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str) => (str as string).replace(/<[^>]*>/g, ''),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'append',\n      label: 'append',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => `${str}${options.value}`,\n      options: {\n        value: '',\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options, stateName: string) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          name=\"value\"\n          parent-name=${stateName}\n          data-is-input\n          no-filters\n          class=\"ds-state-editor__options\"\n          value=${options.value || '[]'}\n        >\n          <label slot=\"label\">Suffix</label>\n        </state-editor>\n      `,\n    }, {\n      type: 'filter',\n      id: 'prepend',\n      label: 'prepend',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => `${options.state}${str}`,\n      options: {\n        value: '',\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options, stateName: string) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          name=\"value\"\n          parent-name=${stateName}\n          data-is-input\n          no-filters\n          class=\"ds-state-editor__options\"\n          value=${options.value || '[]'}\n        >\n          <label slot=\"label\">Prefix</label>\n        </state-editor>\n      `,\n    }, {\n      type: 'filter',\n      id: 'where',\n      label: 'where',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: field => field,\n      apply: (arr, options) => {\n        const { key, value } = options as { key: string, value: string }\n        return (arr as Record<string, unknown>[]).filter(item => item[key] === value)\n      },\n      options: {\n        key: '',\n        value: '',\n      },\n      quotedOptions: ['key'],\n      optionsKeys: ['key', 'value'],\n      optionsForm: (selected: Component, field: Field | null, options: Options, stateName: string) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.key || []}\n          name=\"key\"\n          root-type=${field?.typeIds[0] ?? ''}\n        >\n          <label slot=\"label\">Key to filter on</label>\n        </state-editor>\n        <p>==</p>\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          parent-name=${stateName}\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.value || []}\n          name=\"value\"\n        >\n          <label slot=\"label\">Value to match</label>\n        </state-editor>\n    `,\n    }, {\n    // FIXME: the fields used in the expression are not available in the query\n    //   // https://liquidjs.com/filters/where_exp.html\n    //   type: 'filter',\n    //   id: 'where_exp',\n    //   label: 'where_exp',\n    //   validate: (field: Field | null) => !!field && field.kind === 'list',\n    //   output: field => field,\n    //   apply: (arr, options) => {\n    //     const { objectName, expression } = options as { objectName: string, expression: string }\n    //     return (arr as Record<string, unknown>[]).filter(item => {\n    //       // eslint-disable-next-line no-new-func\n    //       const fn = new Function(objectName, `return ${expression}`)\n    //       return fn(item)\n    //     })\n    //   },\n    //   options: {\n    //     objectName: 'item',\n    //     expression: 'item.key === \"value\"',\n    //   },\n    //   quotedOptions: ['objectName', 'expression'],\n    //   optionsKeys: ['objectName', 'expression'],\n    //   optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n    //     <label>Object name\n    //       <input type=\"text\" name=\"objectName\" placeholder=\"Object name\" .value=${options.objectName || 'item'}/>\n    //     </label>\n    //     <label>Expression (JS)\n    //       <input type=\"text\" name=\"expression\" placeholder=\"Expression\" .value=${options.expression || 'item.key === \"value\"'}/>\n    //     </label>\n    //   `,\n    // }, {\n      // https://liquidjs.com/filters/find.html\n      type: 'filter',\n      id: 'find',\n      label: 'find',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: field => convertKind(field, 'list', 'object'),\n      apply: (arr, options) => {\n        const { key, value } = options as { key: string, value: string }\n        return (arr as Record<string, unknown>[]).find(item => item[key] === value)\n      },\n      options: {\n        key: '',\n        value: '',\n      },\n      quotedOptions: ['key'],\n      optionsKeys: ['key', 'value'],\n      optionsForm: (selected: Component, field: Field | null, options: Options, stateName: string) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.key || []}\n          name=\"key\"\n          root-type=${field?.typeIds[0] ?? ''}\n        >\n          <label slot=\"label\">Key to filter on</label>\n        </state-editor>\n        <p>==</p>\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          parent-name=${stateName}\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.value || []}\n          name=\"value\"\n        >\n          <label slot=\"label\">Value to match</label>\n        </state-editor>\n      `,\n    }, {\n    // FIXME: the fields used in the expression are not available in the query\n    //   // https://liquidjs.com/filters/find_exp.html\n    //   type: 'filter',\n    //   id: 'find_exp',\n    //   label: 'find_exp',\n    //   validate: (field: Field | null) => !!field && field.kind === 'list',\n    //   output: field => convertKind(field, 'list', 'object'),\n    //   apply: (arr, options) => {\n    //     const { objectName, expression } = options as { objectName: string, expression: string }\n    //     return (arr as Record<string, unknown>[]).find(item => {\n    //       // eslint-disable-next-line no-new-func\n    //       const fn = new Function(objectName, `return ${expression}`)\n    //       return fn(item)\n    //     })\n    //   },\n    //   options: {\n    //     objectName: 'item',\n    //     expression: 'item.key === \"value\"',\n    //   },\n    //   quotedOptions: ['objectName', 'expression'],\n    //   optionsKeys: ['objectName', 'expression'],\n    //   optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n    //     <label>Object name\n    //       <input type=\"text\" name=\"objectName\" placeholder=\"Object name\" .value=${options.objectName || 'item'}/>\n    //     </label>\n    //     <label>Expression (JS)\n    //       <input type=\"text\" name=\"expression\" placeholder=\"Expression\" .value=${options.expression || 'item.key === \"value\"'}/>\n    //     </label>\n    //   `,\n    // }, {\n      type: 'filter',\n      id: 'first',\n      label: 'first',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: (field: Field | null) => convertKind(field, 'list', 'object'),\n      apply: (arr) => (arr as unknown[])[0],\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'last',\n      label: 'last',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: (field: Field | null) => convertKind(field, 'list', 'object'),\n      apply: (arr) => (arr as unknown[])[(arr as unknown[]).length - 1],\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'join',\n      label: 'join',\n      validate: (field: Field | null) => isString(field, false) && field?.kind === 'list',\n      output: (field: Field | null) => convertKind(field, 'list', 'scalar'),\n      apply: (arr, options) => (arr as string[]).join(options.separator as string ?? ','),\n      options: {\n        separator: ',',\n      },\n      quotedOptions: ['separator'],\n      optionsForm: (selected: Component, field: Field | null, options: Options, stateName: string) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          parent-name=${stateName}\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.separator || []}\n          name=\"separator\"\n        >\n          <label slot=\"label\">Separator</label>\n        </state-editor>\n    `,\n    }, {\n      type: 'filter',\n      id: 'split',\n      label: 'split',\n      validate: (field: Field | null) => isString(field),\n      output: (field: Field | null) => convertKind(field, 'scalar', 'list'),\n      apply: (str, options) => (str as string).split(options.separator as string ?? ','),\n      options: {\n        separator: ',',\n      },\n      quotedOptions: ['separator'],\n      optionsForm: (selected: Component, field: Field | null, options: Options, stateName: string) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          parent-name=${stateName}\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.separator || []}\n          name=\"separator\"\n        >\n          <label slot=\"label\">Separator</label>\n        </state-editor>\n    `,\n    }, {\n      type: 'filter',\n      id: 'map',\n      label: 'map',\n      validate: (field: Field | null) => !!field && (field.kind === 'list' || field.kind === 'object'),\n      output: (field, options) => getFieldType(editor, field, options['key'] as string | undefined, null),\n      apply: (arr, options) => (arr as Record<string, unknown>[]).map(item => item[options.key as string]),\n      options: {\n        key: '',\n      },\n      quotedOptions: ['key'],\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.key || []}\n          name=\"key\"\n          root-type=${field?.typeIds[0] ?? ''}\n        >\n          <label slot=\"label\">Key to map</label>\n        </state-editor>\n      `,\n    // This is a dynamic key, but it's not working yet\n    // The problem is that output method can only return a single field, but we need to return a list of fields\n    // This was an attempt returning the first field only but this makes it impossible to select fields inside the result object and the query will not include the content of the fields we should return\n    // }, {\n    //   type: 'filter',\n    //   id: 'map-dynamic',\n    //   filterName: 'map',\n    //   label: 'map (dynamic key)',\n    //   validate: (field: Field | null) => !!field && (field.kind === 'list' || field.kind === 'object'),\n    //   // Any field can be chosen, so we return the first one\n    //   // Is multiple fields necessary? We will probably always have the same data structure there\n    //   output: (field) => field ? editor.DataSourceManager.getDataTree()\n    //     .getType(field.typeIds[0], field.dataSourceId ?? null)?.fields[0] ?? null : null,\n    //   apply: (arr, options) => (arr as Record<string, unknown>[]).map(item => item[options.key as string]),\n    //   options: {\n    //     key: '',\n    //   },\n    //   quotedOptions: [],\n    //   optionsForm: (field: Field | null, options: Options) => html`\n    //     <state-editor\n    //       no-filters\n    //       data-is-input\n    //       class=\"ds-state-editor__options\"\n    //       value=${options.key || []}\n    //       name=\"key\"\n    //       ${ref(el => el && (el as StateEditor).setEditor(editor))}\n    //     >\n    //       <label slot=\"label\">Key to map (dyanamic)</label>\n    //     </state-editor>\n    //   `,\n    }, {\n      type: 'filter',\n      id: 'reverse',\n      label: 'reverse',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: field => field,\n      apply: (arr) => (arr as unknown[]).reverse(),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'size',\n      label: 'size',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: () => ({\n        id: 'Int',\n        label: 'Int',\n        typeIds: ['Int'],\n        kind: 'scalar',\n      }),\n      apply: (arr) => (arr as unknown[]).length,\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'at',\n      label: 'at',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: field => convertKind(field, 'list', 'object'),\n      apply: (arr, options) => (arr as unknown[])[options.index as number],\n      options: {\n        index: 0,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Index\n          <input type=\"number\" name=\"index\" placeholder=\"Index\" .value=${options.index}/>\n        </label>\n    `,\n    }, {\n      type: 'filter',\n      id: 'slice',\n      label: 'slice',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: field => field,\n      apply: (arr, options) => (arr as unknown[]).slice(options.start as number, options.end as number),\n      options: {\n        start: 0,\n        end: 0,\n      },\n      optionsKeys: ['start', 'end'],\n      optionsForm: (selected: Component, field: Field | null, options: Options, stateName: string) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          parent-name=${stateName}\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.start || []}\n          name=\"start\"\n        >\n          <label slot=\"label\">Start index</label>\n        </state-editor>\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          parent-name=${stateName}\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.end || []}\n          name=\"end\"\n        >\n          <label slot=\"label\">End index</label>\n        </state-editor>\n      `,\n    }, {\n      type: 'filter',\n      id: 'sort',\n      label: 'sort',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: field => field,\n      apply: (arr, options) => (arr as Record<string, string | number>[]).sort((a, b) => {\n        if (a[options.key as string] < b[options.key as string]) {\n          return -1\n        }\n        if (a[options.key as string] > b[options.key as string]) {\n          return 1\n        }\n        return 0\n      }),\n      quotedOptions: ['key'],\n      options: {\n        key: '',\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          no-filters\n          data-is-input\n          class=\"ds-state-editor__options\"\n          value=${options.key || []}\n          name=\"key\"\n          root-type=${field?.typeIds[0] ?? ''}\n        >\n          <label slot=\"label\">Key to sort on</label>\n        </state-editor>\n      `,\n    }, {\n      type: 'filter',\n      id: 'plus',\n      label: 'plus',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num, options) => (num as number) + (options.value as number),\n      options: {\n        value: 0,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Value\n          <input type=\"number\" name=\"value\" placeholder=\"Value\" .value=${options.value}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'minus',\n      label: 'minus',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num, options) => (num as number) - (options.value as number),\n      options: {\n        value: 0,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Value\n          <input type=\"number\" name=\"value\" placeholder=\"Value\" .value=${options.value}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'times',\n      label: 'times',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num, options) => (num as number) * (options.value as number),\n      options: {\n        value: 0,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Value\n          <input type=\"number\" name=\"value\" placeholder=\"Value\" .value=${options.value}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'divided_by',\n      label: 'divided_by',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num, options) => (num as number) / (options.value as number),\n      options: {\n        value: 0,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Value\n          <input type=\"number\" name=\"value\" placeholder=\"Value\" .value=${options.value}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'modulo',\n      label: 'modulo',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num, options) => (\n        (num as number) % (options.value as number)\n      ),\n      options: {\n        value: 0,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Value\n          <input type=\"number\" name=\"value\" placeholder=\"Value\" .value=${options.value}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'abs',\n      label: 'abs',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num) => Math.abs(num as number),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'ceil',\n      label: 'ceil',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num) => Math.ceil(num as number),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'floor',\n      label: 'floor',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num) => Math.floor(num as number),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'round',\n      label: 'round',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num) => Math.round(num as number),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'at_least',\n      label: 'at_least',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num, options) => Math.max(num as number, options.value as number),\n      options: {\n        value: 0,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Value\n          <input type=\"number\" name=\"value\" placeholder=\"Value\" .value=${options.value}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'at_most',\n      label: 'at_most',\n      validate: (field: Field | null) => isNumber(field),\n      output: type => type,\n      apply: (num, options) => Math.min(num as number, options.value as number),\n      options: {\n        value: 0,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Value\n          <input type=\"number\" name=\"value\" placeholder=\"Value\" .value=${options.value}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'compact',\n      label: 'compact',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: field => field,\n      apply: (arr) => (arr as unknown[]).filter(item => !!item),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'default',\n      label: 'default',\n      validate: (field: Field | null) => !!field && field.kind === 'scalar',\n      output: field => field,\n      apply: (value, options) => value || options.value,\n      options: {\n        value: '',\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options, stateName: string) => html`\n        <state-editor\n          .selected=${selected}\n          .editor=${editor}\n          name=\"value\"\n          parent-name=${stateName}\n          data-is-input\n          no-filters\n          class=\"ds-state-editor__options\"\n          value=${options.value || '[]'}\n        >\n          <label slot=\"label\">Default value</label>\n        </state-editor>\n      `,\n    }, {\n      type: 'filter',\n      id: 'escape',\n      label: 'escape',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str) => (str as string).replace(/\"/g, '\\\\\"'),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'escape_once',\n      label: 'escape_once',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str) => (str as string).replace(/\"/g, '\\\\\"'),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'newline_to_br',\n      label: 'newline_to_br',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str) => (str as string).replace(/\\n/g, '<br />'),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'strip_newlines',\n      label: 'strip_newlines',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str) => (str as string).replace(/\\n/g, ''),\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'truncate',\n      label: 'truncate',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => (str as string).slice(0, options.length as number),\n      options: {\n        length: 50,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Length\n          <input type=\"number\" name=\"length\" placeholder=\"Length\" .value=${options.length}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'truncatewords',\n      label: 'truncatewords',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => (str as string).split(' ').slice(0, options.length as number).join(' '),\n      options: {\n        length: 15,\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Length\n          <input type=\"number\" name=\"length\" placeholder=\"Length\" .value=${options.length}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'date',\n      label: 'date',\n      validate: (field: Field | null) => isDate(field),\n      output: () => ({\n        id: 'String',\n        label: 'String',\n        typeIds: ['String'],\n        kind: 'scalar',\n      }),\n      apply: (date, options) => {\n        const d = new Date(date as string)\n        return d.toLocaleDateString(options.format as string)\n      },\n      options: {\n        format: '%a, %b %d, %y', // Fri, Jul 17, 15\n        timeZone: '',\n      },\n      optionsKeys: ['format', 'timeZone'],\n      quotedOptions: ['format', 'timeZone'],\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Format\n          <input type=\"text\" name=\"format\" placeholder=\"Format\" .value=${options.format || '%a, %b %d, %y'}/>\n        </label>\n        <label>Time zone\n          <input type=\"text\" name=\"timeZone\" placeholder=\"Time zone\" .value=${options.timeZone || '' }/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'replace',\n      label: 'replace',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => (str as string).replace(options.search as string, options.replace as string),\n      options: {\n        search: '',\n        replace: '',\n      },\n      quotedOptions: ['search', 'replace'],\n      optionsKeys: ['search', 'replace'],\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Search\n          <input type=\"text\" name=\"search\" placeholder=\"Search\" .value=${options.search}/>\n        </label>\n        <label>Replace\n          <input type=\"text\" name=\"replace\" placeholder=\"Replace\" .value=${options.replace}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'replace_first',\n      label: 'replace_first',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => (str as string).replace(options.search as string, options.replace as string),\n      options: {\n        search: '',\n        replace: '',\n      },\n      quotedOptions: ['search', 'replace'],\n      optionsKeys: ['search', 'replace'],\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Search\n          <input type=\"text\" name=\"search\" placeholder=\"Search\" .value=${options.search}/>\n        </label>\n        <label>Replace\n          <input type=\"text\" name=\"replace\" placeholder=\"Replace\" .value=${options.replace}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'replace_last',\n      label: 'replace_last',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => {\n        const index = (str as string).lastIndexOf(options.search as string)\n        if (index === -1) return str\n        return (str as string).slice(0, index) + (options.replace as string) + (str as string).slice(index + (options.search as string).length)\n      },\n      options: {\n        search: '',\n        replace: '',\n      },\n      quotedOptions: ['search', 'replace'],\n      optionsKeys: ['search', 'replace'],\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Search\n          <input type=\"text\" name=\"search\" placeholder=\"Search\" .value=${options.search}/>\n        </label>\n        <label>Replace\n          <input type=\"text\" name=\"replace\" placeholder=\"Replace\" .value=${options.replace}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'remove',\n      label: 'remove',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => (str as string).replace(options.search as string, ''),\n      options: {\n        search: '',\n      },\n      quotedOptions: ['search'],\n      optionsKeys: ['search'],\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Search\n          <input type=\"text\" name=\"search\" placeholder=\"Search\" .value=${options.search}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'remove_first',\n      label: 'remove_first',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => (str as string).replace(options.search as string, ''),\n      options: {\n        search: '',\n      },\n      quotedOptions: ['search'],\n      optionsKeys: ['search'],\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Search\n          <input type=\"text\" name=\"search\" placeholder=\"Search\" .value=${options.search}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'remove_last',\n      label: 'remove_last',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str, options) => {\n        const index = (str as string).lastIndexOf(options.search as string)\n        if (index === -1) return str\n        return (str as string).slice(0, index) + (str as string).slice(index + (options.search as string).length)\n      },\n      options: {\n        search: '',\n      },\n      quotedOptions: ['search'],\n      optionsKeys: ['search'],\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Search\n          <input type=\"text\" name=\"search\" placeholder=\"Search\" .value=${options.search}/>\n        </label>\n      `,\n    }, {\n      type: 'filter',\n      id: 'downcase',\n      label: 'downcase',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str) => str ? (str as string).toLowerCase() : '',\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'upcase',\n      label: 'upcase',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str) => str ? (str as string).toUpperCase() : '',\n      options: {},\n    }, {\n      type: 'filter',\n      id: 'capitalize',\n      label: 'capitalize',\n      validate: (field: Field | null) => isString(field),\n      output: type => type,\n      apply: (str) => (str as string).charAt(0).toUpperCase() + (str as string).slice(1).toLowerCase(),\n      options: {},\n    }, {\n      // Pick a random value from an array. Optionally, pick multiple values, default is 1 value.\n      // https://jekyllrb.com/docs/liquid/filters/\n      type: 'filter',\n      id: 'sample',\n      label: 'sample',\n      validate: (field: Field | null) => !!field && field.kind === 'list',\n      output: field => field,\n      apply: (arr, options) => {\n        const count = parseInt(options.count as string || '1')\n        console.log({count, options})\n        return (arr as unknown[])\n          .sort(() => 0.5 - Math.random())\n          .slice(0, count)\n      },\n      options: {\n        count: '1',\n      },\n      optionsForm: (selected: Component, field: Field | null, options: Options) => html`\n        <label>Count\n          <input type=\"number\" name=\"count\" placeholder=\"Count\" .value=${options.count}/>\n        </label>\n      `,\n    },\n  ]\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { DataSourceId, Property, StoredToken, ComponentExpression } from '../types'\nimport { DataTree } from './DataTree'\nimport { getAllDataSources } from './dataSourceRegistry'\nimport { Page, Editor } from 'grapesjs'\nimport { getComponentDebug, NOTIFICATION_GROUP } from '../utils'\n\n/**\n * Get page query for both preview and production use\n * Used by preview system and 11ty site generation\n * @param page - The page to get queries for\n * @param editor - The GrapesJS editor instance\n * @param dataTree - The DataTree instance to use for query generation\n */\nexport function getPageQuery(page: Page, editor: Editor, dataTree: DataTree): Record<DataSourceId, string> {\n  const expressions = dataTree.getPageExpressions(page)\n  const dataSources = getAllDataSources()\n\n  return dataSources\n    .map(ds => {\n      if (!ds.isConnected()) {\n        console.error('The data source is not yet connected, the value for this page can not be loaded')\n        return {\n          dataSourceId: ds.id.toString(),\n          query: '',\n        }\n      }\n\n      const dsExpressions = expressions\n        // Resolve all states\n        .map((componentExpression: ComponentExpression) => ({\n          component: componentExpression.component,\n          expression: componentExpression.expression.flatMap((token: StoredToken) => {\n            switch(token.type) {\n            case 'property':\n            case 'filter':\n              return token\n            case 'state': {\n              const resolved = dataTree.resolveState(token, componentExpression.component)\n              if (!resolved) {\n                editor.runCommand('notifications:add', {\n                  type: 'error',\n                  group: NOTIFICATION_GROUP,\n                  message: `Unable to resolve state ${JSON.stringify(token)}. State defined on component ${getComponentDebug(componentExpression.component)}`,\n                  componentId: componentExpression.component.getId(),\n                })\n                throw new Error(`Unable to resolve state ${JSON.stringify(token)}. State defined on component ${getComponentDebug(componentExpression.component)}`)\n              }\n              return resolved\n            }\n            }\n          })\n        }))\n        // Keep only the expressions for the current data source\n        .filter((componentExpression: ComponentExpression) => {\n          const e = componentExpression.expression\n          if(e.length === 0) return false\n          // We resolved all states\n          // An expression can not start with a filter\n          // So this is a property\n          const first = e[0] as Property\n          // Keep only the expressions for the current data source\n          return first?.dataSourceId === ds.id\n        })\n\n      const trees = dataTree.toTrees(dsExpressions, ds.id)\n      if(trees.length === 0) {\n        return {\n          dataSourceId: ds.id.toString(),\n          query: '',\n        }\n      }\n\n      const query = ds.getQuery(trees)\n      return {\n        dataSourceId: ds.id.toString(),\n        query,\n      }\n    })\n    .filter(obj => !!obj.query)\n    .reduce((acc, { dataSourceId, query }) => {\n      acc[dataSourceId] = query\n      return acc\n    }, {} as Record<DataSourceId, string>)\n}\n\n/**\n * Build queries for multiple pages\n * Useful for batch operations like site generation\n * @param pages - Array of pages to build queries for\n * @param editor - The GrapesJS editor instance\n * @param dataTree - The DataTree instance to use for query generation\n */\nexport function buildPageQueries(pages: Page[], editor: Editor, dataTree: DataTree): Record<string, Record<DataSourceId, string>> {\n  return pages.reduce((acc, page) => {\n    acc[page.getId()] = getPageQuery(page, editor, dataTree)\n    return acc\n  }, {} as Record<string, Record<DataSourceId, string>>)\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { DataSourceId, DATA_SOURCE_DATA_LOAD_START, DATA_SOURCE_DATA_LOAD_END, DATA_SOURCE_DATA_LOAD_CANCEL } from '../types'\nimport { DataTree } from './DataTree'\nimport { getAllDataSources } from './dataSourceRegistry'\nimport { getPageQuery } from './queryBuilder'\nimport { Page, Editor } from 'grapesjs'\nimport { NOTIFICATION_GROUP } from '../utils'\n\n/**\n * Preview data loader state\n */\ninterface PreviewDataLoaderState {\n  editor: Editor\n  dataTree: DataTree\n  currentUpdatePid: number\n  lastQueries: Record<DataSourceId, string>\n}\n\n// Global loader instance\nlet globalLoader: PreviewDataLoaderState | null = null\n\n/**\n * Initialize the preview data loader\n */\nexport function initializePreviewDataLoader(editor: Editor, dataTree: DataTree): void {\n  globalLoader = {\n    editor,\n    dataTree,\n    currentUpdatePid: 0,\n    lastQueries: {}\n  }\n}\n\n/**\n * Get the global loader (throws if not initialized)\n */\nfunction getLoader(): PreviewDataLoaderState {\n  if (!globalLoader) {\n    throw new Error('PreviewDataLoader not initialized. Call initializePreviewDataLoader first.')\n  }\n  return globalLoader\n}\n\n/**\n * Compare two query objects to see if they are equal\n */\nfunction areQueriesEqual(queries1: Record<DataSourceId, string>, queries2: Record<DataSourceId, string>): boolean {\n  const keys1 = Object.keys(queries1).sort()\n  const keys2 = Object.keys(queries2).sort()\n  \n  // Check if they have the same number of keys\n  if (keys1.length !== keys2.length) {\n    return false\n  }\n  \n  // Check if all keys are the same\n  if (!keys1.every(key => keys2.includes(key))) {\n    return false\n  }\n  \n  // Check if all values are the same\n  return keys1.every(key => queries1[key] === queries2[key])\n}\n\n/**\n * Load preview data for the current page\n * @param forceRefresh - If true, bypass query comparison and force refresh\n */\nexport async function loadPreviewData(forceRefresh: boolean = false): Promise<void> {\n  const loader = getLoader()\n  loader.editor.trigger(DATA_SOURCE_DATA_LOAD_START)\n  \n  const page = loader.editor.Pages.getSelected()\n  if (!page) return\n  \n  // Get current queries\n  const currentQueries = getPageQuery(page, loader.editor, loader.dataTree)\n  \n  // Compare with last queries to see if we need to refresh\n  const queriesChanged = !areQueriesEqual(loader.lastQueries, currentQueries)\n  \n  if (!forceRefresh && !queriesChanged) {\n    // Queries haven't changed, no need to refresh data sources\n    // But still trigger load end to maintain expected event flow\n    loader.editor.trigger(DATA_SOURCE_DATA_LOAD_END, loader.dataTree.previewData)\n    return\n  }\n  \n  // Update last queries\n  loader.lastQueries = { ...currentQueries }\n  \n  loader.currentUpdatePid++\n  const data = await fetchPagePreviewData(page)\n  \n  if (data !== 'interrupted') {\n    loader.editor.trigger(DATA_SOURCE_DATA_LOAD_END, data)\n  } else {\n    console.warn(`Preview data update process for PID ${loader.currentUpdatePid} was interrupted.`)\n    loader.editor.trigger(DATA_SOURCE_DATA_LOAD_CANCEL, data)\n  }\n}\n\n/**\n * Fetch preview data for a specific page\n * @param page - The page object for which preview data needs to be fetched\n * @return The preview data returned by all data sources, or 'interrupted' if cancelled\n */\nexport async function fetchPagePreviewData(page: Page): Promise<Record<DataSourceId, unknown> | 'interrupted'> {\n  const loader = getLoader()\n  const myPid = loader.currentUpdatePid\n  const queries = getPageQuery(page, loader.editor, loader.dataTree)\n  \n  // Reset preview data\n  loader.dataTree.previewData = {}\n\n  try {\n    const results = await Promise.all(\n      Object.entries(queries)\n        .map(async ([dataSourceId, query]) => {\n          if (myPid !== loader.currentUpdatePid) return\n          \n          const ds = getAllDataSources().find(ds => ds.id === dataSourceId)\n          if (!ds) {\n            console.error(`Data source ${dataSourceId} not found`)\n            return null\n          }\n          \n          if (!ds.isConnected()) {\n            console.warn(`Data source ${dataSourceId} is not connected.`)\n            return null\n          }\n          \n          try {\n            const value = await ds.fetchValues(query)\n            loader.dataTree.previewData[dataSourceId] = value\n            return { dataSourceId, value }\n          } catch (err) {\n            console.error(`Error fetching preview data for data source ${dataSourceId}:`, err)\n            loader.editor.runCommand('notifications:add', {\n              type: 'error',\n              group: NOTIFICATION_GROUP,\n              message: `Error fetching preview data for data source ${dataSourceId}: ${err}`,\n            })\n            return null\n          }\n        })\n    )\n\n    if (myPid !== loader.currentUpdatePid) return 'interrupted'\n\n    return results\n      .filter(result => result !== null)\n      .reduce((acc, result) => {\n        const { dataSourceId, value } = result!\n        acc[dataSourceId] = value\n        return acc\n      }, {} as Record<DataSourceId, unknown>)\n  } catch (err) {\n    console.error('Error while fetching preview data:', err)\n    loader.editor.runCommand('notifications:add', {\n      type: 'error',\n      group: NOTIFICATION_GROUP,\n      message: `Error while fetching preview data: ${err}`,\n    })\n    return {}\n  }\n}\n\n/**\n * Get current preview data\n */\nexport function getPreviewData(): Record<DataSourceId, unknown> {\n  return getLoader().dataTree.previewData\n}\n\n/**\n * Clear preview data\n */\nexport function clearPreviewData(): void {\n  getLoader().dataTree.previewData = {}\n}","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { COMPONENT_STATE_CHANGED, DATA_SOURCE_CHANGED, DATA_SOURCE_ERROR, DATA_SOURCE_READY, Filter, IDataSource, DataSourceEditorOptions } from '../types'\nimport { DataTree } from './DataTree'\nimport { Component, Editor } from 'grapesjs'\nimport { StoredState, onStateChange } from './state'\nimport getLiquidFilters from '../filters/liquid'\nimport {\n  initializeDataSourceRegistry,\n  getAllDataSources,\n  addDataSource as registryAddDataSource,\n  removeDataSource as registryRemoveDataSource,\n  setDataSources,\n  dataSourcesToJSON\n} from './dataSourceRegistry'\nimport { initializePreviewDataLoader, loadPreviewData } from './previewDataLoader'\n\n/**\n * Data source manager state\n */\nexport interface DataSourceManagerState {\n  dataTree: DataTree\n  editor: Editor\n  options: DataSourceEditorOptions\n  eventListeners: {\n    dataChangedBinded: (e?: CustomEvent) => void\n    dataSourceReadyBinded: (ds: IDataSource) => void\n    dataSourceErrorBinded: (message: string, ds: IDataSource) => void\n  }\n}\n\n// Global manager instance\nlet globalManager: DataSourceManagerState | null = null\n\n/**\n * Initialize filters from options\n */\nfunction initializeFilters(editor: Editor, options: DataSourceEditorOptions): Filter[] {\n  if (typeof options.filters === 'string') {\n    return [\n      ...getLiquidFilters(editor),\n    ]\n  } else {\n    return (options.filters as Filter[])\n      .flatMap((filter: Partial<Filter> | string): Filter[] => {\n        if (typeof filter === 'string') {\n          switch (filter) {\n          case 'liquid': return getLiquidFilters(editor)\n          default: throw new Error(`Unknown filters ${filter}`)\n          }\n        } else {\n          return [{\n            ...filter as Partial<Filter>,\n            type: 'filter',\n          } as Filter]\n        }\n      })\n      .map((filter: Filter) => ({ ...filter, type: 'filter' })) as Filter[]\n  }\n}\n\n/**\n * Initialize the global data source manager\n */\nexport function initializeDataSourceManager(\n  dataSources: IDataSource[],\n  editor: Editor,\n  options: DataSourceEditorOptions\n): void {\n  const filters = initializeFilters(editor, options)\n\n  // Initialize the registry\n  initializeDataSourceRegistry(editor)\n\n  // Set initial data sources\n  setDataSources(dataSources)\n\n  // Create data tree\n  const dataTree = new DataTree(editor, {\n    dataSources: getAllDataSources(),\n    filters,\n  })\n\n  // Initialize preview data loader\n  initializePreviewDataLoader(editor, dataTree)\n\n  // Create bound event handlers\n  const eventListeners = {\n    dataChangedBinded: (e?: CustomEvent) => {\n      editor.trigger(DATA_SOURCE_CHANGED, e?.detail)\n    },\n    dataSourceReadyBinded: (ds: IDataSource) => {\n      editor.trigger(DATA_SOURCE_READY, ds)\n      loadPreviewData(true) // force refresh when data source becomes ready\n    },\n    dataSourceErrorBinded: (message: string, ds: IDataSource) => {\n      editor.trigger(DATA_SOURCE_ERROR, message, ds)\n    }\n  }\n\n  globalManager = {\n    dataTree,\n    editor,\n    options,\n    eventListeners\n  }\n\n  // Set up event listeners\n  setupEventListeners()\n\n  // Listen for data source changes and re-setup event listeners\n  editor.on(DATA_SOURCE_CHANGED, () => {\n    setupEventListeners()\n  })\n\n  // Relay state changes to the editor\n  onStateChange((state: StoredState | null, component: Component) => {\n    loadPreviewData().then(() => editor.trigger(COMPONENT_STATE_CHANGED, { state, component }))\n  })\n}\n\n/**\n * Get the global manager (throws if not initialized)\n */\nfunction getManager(): DataSourceManagerState {\n  if (!globalManager) {\n    throw new Error('DataSourceManager not initialized. Call initializeDataSourceManager first.')\n  }\n  return globalManager\n}\n\n/**\n * Add a data source\n */\nexport async function addDataSource(dataSource: IDataSource): Promise<void> {\n  registryAddDataSource(dataSource)\n  setupEventListeners()\n}\n\n/**\n * Remove a data source\n */\nexport function removeDataSource(dataSource: IDataSource): void {\n  registryRemoveDataSource(dataSource)\n  setupEventListeners()\n  loadPreviewData(true) // force refresh when data source is removed\n}\n\n/**\n * Refresh all data sources data\n */\nexport function refreshDataSources(): void {\n  loadPreviewData(true) // force refresh when explicitly requested\n}\n\n/**\n * Reset all data sources\n */\nexport function resetDataSources(dataSources: IDataSource[]): void {\n  setDataSources(dataSources)\n  setupEventListeners()\n}\n\n/**\n * Get the data tree\n */\nexport function getDataTree(): DataTree {\n  return getManager().dataTree\n}\n\n/**\n * Get filters\n */\nexport function getFilters(): Filter[] {\n  return getManager().dataTree.filters\n}\n\n/**\n * Set filters\n */\nexport function setFilters(filters: Filter[]): void {\n  getManager().dataTree.filters = filters\n}\n\n/**\n * Convert to JSON for storage\n */\nexport function toJSON(): unknown[] {\n  return dataSourcesToJSON()\n}\n\n/**\n * Set up event listeners on all data sources\n */\nfunction setupEventListeners(): void {\n  const manager = getManager()\n  const dataSources = getAllDataSources()\n\n  // Update the data tree with current data sources\n  manager.dataTree.dataSources = [...dataSources]\n\n  // Remove all listeners\n  dataSources.forEach((dataSource: IDataSource) => {\n    if (typeof dataSource.off === 'function') {\n      dataSource.off(DATA_SOURCE_READY, manager.eventListeners.dataSourceReadyBinded)\n      dataSource.off(DATA_SOURCE_CHANGED, manager.eventListeners.dataChangedBinded)\n      dataSource.off(DATA_SOURCE_ERROR, manager.eventListeners.dataSourceErrorBinded)\n    }\n  })\n\n  // Add listeners on all data sources\n  dataSources.forEach((dataSource: IDataSource) => {\n    if (typeof dataSource.on === 'function') {\n      dataSource.on(DATA_SOURCE_READY, manager.eventListeners.dataSourceReadyBinded)\n      dataSource.on(DATA_SOURCE_CHANGED, manager.eventListeners.dataChangedBinded)\n      dataSource.on(DATA_SOURCE_ERROR, manager.eventListeners.dataSourceErrorBinded)\n    }\n  })\n}\n","import { DataSourceEditorOptions, COMMAND_REFRESH, COMMAND_PREVIEW_ACTIVATE, COMMAND_PREVIEW_DEACTIVATE, COMMAND_PREVIEW_REFRESH } from \"./types\"\nimport { refreshDataSources } from \"./model/dataSourceManager\"\nimport { Editor } from \"grapesjs\"\n\n// Global state for preview activation\nlet isPreviewActive = true\n\nexport function setPreviewActive(active: boolean) {\n  isPreviewActive = active\n}\n\nexport function getPreviewActive(): boolean {\n  return isPreviewActive\n}\n\n// Function to force GrapesJS to re-render all components\nfunction forceRender(editor: Editor) {\n  // Force a complete re-render by refreshing the canvas\n  editor.refresh()\n}\n\n// GrapesJS plugin to add commands to the editor\nexport default (editor: Editor, opts: DataSourceEditorOptions) => {\n  // Set initial preview state\n  isPreviewActive = opts.previewActive\n\n  // Refresh all data sources\n  editor.Commands.add(COMMAND_REFRESH, {\n    run() {\n      refreshDataSources()\n    },\n  })\n\n  // Activate preview mode\n  editor.Commands.add(COMMAND_PREVIEW_ACTIVATE, {\n    run() {\n      if (!isPreviewActive) {\n        isPreviewActive = true\n        // Force GrapesJS to re-render to show preview data\n        forceRender(editor)\n        console.log('📊 Data source preview activated')\n      }\n    },\n  })\n\n  // Deactivate preview mode\n  editor.Commands.add(COMMAND_PREVIEW_DEACTIVATE, {\n    run() {\n      if (isPreviewActive) {\n        isPreviewActive = false\n        // Force GrapesJS to re-render to show original content\n        forceRender(editor)\n        console.log('📊 Data source preview deactivated')\n      }\n    },\n  })\n\n  // Refresh preview data\n  editor.Commands.add(COMMAND_PREVIEW_REFRESH, {\n    run() {\n      if (isPreviewActive) {\n        // Refresh data sources and force re-render\n        refreshDataSources()\n        console.log('📊 Data source preview refreshed')\n      } else {\n        console.log('📊 Preview is deactivated - use preview:activate first')\n      }\n    },\n  })\n}\n","import GraphQL, { GraphQLOptions } from \"./datasources/GraphQL\"\nimport { IDataSource } from \"./types\"\nimport { resetDataSources, refreshDataSources } from \"./model/dataSourceManager\"\nimport { getAllDataSources, addDataSource } from \"./model/dataSourceRegistry\"\nimport { Editor } from \"grapesjs\"\n\nexport default (editor: Editor) => {\n  // Save and load data sources\n  editor.on('storage:start:store', (data: any) => {\n    data.dataSources = getAllDataSources()\n      .filter((ds: IDataSource) => typeof ds.readonly === 'undefined' || ds.readonly === false)\n      .map((ds: IDataSource) => ({\n        id: ds.id,\n        label: ds.label,\n        url: ds.url,\n        type: ds.type,\n        method: ds.method,\n        headers: ds.headers,\n        readonly: ds.readonly,\n        hidden: ds.hidden\n      }))\n  })\n\n  editor.on('storage:end:load', async (data: { dataSources: GraphQLOptions[] }) => {\n    // Connect the data sources\n    const newDataSources: IDataSource[] = (data.dataSources || [] as GraphQLOptions[])\n      .map((ds: GraphQLOptions) => new GraphQL(ds))\n\n    await Promise.all(newDataSources.map((ds: IDataSource) => ds.connect()))\n\n    // Get all data sources\n    const dataSources = getAllDataSources()\n      // Keep only data sources from the config\n      .filter((ds: IDataSource) => ds.readonly === true)\n\n    // Reset the data sources to the original config\n    resetDataSources(dataSources)\n\n    // Add the new data sources\n    await Promise.all(newDataSources.map(ds => {\n      addDataSource(ds)\n      return ds.connect()\n    }))\n    refreshDataSources()\n  })\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport const OPTIONS_STYLES = `\n  form {\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n    padding: 5px;\n    color: var(--ds-tertiary);\n    min-width: 300px;\n  }\n  form label {\n    text-align: left;\n    margin-top: 5px;\n  }\n  form .buttons {\n    display: flex;\n    justify-content: flex-end;\n    margin: 5px 0;\n    width: 100%;\n  }\n  form input {\n    padding: 4px;\n    background-color: transparent;\n    border-radius: 2px;\n    color: var(--ds-tertiary);\n    border: 1px solid rgba(0,0,0,.15);\n  }\n  form .buttons input {\n    margin-left: 5px;\n    cursor: pointer;\n    padding: 4px 10px;\n    background-color: var(--ds-button-bg);\n  }\n  form .buttons input[type=\"reset\"] {\n    border-color: transparent;\n  }\n  form .buttons input:hover {\n    color: var(--ds-primary);\n  }\n  form input.ds-expression-input__fixed {\n    color: black;\n  }\n`\nexport const PROPERTY_STYLES = `\n  :root {\n    --ds-primary: #d278c9;\n    --ds-secondary: #ddd;\n    --ds-tertiary: #3d3d3d;\n    --ds-highlight: #d278c9;\n    --ds-lowlight: #363636;\n    --ds-button-color: #fff;\n    --ds-button-bg: #606060;\n    --ds-button-border: var(--ds-button-bg);\n\n    --expression-input-dirty-background-color: var(--ds-lowlight);\n    --expression-input-dirty-border-color: var(--ds-lowlight);\n    --expression-input-dirty-color: var(--ds-highlight);\n    --expression-input-active-color: var(--ds-secondary);\n    --expression-input-active-background-color: var(--ds-button-bg);\n    --popin-dialog-background: var(--ds-secondary);\n    --popin-dialog-color: var(--ds-tertiary);\n    --popin-dialog-header-background: transparent;\n    --popin-dialog-body-background: transparent;\n    --popin-dialog-footer-background: transparent;\n    --expression-input-placeholder-margin: 0 10px;\n    --expression-input-item-button-margin: 0;\n    --expression-input-item-button-padding: 2px;\n    --expression-input-item-button-border-radius: 50%;\n    --expression-input-item-button-width: 20px;\n    --expression-input-item-button-height: 20px;\n    --expression-input-item-button-background-color: transparent;\n    --expression-input-item-button-color: var(--ds-button-color);\n    --expression-input-separator-color: var(--ds-button-color);\n    --expression-input-separator-font-size: 0.7em;\n    --expression-input-separator-margin: 0;\n    --expression-input-separator-padding: 0 3px 0 1px;\n    --expression-input-item-arrow-padding: 5px 5px 0 5px;\n    --expression-input-values-li-icon-margin-right: 0;\n    /*\n    --popin-dialog-header-color: #333;\n    --popin-dialog-body-color: #666;\n    --popin-dialog-footer-color: #333;\n    --popin-dialog-header-border-bottom: none;\n    --popin-dialog-footer-border-top: none;\n    --popin-dialog-header-padding: 0;\n    --popin-dialog-body-padding: 5px;\n    --popin-dialog-footer-padding: 0;\n    */\n  }\n  .ds-state-editor__options {\n    --ds-secondary: #363636;\n    --ds-tertiary: #ffffff;\n    --ds-lowlight: #ddd;\n    --ds-button-color: #606060;\n    --ds-button-bg: #fff;\n    --expression-input-dirty-background-color: var(--ds-lowlight);\n    --expression-input-dirty-border-color: var(--ds-lowlight);\n    --expression-input-dirty-color: var(--ds-highlight);\n    --expression-input-active-color: var(--ds-secondary);\n    --expression-input-active-background-color: var(--ds-button-bg);\n  }\n  .gjs-traits-label {\n    font-family: \"Ubuntu\", sans-serif;\n    font-size: 0.85rem;\n    padding: 9px 10px 9px 20px;\n    text-align: left;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  expression-input {\n    padding: 10px;\n    display: block;\n  }\n  expression-input::part(separator__delete) {\n    border-right: 1px solid var(--ds-button-border);\n    height: 20px;\n  }\n  expression-input::part(add-button) {\n    background-color: rgba(255,255,255,.15);\n    border-radius: 2px;\n    padding: 3px;\n    margin: 0;\n    border: 1px solid rgba(0,0,0,.15);\n    width: 24px;\n    height: 24px;\n    box-sizing: border-box;\n    cursor: pointer;\n  }\n  expression-input::part(delete-button) {\n    margin: 0;\n    padding: 0;\n    display: flex;\n    justify-content: center;\n    color: var(--ds-button);\n  }\n  expression-input::part(header) {\n    border: none;\n  }\n  expression-input::part(type) {\n    padding-bottom: 0;\n    padding-top: 4px;\n    display: none;\n  }\n  expression-input::part(name) {\n    font-weight: normal;\n    padding-bottom: 0;\n    padding-top: 0;\n    padding-left: 5px;\n  }\n  expression-input::part(property-input) {\n    padding: 4px;\n    border: medium;\n    flex: 1 1 auto;\n    background-color: transparent;\n    color: var(--ds-secondary);\n  }\n  expression-input::part(property-container) {\n    background-color: var(--ds-lowlight);\n    border-radius: 2px;\n    box-sizing: border-box;\n    padding: 5px;\n    margin: 5px 0;\n  }\n  expression-input::part(scroll-container) {\n    overflow: auto;\n    box-sizing: border-box;\n\n    /* inner shadow to make it visible when content is overflowing */\n    box-shadow: inset 0 0 5px 0 rgba(0,0,0,.2);\n\n  }\n  expression-input::part(steps-container) {\n    display: flex;\n    align-items: center;\n    background-color: rgba(0,0,0,.2);\n    border-radius: 2px;\n    padding: 5px;\n    margin: 5px 0;\n    width: max-content;\n    min-width: 100%;\n    box-sizing: border-box;\n  }\n  expression-input::part(dirty-icon) {\n    cursor: pointer;\n    margin: 0 10px;\n    color: var(--ds-highlight);\n  }\n  expression-input::part(dirty-icon) {\n    color: var(--ds-highlight);\n    vertical-align: bottom;\n    display: inline-flex;\n    margin: 0;\n  }\n  expression-input::part(expression-input-item) {\n    border: 1px solid rgba(0,0,0,.15);\n    background-color: rgba(255,255,255,.15);\n    border-radius: 2px;\n    margin-right: 5px;\n  }\n  .ds-section {\n    &:last-child {\n      margin-bottom: 100px;\n    }\n    details {\n      margin: 2px;\n      padding: 10px;\n      padding-top: 0;\n      background-color: transparent;\n      border-radius: 2px;\n      color: var(--ds-secondary);\n      text-align: left;\n    }\n    details[open] {\n      background-color: var(--ds-tertiary);\n    }\n    details summary {\n      color: var(--ds-secondary);\n      cursor: pointer;\n      padding: 10px 0;\n    }\n    details a {\n      color: var(--ds-link-color);\n    }\n    details .ds-states__help-link {\n      display: block;\n    }\n    .gjs-traits-label {\n      background-color: var(--ds-tertiary);\n    }\n    main {\n      display: flex;\n      flex-direction: column;\n    }\n    .ds-slot-fixed {\n      width: 100%;\n    }\n    select {\n      width: 150px;\n      flex: 0;\n      margin: 5px;\n      padding: 5px;\n      background-color: var(--ds-tertiary);\n      border-radius: 2px;\n      color: var(--ds-secondary);\n      border: 1px solid rgba(0,0,0,.15);\n      cursor: pointer;\n      font-size: medium;\n    }\n    input.ds-expression-input__fixed {\n      color: var(--ds-secondary);\n      padding: 10px;\n      border: none;\n      background-color: transparent;\n      width: 100%;\n      box-sizing: border-box;\n    }\n    .ds-expression-input__add {\n      max-width: 40px;\n      text-align: center;\n      font-size: large;\n      padding-right: 9px;\n      -webkit-appearance: none;\n      -moz-appearance: none;\n      text-indent: 1px;\n      text-overflow: '';\n    }\n    .ds-expression-input__add option {\n      font-size: medium;\n    }\n    .ds-expression-input__options-button {\n      background-color: transparent;\n      border: none;\n      color: var(--ds-secondary);\n      cursor: pointer;\n      padding: 0;\n      margin: 10px;\n      margin-left: 0;\n    }\n    label.ds-label {\n      display: flex;\n      align-items: center;\n      padding: 10px;\n      color: var(--ds-secondary);\n    }\n    label.ds-label--disabled {\n      justify-content: space-between;\n    }\n    label.ds-label--disabled .ds-label__message {\n      opacity: .5;\n    }\n    select.ds-visibility__condition-operator {\n      margin: 10px;\n    }\n  }\n  /* States CSS Styles */\n  .ds-states {\n    display: flex;\n    flex-direction: column;\n  }\n    .ds-states__buttons {\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      margin: 0 5px;\n    }\n    .ds-states__button {\n      cursor: pointer;\n      border: 1px solid var(--ds-button-border);\n      border-radius: 2px;\n      padding: 5px;\n      background: var(--ds-button-bg);\n      color: var(--ds-button-color);\n      flex: 1;\n      margin: 5px;\n      max-width: 40px;\n    }\n    .ds-states__button--disabled {\n      opacity: 0.5;\n      cursor: default;\n    }\n    .ds-states__remove-button {\n      margin-left: 1em;\n    }\n    .ds-states__sep {\n      width: 100%;\n      border: none;\n      height: 1px;\n      background: var(--ds-button-bg);\n    }\n  /* real data */\n  .ds-real-data {\n    code {\n      overflow-x: hidden;\n      text-wrap: nowrap;\n      display: block;\n      padding: 0 10px;\n      text-overflow: ellipsis;\n      margin-top: -5px;\n      margin-bottom: 10px;\n      text-align: right;\n    }\n    .ds-real-data__preview-index {\n      display: flex;\n      input {\n        margin: 10px;\n      }\n      input[type=\"range\"] {\n        flex-grow: 1;\n      }\n      input[type=\"number\"] {\n        color: white;\n        background-color: var(--ds-lowlight);\n        border-radius: 2px;\n        box-sizing: border-box;\n        margin: 10px;\n        border: none;\n        padding: 5px;\n        padding-left: 10px;\n      }\n    }\n  }\n`\n","import{_$LH as o}from\"./lit-html.js\";\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{I:t}=o,i=o=>null===o||\"object\"!=typeof o&&\"function\"!=typeof o,n={HTML:1,SVG:2,MATHML:3},e=(o,t)=>void 0===t?void 0!==o?._$litType$:o?._$litType$===t,l=o=>null!=o?._$litType$?.h,c=o=>void 0!==o?._$litDirective$,d=o=>o?._$litDirective$,f=o=>void 0===o.strings,s=()=>document.createComment(\"\"),r=(o,i,n)=>{const e=o._$AA.parentNode,l=void 0===i?o._$AB:i._$AA;if(void 0===n){const i=e.insertBefore(s(),l),c=e.insertBefore(s(),l);n=new t(i,c,o,o.options)}else{const t=n._$AB.nextSibling,i=n._$AM,c=i!==o;if(c){let t;n._$AQ?.(o),n._$AM=o,void 0!==n._$AP&&(t=o._$AU)!==i._$AU&&n._$AP(t)}if(t!==l||c){let o=n._$AA;for(;o!==t;){const t=o.nextSibling;e.insertBefore(o,l),o=t}}}return n},v=(o,t,i=o)=>(o._$AI(t,i),o),u={},m=(o,t=u)=>o._$AH=t,p=o=>o._$AH,M=o=>{o._$AP?.(!1,!0);let t=o._$AA;const i=o._$AB.nextSibling;for(;t!==i;){const o=t.nextSibling;t.remove(),t=o}},h=o=>{o._$AR()};export{n as TemplateResultType,h as clearPart,p as getCommittedValue,d as getDirectiveClass,r as insertPart,l as isCompiledTemplateResult,c as isDirectiveResult,i as isPrimitive,f as isSingleExpression,e as isTemplateResult,M as removePart,v as setChildPartValue,m as setCommittedValue};\n//# sourceMappingURL=directive-helpers.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},e=t=>(...e)=>({_$litDirective$:t,values:e});class i{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}export{i as Directive,t as PartType,e as directive};\n//# sourceMappingURL=directive.js.map\n","import{isSingleExpression as i}from\"./directive-helpers.js\";import{Directive as t,PartType as e}from\"./directive.js\";export{directive}from\"./directive.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const s=(i,t)=>{const e=i._$AN;if(void 0===e)return!1;for(const i of e)i._$AO?.(t,!1),s(i,t);return!0},o=i=>{let t,e;do{if(void 0===(t=i._$AM))break;e=t._$AN,e.delete(i),i=t}while(0===e?.size)},r=i=>{for(let t;t=i._$AM;i=t){let e=t._$AN;if(void 0===e)t._$AN=e=new Set;else if(e.has(i))break;e.add(i),c(t)}};function h(i){void 0!==this._$AN?(o(this),this._$AM=i,r(this)):this._$AM=i}function n(i,t=!1,e=0){const r=this._$AH,h=this._$AN;if(void 0!==h&&0!==h.size)if(t)if(Array.isArray(r))for(let i=e;i<r.length;i++)s(r[i],!1),o(r[i]);else null!=r&&(s(r,!1),o(r));else s(this,i)}const c=i=>{i.type==e.CHILD&&(i._$AP??=n,i._$AQ??=h)};class f extends t{constructor(){super(...arguments),this._$AN=void 0}_$AT(i,t,e){super._$AT(i,t,e),r(this),this.isConnected=i._$AU}_$AO(i,t=!0){i!==this.isConnected&&(this.isConnected=i,i?this.reconnected?.():this.disconnected?.()),t&&(s(this,i),o(this))}setValue(t){if(i(this._$Ct))this._$Ct._$AI(t,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=t,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}}export{f as AsyncDirective,t as Directive,e as PartType};\n//# sourceMappingURL=async-directive.js.map\n","import{nothing as t}from\"../lit-html.js\";import{AsyncDirective as i}from\"../async-directive.js\";import{directive as s}from\"../directive.js\";\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const e=()=>new h;class h{}const o=new WeakMap,n=s(class extends i{render(i){return t}update(i,[s]){const e=s!==this.G;return e&&void 0!==this.G&&this.rt(void 0),(e||this.lt!==this.ct)&&(this.G=s,this.ht=i.options?.host,this.rt(this.ct=i.element)),t}rt(t){if(this.isConnected||(t=void 0),\"function\"==typeof this.G){const i=this.ht??globalThis;let s=o.get(i);void 0===s&&(s=new WeakMap,o.set(i,s)),void 0!==s.get(this.G)&&this.G.call(this.ht,void 0),s.set(this.G,t),void 0!==t&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){return\"function\"==typeof this.G?o.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});export{e as createRef,n as ref};\n//# sourceMappingURL=ref.js.map\n","import{noChange as e}from\"../lit-html.js\";import{directive as s,Directive as t,PartType as r}from\"../directive.js\";import{getCommittedValue as l,setChildPartValue as o,insertPart as i,removePart as n,setCommittedValue as f}from\"../directive-helpers.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst u=(e,s,t)=>{const r=new Map;for(let l=s;l<=t;l++)r.set(e[l],l);return r},c=s(class extends t{constructor(e){if(super(e),e.type!==r.CHILD)throw Error(\"repeat() can only be used in text expressions\")}dt(e,s,t){let r;void 0===t?t=s:void 0!==s&&(r=s);const l=[],o=[];let i=0;for(const s of e)l[i]=r?r(s,i):i,o[i]=t(s,i),i++;return{values:o,keys:l}}render(e,s,t){return this.dt(e,s,t).values}update(s,[t,r,c]){const d=l(s),{values:p,keys:a}=this.dt(t,r,c);if(!Array.isArray(d))return this.ut=a,p;const h=this.ut??=[],v=[];let m,y,x=0,j=d.length-1,k=0,w=p.length-1;for(;x<=j&&k<=w;)if(null===d[x])x++;else if(null===d[j])j--;else if(h[x]===a[k])v[k]=o(d[x],p[k]),x++,k++;else if(h[j]===a[w])v[w]=o(d[j],p[w]),j--,w--;else if(h[x]===a[w])v[w]=o(d[x],p[w]),i(s,v[w+1],d[x]),x++,w--;else if(h[j]===a[k])v[k]=o(d[j],p[k]),i(s,d[x],d[j]),j--,k++;else if(void 0===m&&(m=u(a,k,w),y=u(h,x,j)),m.has(h[x]))if(m.has(h[j])){const e=y.get(a[k]),t=void 0!==e?d[e]:null;if(null===t){const e=i(s,d[x]);o(e,p[k]),v[k]=e}else v[k]=o(t,p[k]),i(s,d[x],t),d[e]=null;k++}else n(d[j]),j--;else n(d[x]),x++;for(;k<=w;){const e=i(s,v[w+1]);o(e,p[k]),v[k++]=e}for(;x<=j;){const e=d[x++];null!==e&&n(e)}return this.ut=a,f(s,v),e}});export{c as repeat};\n//# sourceMappingURL=repeat.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=t=>(e,o)=>{void 0!==o?o.addInitializer((()=>{customElements.define(t,e)})):customElements.define(t,e)};export{t as customElement};\n//# sourceMappingURL=custom-element.js.map\n","import{defaultConverter as t,notEqual as e}from\"../reactive-element.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const o={attribute:!0,type:String,converter:t,reflect:!1,hasChanged:e},r=(t=o,e,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(void 0===s&&globalThis.litPropertyMetadata.set(i,s=new Map),\"setter\"===n&&((t=Object.create(t)).wrapped=!0),s.set(r.name,t),\"accessor\"===n){const{name:o}=r;return{set(r){const n=e.get.call(this);e.set.call(this,r),this.requestUpdate(o,n,t)},init(e){return void 0!==e&&this.C(o,void 0,t,e),e}}}if(\"setter\"===n){const{name:o}=r;return function(r){const n=this[o];e.call(this,r),this.requestUpdate(o,n,t)}}throw Error(\"Unsupported decorator location: \"+n)};function n(t){return(e,o)=>\"object\"==typeof o?r(t,e,o):((t,e,o)=>{const r=e.hasOwnProperty(o);return e.constructor.createProperty(o,t),r?Object.getOwnPropertyDescriptor(e,o):void 0})(t,e,o)}export{n as property,r as standardProperty};\n//# sourceMappingURL=property.js.map\n","import { createRef, Ref, ref } from 'lit/directives/ref.js'\nimport {repeat} from 'lit/directives/repeat.js'\nimport GraphQL, { GraphQLOptions } from '../datasources/GraphQL'\nimport { DATA_SOURCE_CHANGED, DATA_SOURCE_DATA_LOAD_END, DATA_SOURCE_ERROR, DATA_SOURCE_READY, DataSourceEditorViewOptions, IDataSource } from '../types'\nimport { getDefaultOptions, getElementFromOption } from '../utils'\nimport { getAllDataSources, addDataSource, removeDataSource } from '../model/dataSourceRegistry'\nimport { css, html, LitElement, render } from 'lit'\nimport { property } from 'lit/decorators.js'\nimport { Editor } from 'grapesjs'\n\nconst COMMON_STYLES = css`\n    :host {\n      font-family: var(--gjs-main-font);\n      font-size: var(--gjs-font-size);\n    }\n    .ds-field {\n      padding: 10px;\n    }\n    .ds-field > span {\n      display: block;\n    }\n    hr.ds-separator {\n      border: none;\n      border-top: 1px solid var(--ds-button-bg);\n    }\n    .ds-field input,\n    .ds-field select {\n      background-color: var(--gjs-main-dark-color);\n      border: none;\n      box-shadow: none;\n      border-radius: 2px;\n      box-sizing: border-box;\n      padding: 0;\n      position: relative;\n\n      padding: 10px;\n      color: inherit;\n      width: 100%;\n    }\n    .ds-btn-prim {\n      color:inherit;\n      background-color:var(--gjs-main-light-color);\n      border-radius:2px;\n      padding:3px 6px;\n      padding:var(--gjs-input-padding);\n      cursor:pointer;\n      border:none\n    }\n    .ds-btn-prim:active {\n      background-color:var(--gjs-main-light-color)\n    }\n    .ds-btn-danger {\n      color: var(--gjs-light-color);\n      background-color: transparent;\n    }\n    .ds-btn-danger:hover {\n      color: var(--ds-highlight);\n    }\n    [disabled],\n    [readonly] {\n      font-style: italic;\n    }\n`\n\nexport default (editor: Editor, options: Partial<DataSourceEditorViewOptions> = {}) => {\n  // Settings dialog\n  if (options.settingsEl) {\n    // Get the container element for the UI\n    const settingsEl = getElementFromOption(options.settingsEl, 'options.settingsEl')\n    const dsSettings: Ref<SettingsDataSources> = createRef()\n    editor.on(`${DATA_SOURCE_CHANGED} ${DATA_SOURCE_ERROR} ${DATA_SOURCE_READY} ${DATA_SOURCE_DATA_LOAD_END}`, () => {\n      if(dsSettings.value) {\n        dsSettings.value.dataSources = [...getAllDataSources()]\n        dsSettings.value.requestUpdate()\n      } else {\n        renderSettings(editor, dsSettings, settingsEl)\n      }\n    })\n    renderSettings(editor, dsSettings, settingsEl)\n  }\n}\n\nfunction renderSettings(editor: Editor, dsSettings: Ref, settingsEl: HTMLElement) {\n  render(html`\n    <ds-settings\n      ${ref(dsSettings)}\n      .dataSources=${[]}\n      @change=${(e: CustomEvent) => {\n    const ds = e.detail as IDataSource\n    // Handle data source changes - this may need to be reimplemented\n    // depending on how the data source update logic should work\n    console.log('Data source changed:', ds)\n  }}\n      @add=${(e: CustomEvent) => {\n    const ds = e.detail as GraphQLOptions\n    const newDS = new GraphQL(ds)\n    addDataSource(newDS)\n  }}\n      @add-top=${(e: CustomEvent) => {\n    const ds = e.detail as GraphQLOptions\n    const newDS = new GraphQL(ds)\n    addDataSource(newDS)\n  }}\n      @delete=${(e: CustomEvent) => {\n    const ds = e.detail as IDataSource\n    removeDataSource(ds)\n  }}\n      ></ds-settings>\n  `, settingsEl)\n}\n\n/**\n * <ds-settings> is a web component that renders the settings dialog for the DataSourceEditor plugin\n */\nclass SettingsDataSources extends LitElement {\n\n  @property({ type: Array })\n    dataSources: IDataSource[]\n\n  constructor() {\n    super()\n    this.dataSources = []\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n  }\n\n  static styles = [\n    COMMON_STYLES,\n    css`\n      .ds-btn-prim--large {\n        padding: 10px;\n        margin: auto;\n        display: block;\n      }\n      .ds-btn-prim--icon {\n        background-color: var(--ds-primary);\n        position: absolute;\n        right: 20px;\n      }\n    `,\n  ]\n\n  protected render() {\n    const dsDataSource: Ref<SettingsDataSources> = createRef()\n    const options: GraphQLOptions = getDefaultOptions(this.dataSources.length.toString())\n    return html`\n    <section>\n    <!--\n      <button\n        type=\"button\"\n        class=\"ds-btn-prim ds-btn-prim--icon\"\n        @click=${() => {\n    this.dispatchEvent(new CustomEvent('add-top', { detail: options }))\n  }}>\\u2795</button>\n    -->\n      <hr class=\"ds-separator\">\n      ${repeat(this.dataSources.filter(ds => !ds.hidden), (ds: IDataSource) => ds.id, (ds: IDataSource) => html`\n        <ds-settings__data-source\n          ${ref(dsDataSource)}\n          .dataSource=${ds}\n          @change=${(e: CustomEvent) => {\n    e.preventDefault()\n    e.stopImmediatePropagation()\n    this.dispatchEvent(new CustomEvent('change', { detail: ds }))\n  }}\n          @delete=${() => {\n    this.dispatchEvent(new CustomEvent('delete', { detail: ds }))\n  }}\n          ></ds-settings__data-source>\n          <hr class=\"ds-separator\">\n      `)}\n      <button\n        type=\"button\"\n        class=\"ds-btn-prim ds-btn-prim--large\"\n        @click=${() => {\n    this.dispatchEvent(new CustomEvent('add', { detail: options }))\n  }}>Add a Data Source</button>\n    </section>\n    `\n  }\n}\n\nif(!customElements.get('ds-settings')) {\n  customElements.define('ds-settings', SettingsDataSources)\n}\n\n\nclass SettingsDataSource extends LitElement {\n  @property({ type: Object })\n    dataSource: IDataSource | null\n  errorMessage: string = ''\n  connected: boolean = false\n\n  constructor() {\n    super()\n    this.dataSource = null\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n  }\n\n  connectDataSource() {\n    if(!this.dataSource) throw new Error('No data source provided')\n    this.dataSource.connect().then(() => {\n      this.dispatchEvent(new CustomEvent('change'))\n      this.errorMessage = ''\n      this.connected = true\n      this.requestUpdate()\n    }).catch((err: Error) => {\n      console.error('Data source connection error', { err })\n      this.errorMessage = err.message\n      this.connected = false\n      this.requestUpdate()\n    })\n  }\n\n  static styles = [\n    css`\n    form {\n      display: flex;\n      flex-direction: column;\n      align-items: stretch;\n    }\n    form :focus {\n      outline: 1px solid var(--ds-highlight);\n    }\n    .ds-field--large {\n      flex: 1 1 auto;\n    }\n    .ds-property__wrapper {\n      display: flex;\n      flex-direction: column;\n      width: 100%;\n      flex-wrap: wrap;\n    }\n    .ds-property__wrapper--horiz {\n      flex-direction: row;\n    }\n    .ds-property__wrapper--vert {\n      flex-direction: column;\n    }\n    .ds-button-bar {\n      display: flex;\n      justify-content: space-between;\n    }\n    .ds-no-resize {\n      flex: 0 0 auto;\n    }\n    `,\n    COMMON_STYLES,\n  ]\n\n  protected render() {\n    if(!this.dataSource) throw new Error('No data source provided')\n    const dsHeaders: Ref<SettingsHeaders> = createRef()\n    return html`\n    <form\n      ?readonly=${this.dataSource.readonly !== false}\n      @submit=${(e: Event) => {\n    e.preventDefault()\n    e.stopImmediatePropagation()\n    this.connectDataSource()\n  }}\n      >\n      <h3 class=\"ds-property__title\">\n        ${this.dataSource.label || 'Unnamed'}\n        <small>${this.dataSource.readonly !== false ? ' (Read-only)' : ''}</small>\n      </h3>\n      <div class=\"ds-property__wrapper ds-property__wrapper--horiz\">\n      <label class=\"ds-field\">\n        <span>Label</span>\n        <input\n          type=\"text\"\n          name=\"label\"\n          value=${this.dataSource.label}\n          @input=${(e: Event) => {\n    if (this.dataSource) this.dataSource.label = (e.target as HTMLInputElement).value\n    // Update the label in the title\n    this.requestUpdate()\n  }}\n          ?readonly=${this.dataSource.readonly !== false}\n          />\n      </label>\n      <label class=\"ds-field ds-field--large\">\n        <span>URL</span>\n        <input\n          type=\"url\"\n          name=\"url\"\n          value=${this.dataSource.url}\n          @change=${(e: Event) => { if (this.dataSource) this.dataSource.url = (e.target as HTMLInputElement).value }}\n          ?readonly=${this.dataSource.readonly !== false}\n          />\n      </label>\n      <label class=\"ds-field\">\n        <span>ID</span>\n        <input\n          type=\"text\"\n          name=\"id\"\n          value=${this.dataSource.id}\n          readonly\n          disabled\n          />\n      </label>\n      <label class=\"ds-field\">\n        <span>Type</span>\n        <select\n          name=\"type\"\n          readonly\n          disabled\n          >\n          <option value=\"graphql\" selected>GraphQL</option>\n        </select>\n      </label>\n      <label class=\"ds-field\">\n        <span>Method</span>\n        <select\n          name=\"method\"\n          @change=${(e: Event) => { if (this.dataSource) this.dataSource.method = (e.target as HTMLInputElement).value as 'GET' | 'POST' }}\n          ?readonly=${this.dataSource.readonly !== false}\n          ?disabled=${this.dataSource.readonly !== false}\n          >\n          <option value=\"POST\" ?selected=${this.dataSource.method === 'POST'}>POST</option>\n          <option value=\"GET\" ?selected=${this.dataSource.method === 'GET'}>GET</option>\n        </select>\n      </label>\n      </div>\n      <div class=\"ds-field\">\n        <details>\n          <summary>HTTP Headers</summary>\n          <ds-settings__headers\n            ${ref(dsHeaders)}\n            .headers=${this.dataSource.headers}\n            @change=${() => {\n    if (this.dataSource) this.dataSource.headers = dsHeaders.value?.headers || {}\n    dsHeaders.value?.requestUpdate()\n  }}\n            ?readonly=${this.dataSource.readonly !== false}\n            ></ds-settings__headers>\n        </details>\n        <div class=\"ds-field ds-button-bar\">\n          <div>\n            <div>\n              <p>Status: ${this.dataSource.isConnected() ? '\\u2713 Connected' : '\\u2717 Unknown'}</p>\n              <p>${this.errorMessage}</p>\n            </div>\n          </div>\n          <div class=\"ds-no-resize\">\n            <div>\n              ${this.dataSource.readonly !== false ? '' : html`\n                <button\n                  type=\"button\"\n                  class=\"ds-btn-prim ds-btn-danger\"\n                  @click=${() => {\n    this.dispatchEvent(new CustomEvent('delete'))\n  }}\n                >Delete</button>\n              `}\n              <button\n                type=\"submit\"\n                class=\"ds-btn-prim ds-btn-primary\"\n                >Test connection</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </form>\n    `\n  }\n}\n\nif(!customElements.get('ds-settings__data-source')) {\n  customElements.define('ds-settings__data-source', SettingsDataSource)\n}\n\nclass SettingsHeaders extends LitElement {\n  @property({ type: Array })\n    headers: Record<string, string>\n\n  @property({ type: Boolean })\n    readonly: boolean\n\n  static styles = [\n    css`\n    fieldset {\n      display: block;\n      border: none;\n      padding: 0;\n    }\n    ul {\n      list-style: none;\n      padding: 0;\n    }\n    ul > li {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n    }\n    ul > li > label {\n      flex: 1 1 auto;\n    }\n    ul > li > button {\n      margin: 10px;\n    }\n    `,\n    COMMON_STYLES,\n  ]\n\n  constructor() {\n    super()\n    this.headers = {}\n    this.readonly = false\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n  }\n\n  protected render() {\n    return html`\n      <div class=\"ds-field\">\n      <fieldset>\n      ${this.readonly ? '' : html`\n        <button\n          type=\"button\"\n          class=\"ds-btn-prim\"\n          @click=${() => {\n    // Default name and value\n    let name = 'Authorization'\n    let value = 'Bearer XXXXXX'\n    // Make sure the header name is unique\n    // Add a number if the header already exists\n    let i = 0\n    while(typeof this.headers[name] !== 'undefined') {\n      i++\n      name = `Header ${i}`\n      value = ''\n    }\n    // Add the header\n    this.headers = {\n      ...this.headers,\n      [name]: value,\n    }\n    this.dispatchEvent(new CustomEvent('change'))\n  }}\n        >Add a header</button>\n      `}\n      <ul>\n        ${Object.entries(this.headers).map(([name, value]) => html`\n          <li>\n            <label class=\"ds-field\">\n              <span>Name</span>\n              <input\n                type=\"text\"\n                value=${name}\n                name=${`header-key-${encodeURI(name)}`}\n                @change=${(e: Event) => {\n    const target = e.target as HTMLInputElement\n    if(!target.value) return\n    if (typeof this.headers[name] !== 'undefined') delete this.headers[name]\n    this.headers[target.value] = value\n    this.dispatchEvent(new CustomEvent('change'))\n  }}\n                />\n            </label>\n            <label class=\"ds-field\">\n              <span>Value</span>\n              <input\n                type=\"text\"\n                value=${value}\n                name=${`header-value-${encodeURI(value)}`}\n                @change=${(e: Event) => {\n    const target = e.target as HTMLInputElement\n    this.headers[name] = target.value\n    this.dispatchEvent(new CustomEvent('change'))\n  }}\n                />\n            </label>\n            ${this.readonly ? '' : html`\n              <button\n                type=\"button\"\n                class=\"ds-btn-prim\"\n                @click=${() => {\n    if (typeof this.headers[name] !== 'undefined') delete this.headers[name]\n    this.dispatchEvent(new CustomEvent('change'))\n  }}\n                .disabled=${this.readonly}\n              >Delete</button>\n            `}\n          </li>\n        `)}\n      </ul>\n      </fieldset>\n      </div>\n    `\n  }\n}\n\nif(!customElements.get('ds-settings__headers')) {\n  customElements.define('ds-settings__headers', SettingsHeaders)\n}\n","import{noChange as t}from\"../lit-html.js\";import{directive as s,Directive as i,PartType as r}from\"../directive.js\";\n/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const e=s(class extends i{constructor(t){if(super(t),t.type!==r.ATTRIBUTE||\"class\"!==t.name||t.strings?.length>2)throw Error(\"`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.\")}render(t){return\" \"+Object.keys(t).filter((s=>t[s])).join(\" \")+\" \"}update(s,[i]){if(void 0===this.st){this.st=new Set,void 0!==s.strings&&(this.nt=new Set(s.strings.join(\" \").split(/\\s/).filter((t=>\"\"!==t))));for(const t in i)i[t]&&!this.nt?.has(t)&&this.st.add(t);return this.render(i)}const r=s.element.classList;for(const t of this.st)t in i||(r.remove(t),this.st.delete(t));for(const t in i){const s=!!i[t];s===this.st.has(t)||this.nt?.has(t)||(s?(r.add(t),this.st.add(t)):(r.remove(t),this.st.delete(t)))}return t}});export{e as classMap};\n//# sourceMappingURL=class-map.js.map\n","import { css } from 'lit';\nexport const inputChainStyles = css `\n  .header,\n  ::part(header) {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n  }\n  .fixed .hide-when-fixed,\n  .show-when-fixed {\n    visibility: hidden;\n    position: absolute;\n    top: -9999px;\n    left: -9999px;\n    display: none;\n  }\n  .fixed .show-when-fixed {\n    visibility: visible;\n    position: static;\n    display: block;\n  }\n  label {\n    width: 100%;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-size: var(--input-chain-label-font-size, 1rem);\n  }\n  .dirty {\n    color: var(--expression-input-dirty-color, red);\n    cursor: pointer;\n  }\n  .fixed,\n  ::part(fixed) {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n    overflow-x: auto;\n    width: 100%;\n  }\n  .dirty-icon,\n  ::part(dirty-icon) {\n    display: inline-block;\n    width: 1rem;\n  }\n  .property-container,\n  ::part(property-container) {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n    overflow-x: auto;\n    padding: 10px;\n    scrollbar-width: thin;\n    scrollbar-color: var(--expression-input-active-color, #333)\n      var(--expression-input-active-background-color, #eee);\n  }\n  .fixed-selector,\n  ::part(fixed-selector) {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    border: 1px solid var(--expression-input-dirty-border-color, #ccc);\n    background-color: var(--expression-input-dirty-background-color, #ccc);\n    border-radius: var(--expression-input-dirty-border-radius, 3px);\n    padding: 3px;\n  }\n  ul[slot='tags'] {\n    margin: 0;\n    padding: 0;\n    list-style: none;\n  }\n  /* an arrow between elements */\n  .steps-container__separator {\n    display: inline;\n  }\n  .steps-container__separator::after {\n    content: '▶';\n    color: var(--expression-input-separator-color, #333);\n    font-size: var(--expression-input-separator-font-size, 1.5em);\n    margin: var(--expression-input-separator-margin, 0);\n    padding: var(--expression-input-separator-padding, 0);\n  }\n  /* selector between fixed value (text input) and steps */\n  .fixed-selector span {\n    padding: 4px 4px 2px 4px;\n    font-size: small;\n  }\n  .fixed-selector span:not(.active):hover {\n    color: var(--expression-input-dirty-color, #0091ff);\n  }\n  .fixed-selector span:not(.active) {\n    cursor: pointer;\n  }\n  .fixed-selector span:last-child {\n    margin-left: 5px;\n  }\n  .fixed-selector span.active {\n    border-radius: var(--expression-input-active-border-radius, 3px);\n    background-color: var(--expression-input-active-background-color, #eee);\n    color: var(--expression-input-active-color, #333);\n    cursor: default;\n  }\n  ul.values-ul {\n    list-style: none;\n    padding: var(--expression-input-values-ul-padding, 0);\n    margin: var(--expression-input-values-ul-margin, 0);\n    color: var(--expression-input-values-ul-color, #000);\n    background-color: var(\n      --expression-input-values-ul-background-color,\n      transparent\n    );\n  }\n  li.values-li {\n    padding: var(--expression-input-values-li-padding, 5px);\n    margin: var(--expression-input-values-li-margin, 0);\n    background-color: var(\n      --expression-input-values-li-background-color,\n      transparent\n    );\n    border-bottom: var(--expression-input-values-li-border, 1px solid #ccc);\n    cursor: pointer;\n    display: flex;\n    justify-content: space-between;\n  }\n  li.values-li:last-child {\n    border-bottom: none;\n  }\n  li.values-li:hover {\n    background-color: var(\n      --expression-input-values-li-hover-background-color,\n      #eee\n    );\n  }\n  li.values-li.active {\n    background-color: var(\n      --expression-input-values-li-active-background-color,\n      #ccc\n    );\n    font-weight: var(--expression-input-values-li-active-font-weight, bold);\n  }\n  li.values-li.values__title {\n    /* Display this line as an array title */\n    color: var(--expression-input-values-li-title-color, #333);\n    background-color: var(--expression-input-values-li-background-color, #eee);\n    text-transform: var(\n      --expression-input-values-li-title-text-transform,\n      uppercase\n    );\n    cursor: default;\n  }\n  li.values-li.values__title .values__name {\n    margin: var(--expression-input-values-li-title-margin, auto);\n  }\n  li.values-li .values__icon {\n    margin-right: var(--expression-input-values-li-icon-margin-right, 5px);\n  }\n  li.values-li .values__name {\n    margin-right: var(--expression-input-values-li-name-margin-right, 25px);\n  }\n  li.values-li .values__type {\n    color: var(--expression-input-values-li-type-color, #999);\n    width: max-content;\n  }\n  .placeholder > * {\n    color: var(--expression-input-placeholder-color, #999);\n    font-style: var(--expression-input-placeholder-font-style, italic);\n    margin: var(--expression-input-placeholder-margin, 10px 0);\n  }\n`;\nexport const stepsSelectorItemStyles = css `\n  :host {\n    display: inline-flex;\n    flex-direction: column;\n    flex-shrink: 0;\n  }\n  :host header {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    border: solid 1px gray;\n  }\n  :host .value {\n    display: flex;\n    align-items: center;\n  }\n  :host .buttons {\n    display: flex;\n    align-items: center;\n  }\n  :host .button {\n    border: none;\n    background-color: transparent;\n  }\n  :host .svg-icon {\n    border: var(--expression-input-item-button-border, none);\n    cursor: pointer;\n    margin: var(--expression-input-item-button-margin, 3px);\n    padding: var(--expression-input-item-button-padding, 3px);\n    border-radius: var(--expression-input-item-button-border-radius, 50%);\n    width: var(--expression-input-item-button-width, 20px);\n    height: var(--expression-input-item-button-height, 20px);\n    background-color: var(\n      --expression-input-item-button-background-color,\n      transparent\n    );\n  }\n  /* button svg path white and size 10px\n  */\n  :host .svg-icon svg path {\n    fill: var(--expression-input-item-button-color, #333);\n  }\n  /*\n  :host popin-form {\n    position: absolute;\n  }\n  */\n  slot[name='helpTitle'] {\n    display: flex;\n    align-items: center;\n    width: 20px;\n    height: 20px;\n  }\n  slot[name='name'] {\n    font-weight: bold;\n    cursor: pointer;\n  }\n  ::slotted([slot='name']),\n  ::slotted([slot='type']) {\n    cursor: pointer;\n    flex-shrink: 0;\n  }\n  ::slotted([slot='name']) {\n    font-weight: var(--expression-input-item-name-font-weight, bold);\n    font-size: var(--expression-input-item-name-font-size, 1rem);\n    padding: var(--expression-input-item-name-padding, 5px);\n  }\n  ::slotted([slot='type']),\n  ::slotted([slot='type']) {\n    font-weight: var(--expression-input-item-type-font-weight, normal);\n    font-size: var(--expression-input-item-type-font-size, 0.8rem);\n    padding: var(--expression-input-item-type-padding, 5px);\n  }\n  .with-arrow::after {\n    content: '▼';\n    float: right;\n    padding: var(--expression-input-item-arrow-padding, 5px);\n  }\n`;\nexport const popinStyles = css `\n  :host {\n    display: inline-block;\n    position: fixed;\n    max-width: 100vw;\n    max-height: 80vh;\n    box-sizing: border-box;\n    z-index: 1000; /* Ensure it's on top of other content */\n    border-radius: var(--popin-form-border-radius, 3px);\n    overflow: hidden; /* To ensure border-radius applies to children elements */\n    overflow-y: auto;\n    outline: none;\n    border: var(--popin-form-border, 1px solid #ccc);\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n    display: inline-flex;\n    flex-direction: column;\n    background-color: var(--popin-form-background, #fff);\n    color: var(--popin-form-color, #000);\n  }\n  :host([hidden]) {\n    display: none !important;\n  }\n\n  header {\n    border-bottom: var(--popin-form-header-border-bottom, #f5f5f5);\n    background-color: var(--popin-form-header-background, transparent);\n    padding: var(--popin-form-header-padding, 0);\n    color: var(--popin-form-header-color, #000);\n  }\n\n  footer {\n    border-top: var(--popin-form-footer-border-top, 1px solid #f5f5f5);\n    display: flex;\n    justify-content: flex-end;\n    background-color: var(--popin-form-footer-background, transparent);\n    padding: var(--popin-form-footer-padding);\n    color: var(--popin-form-footer-color, #000);\n  }\n\n  button {\n    border: var(--popin-button-border, 1px solid #ccc);\n    border-radius: var(--popin-button-border-radius, 3px);\n    background-color: var(--popin-button-background, #f5f5f5);\n    color: var(--popin-button-color, #000);\n    padding: var(--popin-button-padding, 5px);\n    margin: var(--popin-button-margin, 5px);\n    cursor: pointer;\n  }\n\n  button:hover {\n    background-color: var(--popin-button-hover-background, #eee);\n    color: var(--popin-button-hover-color, #000);\n    border: var(--popin-button-border, 1px solid #ccc);\n    padding: var(--popin-button-hover-padding, 5px);\n    margin: var(--popin-button-hover-margin, 5px);\n  }\n\n  button.secondary {\n    background-color: var(--popin-button-background--secondary, transparent);\n    color: var(--popin-button-color--secondary, #000);\n    border: var(--popin-button-border--secondary, none);\n    padding: var(--popin-button-padding--secondary, 5px);\n    margin: var(--popin-button-margin--secondary, 5px);\n  }\n\n  button.secondary:hover {\n    background-color: var(--popin-button-hover-background--secondary, #eee);\n    color: var(--popin-button-hover-color--secondary, #000);\n    border: var(--popin-button-hover-border--secondary, none);\n    padding: var(--popin-button-hover-padding--secondary, 5px);\n    margin: var(--popin-button-hover-margin--secondary, 5px);\n  }\n\n  main {\n    background-color: var(--popin-form-body-background, transparent);\n    padding: var(--popin-form-body-padding, 5px);\n    color: var(--popin-form-body-color, #000);\n    display: flex;\n    flex-direction: column;\n  }\n\n  ::slotted([slot='header']) {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n  }\n  ::slotted([slot='body']) * {\n    background: red !important;\n  }\n`;\n//# sourceMappingURL=styles.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { LitElement, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { inputChainStyles } from './styles.js';\n/**\n * @element input-chain\n * Web component to select a sequence of steps, each step being a <select> element.\n *\n * Children are expected to be input or select html elements\n *\n * Features\n * - Nested Select Elements: Allows embedding <select> elements as children.\n * - Dynamic Interaction: Automatically updates subsequent select elements upon a change in any select element, resetting them to a default state.\n * - Event Handling: Emits change events whenever the value of a child select element changes.\n * - Validation Support: Supports form validation attributes like required, minlength, and maxlength.\n * - Combined Options Property: Holds a property with a concatenation of all options from child select elements.\n * - Supports option groups: Allows grouping options in the same select element.\n *\n * It has these events:\n * - [x] change\n *\n * It has these attributes:\n * - [x] name for form submission\n * - [x] for (form id)\n * - [x] reactive (the parent app needs to update the options on change)\n * - [x] select-tag-name (default: select) to change the tag name of the select elements\n * - [x] option-tag-name (default: option) to change the tag name of the option elements\n * - [ ] required\n * - [ ] maxlength\n * - [ ] minlength\n *\n * It has these properties:\n * - [x] options: a concatenation of all options from child select elements\n *\n * It has these slots:\n * - [x] default: contains the select elements\n *\n */\nlet InputChain = class InputChain extends LitElement {\n    get selectTagName() {\n        return this._selectTagName;\n    }\n    set selectTagName(newTagName) {\n        this._selectTagName = newTagName;\n        this.SELECT_QUERY = `:scope > ${this._selectTagName}`;\n        this.OPTION_QUERY = `:scope > ${this._selectTagName} > ${this._optionTagName}, :scope > ${this._selectTagName} > optgroup > ${this._optionTagName}`;\n        this.requestUpdate();\n    }\n    get optionTagName() {\n        return this._optionTagName;\n    }\n    set optionTagName(newTagName) {\n        this._optionTagName = newTagName;\n        this.OPTION_QUERY = `:scope > ${this._selectTagName} > ${newTagName}, :scope > ${this._selectTagName} > optgroup > ${newTagName}`;\n        this.requestUpdate();\n    }\n    constructor() {\n        super();\n        this.SELECT_QUERY = ':scope > select, :scope > custom-select';\n        this.OPTION_QUERY = ':scope > select > option, :scope > select > optgroup > option, :scope > custom-select > custom-option';\n        /**\n         * Form id\n         * This is the same API as input elements\n         */\n        this.for = '';\n        /**\n         * Name of the property\n         * This is the same API as input elements\n         */\n        this.name = '';\n        this.reactive = false;\n        this._selectTagName = 'select';\n        this._optionTagName = 'option';\n        /**\n         * Form setter\n         * Handle formdata event to add the current value to the form\n         */\n        this._form = null;\n        this.onChange_ = this.onChangeValue.bind(this);\n        /**\n         * Handle formdata event to add the current value to the form\n         */\n        this.onFormdata = (event) => {\n            if (!this.name) {\n                throw new Error('Attribute name is required for input-chain');\n            }\n            this.options\n                .filter((option) => option.selected)\n                .forEach((option) => {\n                event.formData.append(this.name, option.value);\n            });\n        };\n        this.redrawing = false;\n    }\n    set form(newForm) {\n        if (this._form) {\n            this._form.removeEventListener('formdata', this.onFormdata);\n        }\n        if (newForm) {\n            newForm.addEventListener('formdata', this.onFormdata);\n        }\n    }\n    get form() {\n        return this._form;\n    }\n    /**\n     * All selected options\n     * @readonly\n     */\n    get options() {\n        return Array.from(this.querySelectorAll(this.OPTION_QUERY));\n    }\n    /**\n     * Render the component\n     */\n    render() {\n        return html ` <slot></slot> `;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        // Use the form to add formdata\n        if (this.for) {\n            const form = document.querySelector(`form#${this.for}`);\n            if (form) {\n                this.form = form;\n            }\n        }\n        else {\n            this.form = this.closest('form');\n        }\n        // Listen to slots changes\n        this.shadowRoot.addEventListener('change', this.onChange_);\n    }\n    disconnectedCallback() {\n        this.shadowRoot.removeEventListener('change', this.onChange_);\n        this.form = null;\n        super.disconnectedCallback();\n    }\n    /**\n     * The data changed\n     * Reset the steps after the change\n     */\n    onChangeValue(event) {\n        const target = event.target;\n        const children = Array.from(this.querySelectorAll(this.SELECT_QUERY));\n        if (!children.includes(target)) {\n            return;\n        }\n        this.changeAt(children.indexOf(target));\n        // Dispatch our own event\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        event.stopPropagation();\n        this.requestUpdate();\n    }\n    /**\n     * Reset the steps after the given index\n     */\n    changeAt(idx, reset = false) {\n        if (this.redrawing)\n            return;\n        this.redrawing = true;\n        if (this.reactive) {\n            if (reset) {\n                const children = Array.from(this.querySelectorAll(':scope > select, :scope > custom-select'));\n                children[0].value = '';\n            }\n            this.dispatchEvent(new CustomEvent('change', { detail: { idx } }));\n        }\n        else {\n            // Messes with lit:\n            const children = Array.from(this.querySelectorAll(':scope > select, :scope > custom-select'));\n            const target = idx >= 0 ? children[idx] : children[0];\n            const next = (target === null || target === void 0 ? void 0 : target.value) ? children[idx + 1] : target || children[0];\n            const nextIndex = (target === null || target === void 0 ? void 0 : target.value) ? idx + 1 : idx;\n            if (next) {\n                // Remove all elements after next\n                children.slice(nextIndex + 1).forEach((child) => child.remove());\n                // Reset next\n                next.value = '';\n            }\n            this.dispatchEvent(new Event('change'));\n        }\n        this.redrawing = false;\n    }\n};\nInputChain.styles = inputChainStyles;\n__decorate([\n    property({ type: String, attribute: 'for' })\n], InputChain.prototype, \"for\", void 0);\n__decorate([\n    property({ type: String })\n], InputChain.prototype, \"name\", void 0);\n__decorate([\n    property({ type: Boolean })\n], InputChain.prototype, \"reactive\", void 0);\n__decorate([\n    property({ type: String, attribute: 'select-tag-name' })\n], InputChain.prototype, \"selectTagName\", null);\n__decorate([\n    property({ type: String, attribute: 'option-tag-name' })\n], InputChain.prototype, \"optionTagName\", null);\n__decorate([\n    property({ type: Array })\n], InputChain.prototype, \"options\", null);\nInputChain = __decorate([\n    customElement('input-chain')\n], InputChain);\nexport { InputChain };\n//# sourceMappingURL=input-chain.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { html } from 'lit';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { customElement, property } from 'lit/decorators.js';\nimport { InputChain } from './input-chain.js';\n/**\n * @element expression-input\n * Web component to create an expression\n * Extends the InputChain component and adds\n * - [x] fixed value UI\n * - [x] dirty state\n * - [x] placeholder\n * - [x] reset mechanism\n * - [ ] copy/paste hole expressions (using clipboard API)\n *\n * It adds these properties\n * - [x] value and initial value\n * - [ ] dirty\n *\n * It adds these attributes\n * - [x] allowFixed\n * - [x] fixed\n *\n * It has these spots\n *\n * - [x] default: the select elements for the expression\n * - [x] label\n * - [x] dirty-icon\n */\nlet ExpressionInput = class ExpressionInput extends InputChain {\n    constructor() {\n        super(...arguments);\n        /**\n         * Initial value to be set to track changes\n         */\n        //initialValue: string[] = []\n        //initialContent: Node[] = []\n        this.allowFixed = true;\n        this._fixed = false;\n        this.placeholder = 'Enter a fixed value or switch to expression';\n    }\n    /**\n     * Read only property dirty\n     * @readonly\n     */\n    get dirty() {\n        //return JSON.stringify(this.value) !== JSON.stringify(this.initialValue)\n        return this.value.length > 0;\n    }\n    /**\n     * Value is the concatenation of all options' values\n     * @readonly\n     */\n    get value() {\n        var _a;\n        return this.fixed\n            ? [(_a = this.getFixedInput()) === null || _a === void 0 ? void 0 : _a.value].filter((v) => !!v)\n            : this.options.filter((o) => o.selected && o.value).map((o) => o.value);\n    }\n    get fixed() {\n        return this._fixed;\n    }\n    set fixed(value) {\n        this._fixed = value;\n        this.dispatchEvent(new Event('fixedChange'));\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        //this.save()\n    }\n    /**\n     * Render the component\n     */\n    render() {\n        const dirty = this.dirty;\n        return html `\n      <!-- header -->\n      <header part=\"header\" class=\"header\">\n        <label>\n          <div\n            class=${classMap({ dirty, 'property-name': true })}\n            part=\"property-name\"\n          >\n            <slot name=\"label\"></slot>\n            ${dirty\n            ? html `\n                  <slot\n                    name=\"dirty-icon\"\n                    part=\"dirty-icon\"\n                    class=\"dirty-icon\"\n                    @click=${this.reset}\n                  >\n                    <svg viewBox=\"0 0 24 24\">\n                      <path\n                        fill=\"currentColor\"\n                        d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z\"\n                      ></path>\n                    </svg>\n                  </slot>\n                `\n            : html ``}\n          </div>\n          ${this.allowFixed\n            ? html `\n                <div part=\"fixed-selector\" class=\"fixed-selector\">\n                  <span\n                    class=${classMap({\n                active: this.fixed,\n                'fixed-selector-fixed': true,\n            })}\n                    @click=${() => (this.fixed = true)}\n                    part=\"fixed-selector-fixed\"\n                    >Fixed</span\n                  >\n                  <span\n                    class=${classMap({\n                active: !this.fixed,\n                'fixed-selector-expression': true,\n            })}\n                    @click=${() => (this.fixed = false)}\n                    part=\"fixed-selector-expression\"\n                    >Expression</span\n                  >\n                </div>\n              `\n            : html ``}\n        </label>\n      </header>\n      <div\n        part=\"property-container\"\n        class=${classMap({ 'property-container': true, fixed: this.fixed })}\n      >\n        <slot class=\"hide-when-fixed\"\n          >${this.options.length ? '' : this.placeholder}</slot\n        >\n        <slot name=\"fixed\" part=\"fixed\" class=\"show-when-fixed\"></slot>\n      </div>\n    `;\n    }\n    /**\n     * Reset dirty flag and restore the initial value\n     */\n    reset() {\n        if (this.fixed) {\n            const input = this.getFixedInput();\n            if (input) {\n                input.value = '';\n            }\n            else {\n                throw new Error('Input not found for fixed value');\n            }\n        }\n        else {\n            this.changeAt(-1, true);\n        }\n        this.dispatchEvent(new Event('change'));\n        this.requestUpdate();\n    }\n    getFixedInput() {\n        return this.querySelector('input, textarea');\n    }\n};\n__decorate([\n    property({ type: Boolean, attribute: 'allow-fixed' })\n], ExpressionInput.prototype, \"allowFixed\", void 0);\n__decorate([\n    property({ type: Boolean, attribute: 'fixed', reflect: true })\n], ExpressionInput.prototype, \"fixed\", null);\n__decorate([\n    property()\n], ExpressionInput.prototype, \"placeholder\", void 0);\nExpressionInput = __decorate([\n    customElement('expression-input')\n], ExpressionInput);\nexport { ExpressionInput };\n//# sourceMappingURL=expression-input.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { LitElement, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { popinStyles } from './styles.js';\n/**\n * This PopinOverlay component is a simple dialog that can be used to display any html on top of your UI\n * It is not a modal, it is not blocking the UI, it is just a simple dialog that will catch focus and hide when the user press escape or click outside of it\n * The dialog will be automatically positioned where placed in the DOM but it will be moved and resized to be fully visible on all screen sizes\n *\n * Usage:\n *\n * ```\n * <popin-overlay hidden style=\"width: 400px\" no-auto-close>\n *   <div slot=\"header\">Header</div>\n *   <div slot=\"body\">Body</div>\n *   <div slot=\"footer\">Footer</div>\n * </popin-overlay>\n * ```\n *\n * @element popin-overlay\n * @htmltag popin-overlay\n * @htmlslot The content of the dialog\n * @htmlattr hidden - Hide the dialog\n * @htmlattr no-auto-close - Do not close the dialog when the user click outside of it\n * @fires {CustomEvent} popin-closed - Fires when the dialog is closed\n * @fires {CustomEvent} popin-opened - Fires when the dialog is opened\n * @cssprop {Color} --popin-background - The background color of the dialog\n * @cssprop {Color} --popin-color - The text color of the dialog\n *\n */\nlet PopinOverlay = class PopinOverlay extends LitElement {\n    constructor() {\n        super(...arguments);\n        this.hidden = false;\n        this.noAutoClose = false;\n        this.resized_ = this.ensureElementInView.bind(this);\n        this.blured_ = this.blured.bind(this);\n        this.keydown_ = this.keydown.bind(this);\n    }\n    render() {\n        setTimeout(() => this.ensureElementInView());\n        return html ` <slot></slot> `;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        // Make the element focusable\n        this.setAttribute('tabindex', '0');\n        // Attach events on this instance\n        this.addEventListener('blur', this.blured_);\n        this.addEventListener('keydown', this.keydown_);\n        // Attach elements on window\n        window.addEventListener('resize', this.resized_);\n        window.addEventListener('blur', this.blured_);\n    }\n    disconnectedCallback() {\n        window.removeEventListener('resize', this.resized_);\n        window.removeEventListener('blur', this.blured_);\n        this.removeEventListener('blur', this.blured_);\n        this.removeEventListener('keydown', this.keydown_);\n        super.disconnectedCallback();\n    }\n    getActiveElementRecursive(element = document.activeElement) {\n        if (element === null || element === void 0 ? void 0 : element.shadowRoot) {\n            return this.getActiveElementRecursive(element.shadowRoot.activeElement);\n        }\n        return element;\n    }\n    blured() {\n        if (this.noAutoClose)\n            return;\n        // Give the time to the click event to be processed\n        setTimeout(() => {\n            // Check if the focus is still inside the dialog\n            const focusedElement = this.getActiveElementRecursive();\n            let popin = focusedElement;\n            while (popin && popin !== this) {\n                popin = popin.parentNode || popin.host;\n            }\n            if (popin !== this) {\n                // Hide the dialog\n                this.close();\n            }\n            else {\n                // Focus the dialog again so that this function\n                // will be called again when the user click outside\n                //this.focus()\n            }\n        });\n    }\n    close() {\n        this.setAttribute('hidden', '');\n        this.blur();\n    }\n    keydown(event) {\n        if (event.key === 'Escape') {\n            this.close();\n        }\n    }\n    attributeChangedCallback(name, _old, value) {\n        super.attributeChangedCallback(name, _old, value);\n        if (name === 'hidden' && value === null) {\n            this.focus();\n            this.dispatchEvent(new CustomEvent('popin-opened'));\n        }\n        if (name === 'hidden' && value !== null) {\n            this.dispatchEvent(new CustomEvent('popin-closed'));\n        }\n    }\n    ensureElementInView() {\n        var _a;\n        // Set our position to the parent element position\n        const parentStyle = (_a = this.parentElement) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();\n        this.style.left = `${parentStyle === null || parentStyle === void 0 ? void 0 : parentStyle.left}px`;\n        this.style.top = `${parentStyle === null || parentStyle === void 0 ? void 0 : parentStyle.top}px`;\n        const offsetX = 0;\n        const offsetY = 0;\n        // // Get the element's bounding rectangle\n        const rect = this.getBoundingClientRect();\n        const viewportWidth = window.innerWidth;\n        const viewportHeight = window.innerHeight;\n        // Check if the element is out of the viewport on the right side\n        if (rect.left + rect.width + offsetX > viewportWidth) {\n            this.style.left = `${viewportWidth - rect.width - offsetX}px`;\n        }\n        // Check if the element is out of the viewport on the left side\n        if (rect.left + offsetX < 0) {\n            this.style.left = `${-offsetX}px`;\n        }\n        // Check if the element is out of the viewport on the bottom\n        if (rect.top + rect.height + offsetY > viewportHeight) {\n            this.style.top = `${viewportHeight - rect.height - offsetY}px`;\n        }\n        // Check if the element is out of the viewport on the top\n        if (rect.top + offsetY < 0) {\n            this.style.top = `${-offsetY}px`;\n        }\n    }\n};\nPopinOverlay.styles = popinStyles;\n__decorate([\n    property()\n], PopinOverlay.prototype, \"hidden\", void 0);\n__decorate([\n    property({ type: Boolean, attribute: 'no-auto-close' })\n], PopinOverlay.prototype, \"noAutoClose\", void 0);\nPopinOverlay = __decorate([\n    customElement('popin-overlay')\n], PopinOverlay);\nexport { PopinOverlay };\n//# sourceMappingURL=popin-overlay.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { PopinOverlay } from './popin-overlay.js';\n/**\n * This component extends the `<popin-overlay>` component and the native `<form>` tag\n * It handles form submissions both as an input for the parent form and with it's children inputs\n *\n * Usage:\n *\n * ```\n * <popin-form hidden style=\"width: 400px\" no-auto-close>\n *   <div slot=\"header\">Header</div>\n *   <div slot=\"body\">Body</div>\n *   <div slot=\"footer\">Footer</div>\n * </popin-form>\n * ```\n *\n * @element popin-form\n * @htmltag popin-form\n * @htmlslot header - The header of the dialog\n * @htmlslot default - The body of the dialog\n * @htmlslot footer - The footer of the dialog\n * @cssprop {Color} --popin-form-header-background - The background color of the header\n * @cssprop {Color} --popin-form-body-background - The background color of the body\n * @cssprop {Color} --popin-form-footer-background - The background color of the footer\n * @cssprop {Color} --popin-form-header-color - The text color of the header\n * @cssprop {Color} --popin-form-body-color - The text color of the body\n * @cssprop {Color} --popin-form-footer-color - The text color of the footer\n * @cssprop {Border} --popin-form-header-border-bottom - The border of the header\n * @cssprop {Border} --popin-form-footer-border-top - The border of the footer\n * @cssprop {Padding} --popin-form-header-padding - The padding of the header\n * @cssprop {Padding} --popin-form-body-padding - The padding of the body\n * @cssprop {Padding} --popin-form-footer-padding - The padding of the footer\n * @cssprop {Color} --popin-button-background - The background color of the button\n * @cssprop {Color} --popin-button-color - The text color of the button\n * @cssprop {Color} --popin-button-hover-background - The background color of the button when hovered\n * @cssprop {Color} --popin-button-hover-color - The text color of the button when hovered\n * @cssprop {Border} --popin-button-border - The border of the button\n * @cssprop {Border} --popin-button-hover-border - The border of the button when hovered\n * @cssprop {Padding} --popin-button-padding - The padding of the button\n * @cssprop {Padding} --popin-button-hover-padding - The padding of the button when hovered\n * @cssprop {Margin} --popin-button-margin - The margin of the button\n * @cssprop {Margin} --popin-button-hover-margin - The margin of the button when hovered\n * @cssprop {BorderRadius} --popin-form-border-radius - The border radius of the dialog\n * @cssprop {Color} --popin-button-background--secondary - The background color of the secondary button\n * @cssprop {Color} --popin-button-color--secondary - The text color of the secondary button\n * @cssprop {Color} --popin-button-hover-background--secondary - The background color of the secondary button when hovered\n * @cssprop {Color} --popin-button-hover-color--secondary - The text color of the secondary button when hovered\n * @cssprop {Border} --popin-button-border--secondary - The border of the secondary button\n * @cssprop {Border} --popin-button-hover-border--secondary - The border of the secondary button when hovered\n * @cssprop {Padding} --popin-button-padding--secondary - The padding of the secondary button\n * @cssprop {Padding} --popin-button-hover-padding--secondary - The padding of the secondary button when hovered\n * @cssprop {Margin} --popin-button-margin--secondary - The margin of the secondary button\n * @cssprop {Margin} --popin-button-hover-margin--secondary - The margin of the secondary button when hovered\n *\n */\nlet PopinForm = class PopinForm extends PopinOverlay {\n    constructor() {\n        super(...arguments);\n        /**\n         * Form id\n         * This is the same API as input elements\n         */\n        this.for = '';\n        this.name = '';\n        this.formData = new FormData();\n        this.onFormdata_ = this.onFormdata.bind(this);\n        this.slotChanged_ = this.slotChanged.bind(this);\n        /**\n         * Form setter\n         * Handle formdata event to add the current value to the form\n         */\n        this._form = null;\n        /**\n         * Handle slot change to update the form\n         */\n        this.inputs = [];\n    }\n    set form(newForm) {\n        if (this._form) {\n            this._form.removeEventListener('formdata', this.onFormdata_);\n        }\n        if (newForm) {\n            newForm.addEventListener('formdata', this.onFormdata_);\n        }\n    }\n    get form() {\n        return this._form;\n    }\n    get value() {\n        this.updateFormData();\n        return Object.fromEntries(this.formData.entries());\n    }\n    render() {\n        super.render(); // For placement\n        return html `\n      <form @submit=${this.submit} @change=${this.change}>\n        <header>\n          <slot class=\"header\" name=\"header\"></slot>\n        </header>\n        <main>\n          <slot class=\"body\" part=\"body\"></slot>\n        </main>\n        <footer>\n          <slot class=\"footer\" name=\"footer\">\n            <button type=\"button\" class=\"secondary\" @click=${this.close}>\n              Cancel\n            </button>\n            <button type=\"submit\">Apply</button>\n          </slot>\n        </footer>\n      </form>\n    `;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        // Use the form to add formdata\n        if (this.for) {\n            const form = document.querySelector(`form#${this.for}`);\n            if (form) {\n                this.form = form;\n            }\n        }\n        else {\n            this.form = this.closest('form');\n        }\n        // Listen to slots changes\n        this.shadowRoot.addEventListener('slotchange', this.slotChanged_);\n        // Update current list of inputs\n        this.slotChanged();\n    }\n    disconnectedCallback() {\n        this.removeEventListener('slotchange', this.slotChanged_);\n        this.form = null;\n        super.disconnectedCallback();\n    }\n    slotChanged() {\n        this.inputs = Array.from(this.querySelectorAll('input, select, textarea, [data-is-input]'));\n    }\n    /**\n     * Handle formdata event to add the current value to the form\n     */\n    onFormdata(event) {\n        event.preventDefault();\n        const formData = event.formData;\n        for (const [key, value] of this.formData.entries()) {\n            formData.set(`${this.name}-${key}`, value);\n        }\n    }\n    updateFormData() {\n        this.formData = new FormData();\n        for (const input of this.inputs) {\n            this.formData.set(input.getAttribute('name'), input.value);\n        }\n    }\n    submit(event) {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        this.updateFormData();\n        this.close();\n        this.dispatchEvent(new Event('change'));\n    }\n    change(event) {\n        const me = event.target.closest(this.tagName);\n        if (me === this) {\n            event.preventDefault();\n            event.stopImmediatePropagation();\n        }\n    }\n};\n__decorate([\n    property({ type: String, attribute: 'for' })\n], PopinForm.prototype, \"for\", void 0);\n__decorate([\n    property({ type: String })\n], PopinForm.prototype, \"name\", void 0);\nPopinForm = __decorate([\n    customElement('popin-form')\n], PopinForm);\nexport { PopinForm };\n//# sourceMappingURL=popin-form.js.map","import{noChange as t}from\"../lit-html.js\";import{directive as e,Directive as r,PartType as s}from\"../directive.js\";\n/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const n=\"important\",i=\" !\"+n,o=e(class extends r{constructor(t){if(super(t),t.type!==s.ATTRIBUTE||\"style\"!==t.name||t.strings?.length>2)throw Error(\"The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.\")}render(t){return Object.keys(t).reduce(((e,r)=>{const s=t[r];return null==s?e:e+`${r=r.includes(\"-\")?r:r.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,\"-$&\").toLowerCase()}:${s};`}),\"\")}update(e,[r]){const{style:s}=e.element;if(void 0===this.ft)return this.ft=new Set(Object.keys(r)),this.render(r);for(const t of this.ft)null==r[t]&&(this.ft.delete(t),t.includes(\"-\")?s.removeProperty(t):s[t]=null);for(const t in r){const e=r[t];if(null!=e){this.ft.add(t);const r=\"string\"==typeof e&&e.endsWith(i);t.includes(\"-\")||r?s.setProperty(t,r?e.slice(0,-11):e,r?n:\"\"):s[t]=e}}return t}});export{o as styleMap};\n//# sourceMappingURL=style-map.js.map\n","import { Component } from 'grapesjs'\nimport { Context, Expression, Field, Filter, Property, State, StateId, Token, Type, TypeId } from '../types'\nimport { DataTree } from './DataTree'\nimport { getOrCreatePersistantId, getState, getStateIds } from './state'\nimport { getExpressionResultType, getTokenOptions } from './token'\nimport { getFixedToken } from '../utils'\n\n/**\n * Get the context of a component\n * This includes all parents states, data sources queryable values, values provided in the options\n */\nexport function getContext(component: Component, dataTree: DataTree, currentStateId?: StateId, hideLoopData = false): Context {\n  if (!component) {\n    console.error('Component is required for context')\n    throw new Error('Component is required for context')\n  }\n  // Get all queryable values from all data sources\n  const queryable: Property[] = dataTree.queryables\n    .map((field: Field) => {\n      if (!field.dataSourceId) throw new Error(`Type ${field.id} has no data source`)\n      return fieldToToken(field)\n    })\n  // Get all states in the component scope\n  const states: State[] = []\n  const loopProperties: Token[] = []\n  let parent = component\n  while (parent) {\n    // Get explicitely set states\n    states\n      .push(...(getStateIds(parent, true, parent === component ? currentStateId : undefined)\n        .map((stateId: StateId): State => ({\n          type: 'state',\n          storedStateId: stateId,\n          previewIndex: 8888,\n          label: getState(parent, stateId, true)?.label || stateId,\n          componentId: getOrCreatePersistantId(parent),\n          exposed: true,\n        }))))\n    // Get states from loops\n    if (parent !== component || !hideLoopData) { // If it is a loop on the parent or if we don't hide the loop data\n      const loopDataState = getState(parent, '__data', false)\n      if (loopDataState) {\n        try {\n          const loopDataField = getExpressionResultType(loopDataState.expression, parent, dataTree)\n          if (loopDataField) {\n            const displayName = (label: string) => `${parent.getName() ?? 'Unknown'}'s ${loopDataField.label} ${label}`\n            if (loopDataField.kind === 'list') {\n              loopProperties.push({\n                type: 'state',\n                storedStateId: '__data',\n                componentId: getOrCreatePersistantId(parent),\n                previewIndex: loopDataField.previewIndex,\n                exposed: false,\n                forceKind: 'object', // FIXME: this may be a scalar\n                label: `Loop data (${loopDataField.label})`,\n              }, {\n                type: 'property',\n                propType: 'field',\n                fieldId: 'forloop.index0',\n                label: displayName('forloop.index0'),\n                kind: 'scalar',\n                typeIds: ['number'],\n              }, {\n                type: 'property',\n                propType: 'field',\n                fieldId: 'forloop.index',\n                label: displayName('forloop.index'),\n                kind: 'scalar',\n                typeIds: ['number'],\n              })\n            } else {\n              console.warn('Loop data is not a list for component', parent, 'and state', loopDataState)\n            }\n          } else {\n            console.warn('Loop data type not found for component', parent, 'and state', loopDataState)\n          }\n        } catch {\n          console.error('Error while getting loop data for component', parent, 'and state', loopDataState)\n        }\n      }\n    }\n    // Go up to parent\n    parent = parent.parent() as Component\n  }\n  // Get filters which accept no input\n  const filters: Filter[] = dataTree.filters\n    .filter(filter => {\n      try {\n        return filter.validate(null)\n      } catch (e) {\n        console.warn('Filter validate error:', e, {filter})\n        return false\n      }\n    })\n  // Add a fixed value\n  const fixedValue = getFixedToken('')\n  // Return the context\n  return [\n    ...queryable,\n    ...states,\n    ...loopProperties,\n    ...filters,\n    fixedValue,\n  ]\n}\n\n/**\n * Create a property token from a field\n */\nexport function fieldToToken(field: Field): Property {\n  if (!field) throw new Error('Field is required for token')\n  if (!field.dataSourceId) throw new Error(`Field ${field.id} has no data source`)\n  return {\n    type: 'property',\n    propType: 'field',\n    fieldId: field.id,\n    label: field.label,\n    typeIds: field.typeIds,\n    dataSourceId: field.dataSourceId,\n    kind: field.kind,\n    ...getTokenOptions(field) ?? {},\n  }\n}\n\n/**\n * Auto complete an expression\n * @returns a list of possible tokens to add to the expression\n */\nexport function getCompletion(options: { component: Component, expression: Expression, dataTree: DataTree, rootType?: TypeId, currentStateId?: StateId, hideLoopData?: boolean}): Context {\n  const { component, expression, dataTree, rootType, currentStateId, hideLoopData } = options\n  if (!component) throw new Error('Component is required for completion')\n  if (!expression) throw new Error('Expression is required for completion')\n  if (expression.length === 0) {\n    if (rootType) {\n      const type = dataTree.getType(rootType, null, component.getId())\n      if (!type) {\n        console.warn('Root type not found', rootType)\n        return []\n      }\n      return type.fields\n        .map((field: Field) => fieldToToken(field))\n    }\n    return getContext(component, dataTree, currentStateId, hideLoopData)\n  }\n  const field = getExpressionResultType(expression, component, dataTree)\n  if (!field) {\n    console.warn('Result type not found for expression', expression)\n    return []\n  }\n  return ([] as Token[])\n    // Add fields if the kind is object\n    .concat(field.kind === 'object' ? field.typeIds\n      // Find possible types\n      .map((typeId: TypeId) => dataTree.getType(typeId, field.dataSourceId ?? null, component.getId()))\n      // Add all of their fields\n      .flatMap((type: Type | null) => type?.fields ?? [])\n      // To token\n      .flatMap(\n        (fieldOfField: Field): Token[] => {\n          // const t: Type | null = this.findType(field.typeIds, field.dataSourceId)\n          // if(!t) throw new Error(`Type ${field.typeIds} not found`)\n          return fieldOfField.typeIds.map((typeId: TypeId) => ({\n            ...fieldToToken(fieldOfField),\n            typeIds: [typeId],\n          }))\n        }\n      ) : [])\n    // Add filters\n    .concat(\n      dataTree.filters\n        // Match input type\n        .filter(filter => {\n          try {\n            return filter.validate(field)\n          } catch (e) {\n            console.warn('Filter validate error:', e, {filter, field})\n            return false\n          }\n        })\n    )\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {LitElement, TemplateResult, html} from 'lit'\nimport {property} from 'lit/decorators.js'\nimport { Ref, createRef, ref } from 'lit/directives/ref.js'\nimport { styleMap } from 'lit/directives/style-map.js'\nimport { PROPERTY_STYLES } from './defaultStyles'\nimport { DATA_SOURCE_CHANGED, DATA_SOURCE_DATA_LOAD_END, Filter, Property, State, StoredProperty, Token } from '../types'\nimport { FIXED_TOKEN_ID, fromString, getFixedToken, getTokenDisplayName, groupByType, toExpression, toId, toValue, getDataTreeFromUtils } from '../utils'\nimport { ExpressionInput, PopinForm } from '@silexlabs/expression-input'\nimport { Component, Editor } from 'grapesjs'\n\nimport '@silexlabs/expression-input'\nimport { getCompletion } from '../model/completion'\nimport { fromStored, getExpressionResultType } from '../model/token'\nimport { StoredState, StoredStateWithId } from '../model/state'\n\nconst PREVIEW_INDEX_CHANGED = 'PREVIEW_INDEX_CHANGED'\n\n/**\n * Editor for a state of the selected element's properties\n *\n * Usage:\n *\n * ```\n * <state-editor\n *  name=\"state\"\n *  disabled\n *  hide-loop-data\n *  parent-name=\"parent\"\n *  no-filters\n *  root-type=\"root\"\n *  default-fixed\n *  dismiss-current-component-states\n *  ></state-editor>\n * ```\n *\n */\n\nexport class StateEditor extends LitElement {\n  @property({type: Boolean})\n    disabled = false\n\n  @property({type: String})\n    name = ''\n\n  @property({type: Boolean, attribute: 'hide-loop-data'})\n    hideLoopData = false\n\n  /**\n   * If true, will show a UI to edit previewIndex of __data\n   */\n  @property({type: Boolean, attribute: 'show-preview-index-ui'})\n    showPreviewIndexUi = false\n  /**\n   * used in the expressions found in filters options\n   * This will be used to filter states which are not defined yet\n   */\n  @property({type: String, attribute: 'parent-name'})\n    parentName = ''\n\n  @property({type: Boolean, attribute: 'no-filters'})\n    noFilters = false\n\n  @property({type: String, attribute: 'root-type'})\n    rootType = ''\n\n  @property({type: Boolean, attribute: 'default-fixed'})\n    defaultFixed = false\n\n  // Note: dismissCurrentComponentStates not used in this project anymore\n  @property({type: Boolean, attribute: 'dismiss-current-component-states'})\n    dismissCurrentComponentStates = false\n\n  private _selected: Component | null = null\n  @property({type: Object})\n  get selected(): Component | null {\n    return this._selected\n  }\n  set selected(value: Component | null) {\n    this._selected = value\n    // Update selected preview index\n    const token = this._data.slice(-1)[0]\n    if(token) {\n      this.previewIndex = token.previewIndex || 0\n    }\n    this.requestUpdate()\n  }\n\n  /**\n   * Value string for for submissions\n   */\n  @property()\n  get value(): string {\n    return JSON.stringify(this.data)\n  }\n  set value(newValue: string) {\n    const expression = toExpression(newValue)\n    if (!expression) {\n      this.data = newValue\n      return\n    }\n    this.data = expression as Token[]\n  }\n\n  /**\n   * Form id\n   * This is the same API as input elements\n   */\n  @property({type: String, attribute: 'for'})\n    for = ''\n\n  /**\n   * The previewIndex for the loop data\n   */\n  @property({ type: Number }) previewIndex = 0\n\n  /**\n   * Binded listeners\n   */\n  private onFormdata_ = this.onFormdata.bind(this)\n  private renderBinded = () => this.requestUpdate()\n\n  override connectedCallback() {\n    super.connectedCallback()\n    // Use the form to add formdata\n    if(this.for) {\n      const form = document.querySelector<HTMLFormElement>(`form#${this.for}`)\n      if(form) {\n        this.form = form\n      }\n    } else {\n      this.form = this.closest('form')\n    }\n\n    this.editor?.on(`${DATA_SOURCE_CHANGED} ${PREVIEW_INDEX_CHANGED} ${DATA_SOURCE_DATA_LOAD_END}`, this.renderBinded)\n  }\n\n  override disconnectedCallback() {\n    this.form = null\n    super.disconnectedCallback()\n    this.editor?.off(`${DATA_SOURCE_CHANGED} ${PREVIEW_INDEX_CHANGED} ${DATA_SOURCE_DATA_LOAD_END}`, this.renderBinded)\n  }\n\n  /**\n   * Handle formdata event to add the current value to the form\n   */\n  private onFormdata(event: FormDataEvent) {\n    event.preventDefault()\n    const formData = event.formData\n    formData.set(this.name, this.value)\n  }\n\n  /**\n   * Form setter\n   * Handle formdata event to add the current value to the form\n   */\n  protected _form: HTMLFormElement | null = null\n  set form(newForm: HTMLFormElement | null) {\n    if(this._form) {\n      this._form.removeEventListener('formdata', this.onFormdata_)\n    }\n    if(newForm) {\n      newForm.addEventListener('formdata', this.onFormdata_)\n    }\n  }\n  get form() {\n    return this._form\n  }\n\n  /**\n   * Structured data\n   */\n  private _data: Token[] = []\n  get data(): Token[] {\n    const input = this.expressionInputRef.value\n    if(!this._selected || !this.editor) {\n      console.error('selected and editor are required', this._selected, this.editor)\n      //throw new Error('selected and editor are required')\n      return []\n    }\n    if(!input || input.value.length === 0) return []\n    if(input.fixed) {\n      return [getFixedToken(input.value[0] || '')]\n    } else {\n      const ids = input.value\n      return ids\n        .filter(id => !!id)\n        .map(id => {\n          try {\n            return fromString(this.editor!, id, this.selected!.getId())\n          } catch(e) {\n            console.error(`Error while getting token from id ${id}`, e)\n            // Return unknown\n            return {\n              type: 'property',\n              propType: 'field',\n              fieldId: 'unknown',\n              label: 'Unknown',\n              kind: 'scalar',\n              typeIds: [],\n              options: {},\n            } as Property\n          }\n        })\n        // Here the data is missing options as data comes from completion\n        // Add the options\n        .map((token, idx) => {\n          const popin = this.popinsRef[idx]?.value\n          switch(token.type) {\n          case 'property':\n          case 'filter':\n            token.options = popin?.value || token.options\n            break\n          default:\n            break\n          }\n          return token\n        })\n    }\n  }\n  set data(value: Token[] | string) {\n    if(typeof value === 'string') {\n      this._data = value === '' ? [] : [getFixedToken(value)]\n    } else {\n      this._data = value\n    }\n    if (this.editor) this.requestUpdate()\n  }\n\n  private _editor: Editor | null = null\n  @property({type: Object})\n  get editor(): Editor | null {\n    return this._editor\n  }\n  set editor(value: Editor | null) {\n    this._editor = value\n    this.requestUpdate()\n  }\n\n  private redrawing = false\n  private expressionInputRef = createRef<ExpressionInput>()\n  private popinsRef: Ref<PopinForm>[] = []\n\n  override render() {\n    this.redrawing = true\n    super.render()\n    if(!this.name) throw new Error('name is required on state-editor')\n    if(!this.editor || !this.selected) {\n      console.error('editor and selected are required', this.editor, this.selected)\n      return html`<div class=\"ds-section\n        ds-section--error\">Error rendering state-editor component: editor and selected are required</div>`\n    }\n\n    const selected = this.selected\n    const dataTree = getDataTreeFromUtils(this.editor)\n    // FIXME: fromStored every time we render is not efficient, it is supposed to have been done before\n    const _currentValue = this._data.map(token => fromStored(token, dataTree, selected.getId()))\n\n    // Get the data to show in the \"+\" drop down\n    const completion = getCompletion({\n      component: this.dismissCurrentComponentStates ? selected.parent()! : selected,\n      expression: _currentValue || [],\n      dataTree,\n      rootType: this.rootType,\n      currentStateId: this.parentName || this.name,\n      hideLoopData: this.hideLoopData,\n    })\n      .filter(token => token.type !== 'filter' || !this.noFilters)\n\n    const groupedCompletion = groupByType(this.editor, selected, completion, _currentValue)\n\n    // Check if the expression has a fixed value and nothing else\n    const fixed = (_currentValue?.length === 1 && _currentValue[0].type === 'property' && _currentValue[0].fieldId === FIXED_TOKEN_ID)\n      // If the value is empty and the default is fixed, then the input is fixed\n      || (this.defaultFixed && _currentValue.length === 0)\n      // If there is no completion and the value is empty\n      || (completion.length === 0 && _currentValue.length === 0)\n\n    // Fixed text\n    const text = fixed ? (_currentValue![0] as Property)?.options?.value || '' : ''\n\n    let currentData = '' as unknown\n    try {\n      const realData = dataTree.getValue(_currentValue || [], selected, !this.showPreviewIndexUi)\n      currentData = realData\n    } catch(e) {\n      console.error('Current data could not be retrieved:', e)\n    }\n    if (typeof currentData === 'undefined' || currentData === null) currentData = ''\n    const currentDataArrayLength = Array.isArray(currentData) ? (currentData as Array<unknown>).length : 0\n    const previewIndex = (_currentValue[_currentValue.length - 1] as State)?.previewIndex\n    // Update selected preview index\n    if(this.previewIndex !== previewIndex) {\n      this.previewIndex = previewIndex || 0\n    }\n    const rangeInputRef = createRef<HTMLInputElement>()\n    const numberInputRef = createRef<HTMLInputElement>()\n    // Build the expression input\n    const result = html`\n      <expression-input\n        @change=${(event: Event) => this.onChangeValue(event)}\n        data-is-input\n        ${ref(this.expressionInputRef)}\n        .fixed=${fixed}\n        class=\"ds-section\"\n        name=${this.name}\n        reactive\n      >\n        <style>\n          ${PROPERTY_STYLES}\n        </style>\n        <slot name=\"label\" slot=\"label\"></slot>\n        <div slot=\"fixed\" class=\"ds-slot-fixed\">\n          <input\n            type=\"text\"\n            class=\"ds-expression-input__fixed\"\n            placeholder=\"Enter a text or switch to expression mode\"\n            .value=${text}\n            />\n        </div>\n        ${ _currentValue && _currentValue.length > 0 ? html`\n          ${ _currentValue.map((token: Token, idx: number) => {\n    this.popinsRef[idx] = createRef<PopinForm>()\n    const optionsForm = this.getOptions(selected, _currentValue, idx)\n    const partialExpression = _currentValue.slice(0, idx)\n\n    const _partialCompletion = getCompletion({\n      component: this.dismissCurrentComponentStates ? selected.parent()! : selected,\n      expression: partialExpression,\n      dataTree,\n      rootType: this.rootType,\n      currentStateId: idx === 0 ? this.parentName || this.name : undefined,\n      hideLoopData: this.hideLoopData,\n    })\n    const partialCompletion = this.noFilters ? _partialCompletion\n      .filter(token => token.type !== 'filter')\n      : _partialCompletion\n    const partialGroupedCompletion = groupByType(this.editor!, selected, partialCompletion, _currentValue.slice(0, idx))\n    const id = toId(token)\n    return html`\n              <select>\n                <option value=\"\">-</option>\n                ${ Object.entries(partialGroupedCompletion)\n    .reverse()\n    .map(([type, completion]) => {\n      return html`\n                      <optgroup label=\"${type}\">\n                      ${ completion\n    .map(partialToken => ({\n      displayName: getTokenDisplayName(selected, partialToken),\n      partialToken,\n    }))\n    .sort((a, b) => a.displayName.localeCompare(b.displayName))\n    .map(({partialToken, displayName}) => {\n      const partialId = toId(partialToken)\n      return html`\n                            <option value=${toValue(partialToken)} .selected=${partialId === id}>${displayName}</option>\n                          `\n    })\n}\n                      </optgroup>\n                    `\n    })\n}\n              </select>\n              <button\n                class=\"ds-expression-input__options-button\"\n                style=${styleMap({ display: optionsForm === '' ? 'none' : '' })}\n                @click=${() => {\n    this.popinsRef[idx].value?.removeAttribute('hidden')\n  }}\n              >...</button>\n              <popin-form\n                ${ref(this.popinsRef[idx])}\n                hidden\n                name=${`${this.name}_options_${idx}`}\n                @change=${(event: Event) => this.onChangeOptions(event, selected, this.popinsRef[idx].value!, idx)}\n              >\n                ${optionsForm}\n              </popin-form>\n              `\n  })\n}\n        ` : '' }\n        ${Object.entries(groupedCompletion).length ? html`\n          <select\n            class=\"ds-expression-input__add\"\n            ${ref(el => el && ((el as HTMLSelectElement).value = ''))}\n            >\n            <option value=\"\" selected>+</option>\n            ${ Object.entries(groupedCompletion)\n    .reverse()\n    .map(([type, completion]) => {\n      return html`\n                    <optgroup label=\"${type}\">\n                    ${ completion\n    .map(token => ({\n      displayName: getTokenDisplayName(selected, token),\n      token,\n    }))\n    .sort((a, b) => a.displayName.localeCompare(b.displayName))\n    .map(({displayName, token}) => {\n      return html`<option value=\"${toValue(token)}\">${displayName}</option>`\n    })\n}\n                    </optgroup>\n                `\n    })\n}\n          </select>\n      ` : ''}\n      </expression-input>\n      <div class=\"ds-real-data\">\n        <code class=\"ds-real-data__display\">\n          ${Array.isArray(currentData) ? html`${currentData.length} objects with ${Object.keys(currentData[0] || {}).filter(k => k !== '__typename').join(', ')}` : currentData}\n        </code>\n        ${this.showPreviewIndexUi && (currentDataArrayLength > 0 && typeof previewIndex !== 'undefined') ? html`\n        <div class=\"ds-real-data__preview-index\">\n          <input\n            ${ref(rangeInputRef)}\n            type=\"range\"\n            step=\"1\"\n            min=\"0\"\n            .max=${currentDataArrayLength - 1}\n            .value=${this.previewIndex}\n            @input=${(event: InputEvent) => {\n    const value = (event.target as HTMLInputElement).value\n    this.onChangePreview(parseInt(value))\n    if (numberInputRef.value) numberInputRef.value.value = value\n  }}\n          >\n          <input\n              ${ref(numberInputRef)}\n              type=\"number\"\n            step=\"1\"\n            min=\"0\"\n            .max=${currentDataArrayLength - 1}\n            .value=${this.previewIndex}\n            @input=${(event: InputEvent) => {\n    const value = (event.target as HTMLInputElement).value\n    this.onChangePreview(parseInt(value))\n    if (rangeInputRef.value) rangeInputRef.value.value =  value\n  }}\n            >\n            ` : ''}\n        </div>\n        `\n    this.redrawing = false\n    return result\n  }\n\n  private onChangePreview(index: number) {\n    const state = this._selected?.attributes.privateStates.find((s: StoredStateWithId) => s.id === '__data') as StoredState\n    if(state?.expression.length > 0) {\n      const token = state.expression[state.expression.length - 1] as StoredProperty\n      token.previewIndex = index\n    }\n    this.editor?.trigger(PREVIEW_INDEX_CHANGED)\n  }\n\n  private onChangeValue(event: Event) {\n    if(this.redrawing) return\n    const idx = (event as CustomEvent).detail?.idx\n    if(idx >= 0) {\n      // Custom event coming from the expression input\n      // Remove the tokens after the changed one\n      const data = this.data.slice(0, idx + 1)\n      if(data.length > idx) {\n        // Clear options\n        if(data[idx].type === 'property' || data[idx].type === 'filter') {\n          (data[idx] as Property | Filter).options = {}\n        }\n      } else {\n        // We selected the \"-\" option, do nothing, this step will be removed\n      }\n      this.data = data\n    } else {\n      // Event coming from the options\n    }\n    // Stop default behavior of inputs\n    event.preventDefault()\n    event.stopImmediatePropagation()\n    event.stopPropagation()\n    // Let the redraw update this.data\n    setTimeout(() => this.dispatchEvent(new Event('change', { bubbles: true })))\n  }\n\n  private onChangeOptions(event: Event, component: Component, popin: PopinForm, idx: number) {\n    if(this.redrawing) return\n    if(!this.editor) throw new Error('editor is required')\n    const input = this.expressionInputRef.value!\n    const tokensStrings = input.value\n    // Get tokens as objects\n    const tokens = tokensStrings\n      .filter(id => !!id)\n      .map(id => {\n        try {\n          return fromString(this.editor!, id, component.getId())\n        } catch(e) {\n          // FIXME: notify user\n          console.error('Error while getting token from string', {id}, e)\n          // Return unknown\n          return {\n            type: 'property',\n            propType: 'field',\n            fieldId: 'unknown',\n            label: 'Unknown',\n            kind: 'scalar',\n            typeIds: [],\n            options: {},\n          } as Property\n        }\n      })\n    // Get the selected options\n    const options = input.options\n      .filter(o => o.selected)\n    // Update the options of the token\n    ;(tokens[idx] as Property | Filter).options = popin.value\n    // Update the dom\n    options[idx].value = toValue(tokens[idx])\n    // Update the state\n    this.requestUpdate()\n    // Stop the original event\n    event.preventDefault()\n    event.stopImmediatePropagation()\n    event.stopPropagation()\n    // Notify the owner\n    this.dispatchEvent(new Event('change', { bubbles: true }))\n  }\n\n  private getOptions(component: Component, tokens: Token[], idx: number): TemplateResult | '' {\n    if(!this.editor) throw new Error('editor is required')\n    const dataTree = getDataTreeFromUtils(this.editor)\n    const token = tokens[idx]\n    const beforeToken = tokens.slice(0, idx)\n    const fields = beforeToken\n      .map(token => {\n        try {\n          return getExpressionResultType(tokens.concat(token), component, dataTree)\n        } catch(e) {\n          // FIXME: notify the user\n          console.error(`Error while getting expression result type for token ${token} on component ${component.getName()}#${component.get('id')}.${component.getClasses().join('.')} (${component.cid})`, e)\n          return null\n        }\n      })\n\n    switch(token.type) {\n    case 'property':\n    case 'filter':\n      if(token.optionsForm) {\n        const form = token.optionsForm(component, fields[fields.length - 1], token.options || {}, this.parentName || this.name)\n        return form || ''\n      }\n      return ''\n    default:\n      return ''\n    }\n  }\n}\n\nif(!window.customElements.get('state-editor')) {\n  window.customElements.define('state-editor', StateEditor)\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {LitElement, html} from 'lit'\nimport { ref } from 'lit/directives/ref.js'\nimport {property} from 'lit/decorators.js'\n\nimport './state-editor'\nimport { StateEditor } from './state-editor'\nimport { Component, Editor } from 'grapesjs'\nimport { PROPERTY_STYLES } from './defaultStyles'\nimport { fromStored } from '../model/token'\nimport { BinariOperator, Properties, Token, UnariOperator } from '../types'\nimport { getState, setState } from '../model/state'\nimport { DataTree } from '../model/DataTree'\nimport { getFixedToken, getDataTreeFromUtils } from '../utils'\n\n/**\n * Editor for selected element's properties\n *\n * Usage:\n *\n * ```\n * <properties-editor disabled>\n *   <style> / * Custom styles * / </style>\n * </properties-editor>\n * ```\n *\n */\n\nexport class PropertiesEditor extends LitElement {\n  @property({type: Boolean})\n    disabled = false\n\n  @property({type: Boolean, attribute: 'default-fixed'})\n    defaultFixed = false\n\n  inputs: Record<Properties, {stateEditor: StateEditor, selected: Component | undefined} | undefined> = {\n    innerHTML: undefined,\n    condition: undefined,\n    condition2: undefined,\n    __data: undefined,\n  }\n\n  private editor: Editor | null = null\n  private redrawing = false\n\n  setEditor(editor: Editor) {\n    if (this.editor) {\n      console.warn('property-editor setEditor already set')\n      return\n    }\n    this.editor = editor\n\n    // Update the UI when a page is added/renamed/removed\n    this.editor.on('page', () => this.requestUpdate())\n\n    // Update the UI on component selection change\n    this.editor.on('component:selected', () => this.requestUpdate())\n\n    // Update the UI on component change\n    this.editor.on('component:update', () => this.requestUpdate())\n  }\n\n  override render() {\n    super.render()\n    this.redrawing = true\n    const selected = this.editor?.getSelected()\n    const head = html`\n      <style>\n        ${PROPERTY_STYLES}\n      </style>\n      <slot></slot>\n    `\n    const empty = html`\n      ${head}\n      <p class=\"ds-empty\">Select an element to edit its properties</p>\n    `\n    if(!this.editor || this.disabled) {\n      this.resetInputs()\n      this.redrawing = false\n      return html``\n    }\n    if(!selected || selected.get('tagName') === 'body') {\n      this.resetInputs()\n      this.redrawing = false\n      return empty\n    }\n    const result =  html`\n      ${head}\n      <section class=\"ds-section\">\n        <div>\n          <div class=\"gjs-traits-label\">Properties</div>\n        </div>\n        <details class=\"ds-states__help\">\n          <summary>Help</summary>\n          Elements properties are expressions that can replace the HTML attributes of the element or it's whole content (innerHTML).\n          <a target=\"_blank\" href=\"https://docs.silex.me/en/user/cms-concepts#properties\">Learn more about element properties</a>\n        </details>\n        <main>\n          ${[\n    {label: 'HTML content', name: Properties.innerHTML, publicState: false},\n  ].map(({label, name, publicState}) => this.renderStateEditor(selected, label, name, publicState))}\n        </main>\n      </section>\n      <section class=\"ds-section\">\n        <div>\n          <div class=\"gjs-traits-label\">Visibility</div>\n        </div>\n        <main>\n          ${this.renderStateEditor(selected, 'Condition', Properties.condition, false)}\n          <div>\n          <span>... is</span>\n          <select\n            class=\"ds-visibility__condition-operator\"\n            @change=${(e: Event) => {\n    const select = e.target as HTMLSelectElement\n    const value = select.value\n    if(!value) throw new Error('Selection required for operator select element')\n    selected.set('conditionOperator', value)\n    this.requestUpdate()\n  }}\n          >\n          </div>\n          ${ Object.values<string>(UnariOperator)\n    .concat(Object.values(BinariOperator))\n    .map(operator => html`\n                <option value=\"${operator}\" .selected=${selected.get('conditionOperator') === operator} >${operator}</option>\n              `)\n}\n          </select>\n          ${ this.renderStateEditor(selected, '', Properties.condition2, false, false, selected.has('conditionOperator') && Object.values(BinariOperator).includes(selected.get('conditionOperator'))) }\n        </main>\n      </section>\n      <section class=\"ds-section\">\n        <div>\n          <label class=\"gjs-traits-label ds-label\">Loop</label>\n        </div>\n        <main>\n          ${this.renderStateEditor(selected, 'Data', Properties.__data, false, true)}\n        </main>\n      </section>\n    `\n    this.redrawing = false\n    return result\n  }\n\n  resetInputs() {\n    this.inputs = {\n      innerHTML: undefined,\n      condition: undefined,\n      condition2: undefined,\n      __data: undefined,\n    }\n  }\n\n  renderStateEditor(selected: Component, label: string, name: Properties, publicState: boolean, hideLoopData = false, visible = true) {\n    return html`\n      <state-editor\n        .style=${visible ? '' : 'display: none;'}\n        .selected=${selected}\n        .editor=${this.editor}\n        id=\"${name}\"\n        name=${name}\n        default-fixed=${this.defaultFixed}\n        ?hide-loop-data=${hideLoopData}\n        ?show-preview-index-ui=${name === Properties.__data}\n        ${ref(el => {\n    // Get the stateEditor ref\n    if (el) {\n      // Set the editor - we could do this only once\n      const stateEditor = el as StateEditor\n      // Store the stateEditor ref and the component it is representing\n      if (!this.inputs[name]) {\n        this.inputs[name] = {\n          stateEditor,\n          selected: undefined, // clear the selected component so that we update the data\n        }\n      }\n    }\n    // Finally update the data\n    if (this.inputs[name]) {\n      const stateEditorFinally = this.inputs[name]!.stateEditor\n      this.redrawing = true\n      try {\n        stateEditorFinally.data = this.getTokens(getDataTreeFromUtils(this.editor!), selected, name, publicState)\n      } catch (e) {\n        console.error('Error setting data', e)\n        stateEditorFinally.data = [getFixedToken(`Error setting data: ${e}`)]\n      }\n      this.redrawing = false\n      // Store the selected component\n      this.inputs[name]!.selected = selected\n    }\n  })}\n        @change=${() => this.onChange(selected, name, publicState)}\n        ?disabled=${this.disabled}\n      >\n        <label slot=\"label\">${label}</label>\n      </state-editor>\n    `\n  }\n\n  onChange(component: Component, name: Properties, publicState: boolean) {\n    const {stateEditor} = this.inputs[name]!\n    if(this.redrawing) return\n    if (name === Properties.__data) {\n      setState(component, name, {\n        expression: stateEditor.data.slice(0, -1).concat({\n          ...stateEditor.data[stateEditor.data.length - 1],\n          previewIndex: 0,\n        } as unknown as Token),\n      }, publicState)\n    } else {\n      setState(component, name, {\n        expression: stateEditor.data,\n      }, publicState)\n    }\n  }\n\n  getTokens(dataTree: DataTree, component: Component, name: Properties, publicState: boolean): Token[] {\n    const state = getState(component, name, publicState)\n    if(!state || !state.expression) return []\n    return state.expression.map(token => fromStored(token, dataTree, component.getId()))\n  }\n}\n\nif(!window.customElements.get('properties-editor')) {\n  window.customElements.define('properties-editor', PropertiesEditor)\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {LitElement, html} from 'lit'\nimport { ref } from 'lit/directives/ref.js'\nimport {property} from 'lit/decorators.js'\nimport { StoredState, getState, getStateIds, removeState, setState } from '../model/state'\nimport { Token  } from '../types'\n\nimport './state-editor'\nimport { StateEditor } from './state-editor'\nimport { Component, Editor } from 'grapesjs'\nimport { PROPERTY_STYLES } from './defaultStyles'\nimport { fromStored } from '../model/token'\nimport { DataTree } from '../model/DataTree'\nimport { cleanStateName, getDataTreeFromUtils } from '../utils'\n\ninterface Item {\n  name: string\n  publicState?: boolean\n  state: StoredState\n}\n\n/**\n * Editor for selected element's states\n *\n */\nexport class CustomStatesEditor extends LitElement {\n  @property({type: Boolean})\n    disabled = false\n\n  @property({type: Boolean, attribute: 'private-state'})\n    privateState = false\n\n  @property({type: String})\n    title = 'Custom states'\n\n  @property({type: Boolean, attribute: 'default-fixed'})\n    defaultFixed = false\n\n  @property({type: String, attribute: 'create-prompt'})\n    createPrompt = 'Name this state'\n\n  @property({type: String, attribute: 'rename-prompt'})\n    renamePrompt = 'Rename this state'\n\n  @property({type: String, attribute: 'default-name'})\n    defaultName = 'New state'\n\n  // This is a comma separated list of reserved names\n  // Or an array of reserved names\n  @property({type: String, attribute: 'reserved-names'})\n  get reservedNames() { return this._reservedNames }\n  set reservedNames(value: string | string[]) {\n    if(typeof value === 'string') this._reservedNames = value.split(',').map(s => s.trim())\n    else this._reservedNames = value\n  }\n\n  @property({type: Boolean, attribute: 'hide-loop-data'})\n    hideLoopData = false\n\n  @property({type: String, attribute: 'help-text'})\n    helpText = ''\n\n  @property({type: String, attribute: 'help-link'})\n    helpLink = ''\n\n  private _reservedNames: string[] = []\n  private editor: Editor | null = null\n  private redrawing = false\n\n  setEditor(editor: Editor) {\n    if (this.editor) {\n      console.warn('property-editor setEditor already set')\n      return\n    }\n    this.editor = editor\n\n    // Update the UI when a page is added/renamed/removed\n    this.editor.on('page', () => this.requestUpdate())\n\n    // Update the UI on component selection change\n    this.editor.on('component:selected', () => this.requestUpdate())\n\n    // Update the UI on component change\n    this.editor.on('component:update', () => this.requestUpdate())\n  }\n\n  getHead(selected: Component | null) {\n    return html`\n      <style>\n        ${PROPERTY_STYLES}\n      </style>\n      <slot></slot>\n      <section class=\"ds-section\">\n        <div>\n          <div class=\"gjs-traits-label\">\n            <span>${this.title}</span>\n            ${ selected ? html`\n            <button\n              title=\"Add a new state\"\n              class=\"ds-states__add-button ds-states__button\"\n              @click=${() => {\n    const item = this.createCustomState(selected)\n    if(!item) return\n    this.setState(selected, item.name, item.state)\n  }}\n              >+</button>\n            ` : ''}\n          </div>\n        </div>\n        ${this.helpText ? html`\n        <details class=\"ds-states__help\">\n          <summary>Help</summary>\n          <span>${ this.helpText }</span>\n          ${this.helpLink ? html`\n          <a\n            class=\"ds-states__help-link\"\n            href=\"${this.helpLink}\"\n            target=\"_blank\"\n            >\\u{1F517} Read more...</a>\n          ` : ''}\n        </details>\n        ` : ''}\n      </section>\n    `\n  }\n\n  override render() {\n    super.render()\n    this.redrawing = true\n    const selected = this.editor?.getSelected()\n    const empty = html`\n      ${this.getHead(null)}\n      <p class=\"ds-empty\">Select an element to edit its states</p>\n    `\n    if(!this.editor || this.disabled) {\n      this.redrawing = false\n      return html``\n    }\n    if(!selected) {\n      this.redrawing = false\n      return empty\n    }\n    const items: Item[] = this.getStateIds(selected)\n      .map(stateId => ({\n        name: stateId,\n        publicState: !this.privateState,\n        state: this.getState(selected, stateId)!,\n      }))\n      .filter(item => item.state && !item.state.hidden)\n    const result =  html`\n      ${this.getHead(selected)}\n      <div class=\"ds-states\">\n        <div class=\"ds-states__items\">\n          ${items\n    .map((item, index) => html`\n            <div class=\"ds-states__item\">\n              ${this.getStateEditor(selected, item.state.label || '', item.name)}\n              <div class=\"ds-states__buttons\">\n                <button\n                  title=\"Remove this state\"\n                  class=\"ds-states__remove-button ds-states__button\"\n                  @click=${() => {\n    this.removeState(selected, item.name)\n    this.requestUpdate()\n  }}\n                  >x</button>\n                <button\n                  title=\"Rename this state\"\n                  class=\"ds-states__rename-button ds-states__button\"\n                  @click=${() => {\n    const newItem = this.renameCustomState(item)\n    if(!newItem || newItem === item) return\n    this.removeState(selected, item.name)\n    this.setState(selected, newItem.name, newItem.state)\n    this.requestUpdate()\n  }}\n                  >\\u270F</button>\n                  <button\n                    title=\"Move this state up\"\n                    class=\"ds-states__item-move-up ds-states__button${ index === 0 ? ' ds-states__button--disabled' : '' }\"\n                    @click=${() => {\n    items.splice(index - 1, 0, items.splice(index, 1)[0])\n    this.updateOrderCustomStates(selected, items)\n  }}\n                    >\\u2191</button>\n                  <button\n                    title=\"Move this state down\"\n                    class=\"ds-states__item-move-down ds-states__button${ index === items.length - 1 ? ' ds-states__button--disabled' : '' }\"\n                    @click=${() => {\n    items.splice(index + 1, 0, items.splice(index, 1)[0])\n    this.updateOrderCustomStates(selected, items)\n  }}\n                  >\\u2193</button>\n              </div>\n            </div>\n            <hr class=\"ds-states__sep\" />\n          `)}\n        </div>\n      </div>\n    `\n    this.redrawing = false\n    return result\n  }\n\n  /**\n   * Get the states for this type of editor\n   */\n  getStateIds(component: Component): string[] {\n    return getStateIds(component, !this.privateState)\n      // Filter out the states which are properties\n      .filter(stateId => !this.reservedNames.includes(stateId))\n  }\n\n  /**\n   * Get the states for this type of editor\n   */\n  getState(component: Component, name: string): StoredState | null {\n    return getState(component, name, !this.privateState)\n  }\n\n  /**\n   * Set the states for this type of editor\n   */\n  setState(component: Component, name: string, state: StoredState) {\n    setState(component, name, state, !this.privateState)\n  }\n\n  /**\n   * Remove the states for this type of editor\n   */\n  removeState(component: Component, name: string) {\n    removeState(component, name, !this.privateState)\n  }\n\n  getStateEditor(selected: Component, label: string, name: string) {\n    return html`\n      <state-editor\n        .selected=${selected}\n        .editor=${this.editor}\n        id=\"${name}\"\n        name=${name}\n        ?hide-loop-data=${this.hideLoopData}\n        default-fixed=${this.defaultFixed}\n        ${ref(el => {\n    if (el) {\n      const stateEditor = el as StateEditor\n      stateEditor.data = this.getTokens(getDataTreeFromUtils(this.editor!), selected, name)\n    }\n  })}\n        @change=${() => this.onChange(selected, name, label)}\n        .disabled=${this.disabled}\n      >\n        <label slot=\"label\">${label || name}</label>\n      </state-editor>\n    `\n  }\n\n  onChange(component: Component, name: string, label: string) {\n    if(this.redrawing) return\n    const stateEditor = this.shadowRoot!.querySelector(`#${name}`) as StateEditor\n    this.setState(component, name, {\n      expression: stateEditor.data,\n      label,\n    })\n  }\n\n  getTokens(dataTree: DataTree, component: Component, name: string): Token[] {\n    const state = this.getState(component, name)\n    if(!state || !state.expression) return []\n    return state.expression.map(token => {\n      try {\n        return fromStored(token, dataTree, component.getId())\n      } catch {\n        // FIXME: notify user\n        console.error('Error while getting expression result type in getTokens', {expression: state.expression, component, dataTree, name})\n        return {\n          type: 'property',\n          propType: 'field',\n          fieldId: 'unknown',\n          label: 'unknown',\n          kind: 'scalar',\n          typeIds: [],\n        }\n      }\n    })\n  }\n\n  /**\n   * Rename a custom state\n   */\n  renameCustomState(item: Item): Item {\n    const label = prompt(this.renamePrompt, item.state.label)\n      ?.toLowerCase()\n      ?.replace(/[^a-z0-9]/g, '-')\n      ?.replace(/^-+|-+$/g, '')\n    if (!label || label === item.state.label) return item\n    return {\n      ...item,\n      state: {\n        ...item.state,\n        label: label,\n      }\n    }\n  }\n\n  /**\n   * Update the custom states, in the order of the list\n   */\n  updateOrderCustomStates(component: Component, items: Item[]) {\n    const stateIds = this.getStateIds(component)\n    // Remove all states\n    stateIds.forEach(stateId => {\n      if(items.map(item => item.name).includes(stateId)) {\n        this.removeState(component, stateId)\n      }\n    })\n    // Add states in the order of the list\n    items.forEach(item => {\n      this.setState(component, item.name, item.state)\n    })\n  }\n\n  /**\n   * Create a new custom state\n   */\n  createCustomState(component: Component): Item | null {\n    const label = cleanStateName(prompt(this.createPrompt, this.defaultName))\n    if (!label) return null\n\n    if(this.reservedNames.includes(label)) {\n      alert(`The name ${label} is reserved, please choose another name`)\n      return null\n    }\n    const stateId = `${component.getId()}-${Math.random().toString(36).slice(2)}`\n    const state: StoredState = {\n      label,\n      expression: [],\n    }\n    this.setState(component, stateId, state)\n    return {\n      name: stateId,\n      state,\n      publicState: !this.privateState,\n    }\n  }\n}\n\nif(!customElements.get('custom-states-editor')) {\n  customElements.define('custom-states-editor', CustomStatesEditor)\n}\n","import { Editor, Component } from 'grapesjs'\nimport { getState, StoredState } from '../model/state'\nimport { Properties, StoredToken, BinariOperator, UnariOperator, PREVIEW_RENDER_START, PREVIEW_RENDER_END, PREVIEW_RENDER_ERROR, DataSourceEditorViewOptions } from '../types'\nimport { fromStored } from '../model/token'\nimport { DataTree } from '../model/DataTree'\nimport { getDataTreeFromUtils } from '../utils'\n\nfunction getPrivateState(component: Component, stateId: string): StoredState | null {\n  return getState(component, stateId, false)\n}\n\n// Pure function to evaluate a single condition\nfunction evaluateCondition(expression: StoredToken[], component: Component, dataTree: DataTree): unknown | null {\n  try {\n    const tokens = expression.map(token => fromStored(token, dataTree, component.getId?.() || null))\n    return dataTree.getValue(tokens, component, true)\n  } catch (e) {\n    console.warn('Error evaluating condition:', e)\n    return null\n  }\n}\n\n// Pure function to render innerHTML for a component at a specific loop index\nfunction renderInnerHTML(component: Component, dataTree: DataTree, loopIndex?: number): string | null {\n  const innerHTML = getPrivateState(component, Properties.innerHTML)\n  if (innerHTML === null) {\n    return null\n  }\n  try {\n    // Set preview index for loop context\n    if (typeof loopIndex === 'number') {\n      setPreviewIndex(component, loopIndex)\n    }\n    const value = evaluateCondition(innerHTML.expression, component, dataTree)\n    return value !== null && value !== undefined ? String(value) : null\n  } catch (e) {\n    console.warn('Error rendering innerHTML:', e)\n    return null\n  }\n}\n\n// Pure function to set preview index on all tokens in a component\nfunction setPreviewIndex(component: Component, index: number): void {\n  const privateStates = component.get('privateStates') || []\n  privateStates.forEach((state: {id: string, expression: StoredToken[]}) => {\n    if (state.expression && state.expression.length > 0) {\n      state.expression.forEach((token: StoredToken & {previewIndex?: number}) => {\n        if (token.type === 'state' && token.storedStateId === '__data') {\n          token.previewIndex = index\n        } else if (token.type === 'property' || token.type === 'filter') {\n          token.previewIndex = index\n        }\n      })\n    }\n  })\n}\n\nfunction renderLoopData(\n  component: Component,\n  dataTree: DataTree,\n): unknown[] | null {\n  try {\n    const dataState = getPrivateState(component, Properties.__data)!\n    if (dataState === null) {\n      return null\n    }\n    const result = dataTree.getValue(dataState.expression, component, false) // Get full array\n    return Array.isArray(result) ? result : null\n  } catch (e) {\n    console.warn('Error getting loop data:', e)\n    return null\n  }\n}\n\n// Export for tests\nexport function isComponentVisible(\n  component: Component,\n  dataTree: DataTree,\n): boolean {\n  const condition1State = getPrivateState(component, Properties.condition)\n  const condition2State = getPrivateState(component, Properties.condition2)\n  const conditionOperator = component.get('conditionOperator')\n\n  // If no condition is set, component is visible\n  if (!condition1State || !condition1State?.expression || condition1State?.expression.length === 0) {\n    return true\n  }\n\n  let condition1Value: unknown\n  try {\n    condition1Value = dataTree.getValue(condition1State.expression, component, true)\n  } catch (e) {\n    console.warn('Error evaluating condition1:', e)\n    // If condition evaluation fails but no operator is set, default to visible\n    if (conditionOperator === undefined || conditionOperator === null) {\n      return true\n    }\n    // For explicit operators, treat failed evaluation as falsy\n    condition1Value = null\n  }\n\n  // For unary operators, only condition1 is needed\n  switch (conditionOperator) {\n  case UnariOperator.TRUTHY:\n    return !!condition1Value\n  case UnariOperator.FALSY:\n    return !condition1Value\n  case UnariOperator.EMPTY_ARR:\n    return Array.isArray(condition1Value) && condition1Value.length === 0\n  case UnariOperator.NOT_EMPTY_ARR:\n    return Array.isArray(condition1Value) && condition1Value.length > 0\n  case undefined:\n  case null:\n    // If no operator is specified but condition1 exists, default to TRUTHY behavior\n    return !!condition1Value\n  default:\n  }\n\n  // For binary operators, we need condition2\n  if (!condition2State || !condition2State.expression || condition2State.expression.length === 0) {\n    return false\n  }\n\n  let condition2Value: unknown\n  try {\n    condition2Value = dataTree.getValue(condition2State.expression, component, true)\n  } catch (e) {\n    console.warn('Error evaluating condition2:', e)\n    // If condition2 evaluation fails, treat as falsy\n    condition2Value = null\n  }\n\n  // Apply binary operator\n  switch (conditionOperator) {\n  case BinariOperator.EQUAL:\n    return condition1Value == condition2Value\n  case BinariOperator.NOT_EQUAL:\n    return condition1Value !== condition2Value\n  case BinariOperator.GREATER_THAN:\n    return Number(condition1Value) > Number(condition2Value)\n  case BinariOperator.LESS_THAN:\n    return Number(condition1Value) < Number(condition2Value)\n  case BinariOperator.GREATER_THAN_OR_EQUAL:\n    return Number(condition1Value) >= Number(condition2Value)\n  case BinariOperator.LESS_THAN_OR_EQUAL:\n    return Number(condition1Value) <= Number(condition2Value)\n  default:\n    throw new Error(`Unknown operator ${conditionOperator}`)\n  }\n}\n\nfunction renderAttributes(\n  component: Component,\n  dataTree: DataTree,\n): void {\n  const privateStates = component.get('privateStates') || []\n  privateStates.forEach((state: {id: string, expression: StoredToken[], label?: string}) => {\n    // Skip condition states and internal data states - they should not become HTML attributes\n    if (state.id &&\n        state.id !== Properties.innerHTML &&\n        state.id !== Properties.__data &&\n        state.id !== Properties.condition &&\n        state.id !== Properties.condition2 &&\n        state.expression) {\n      try {\n        const value = dataTree.getValue(state.expression, component, true)\n        if (value !== null && value !== undefined) {\n          component.view?.el.setAttribute(state.label || state.id, String(value))\n        }\n      } catch (e) {\n        console.warn(`Error evaluating attribute ${state.id}:`, e)\n      }\n    }\n  })\n}\n\n// // Helper to extend a component instance\n// function extendComponent(comp: Component, onRender: (c: Component) => void) {\n//   // Extend view\n//   if (comp.view) {\n//     const origOnRender = comp.view.onRender?.bind(comp.view)\n//     comp.view.onRender = function (opts: ClbObj) {\n//       if (origOnRender) origOnRender(opts)\n//       onRender(comp)\n//     }\n//   }\n// }\n//\n// /**\n//  * Applies extended model/view logic to all existing components in the editor.\n//  * @param editor The GrapesJS editor instance\n//  */\n// function extendAllComponents(editor: Editor, onRender: (c: Component) => void, parents: Components = editor.getComponents()) {\n//   parents.forEach((comp) => {\n//     extendComponent(comp, onRender)\n//     extendAllComponents(editor, onRender, comp.components())\n//   })\n// }\n//\n\nfunction renderContent(comp: Component, dataTree: DataTree, deep: number) {\n  const innerHtml = renderInnerHTML(comp, dataTree)\n\n  if (innerHtml === null) {\n    comp.view!.render()\n    comp.components()\n      .forEach(c => renderPreview(c, dataTree, deep+1))\n  } else {\n    comp.view!.el.innerHTML = innerHtml!\n  }\n}\n\n// exported for unit tests only\nexport function renderPreview(comp: Component, dataTree: DataTree, deep = 0) {\n  const view = comp.view\n  if (!view) {\n    return\n  }\n  const el = view.el\n  const __data = renderLoopData(comp, dataTree)\n\n  if (__data) {\n    if (__data.length === 0) {\n      el.remove()\n    } else {\n      // Workaround: for some reason loops are rendered revers\n      const loop = [...__data.reverse()]\n      // Render each loop iteration\n      // Render first iteration in the original element\n      setPreviewIndex(comp, 0)\n      if(isComponentVisible(comp, dataTree)) {\n        renderContent(comp, dataTree, deep)\n        renderAttributes(comp, dataTree)\n      } else {\n        el.remove()\n      }\n\n      // For subsequent iterations: clone first, then render into original, then clone again\n      for (let idx = 1; idx < loop.length; idx++) {\n        // Clone the current state (with previous iteration's content)\n        const clone = el.cloneNode(true) as HTMLElement\n        el.insertAdjacentElement('afterend', clone)\n\n        // Set preview index for the next iteration and render into original element\n        setPreviewIndex(comp, idx)\n        if (isComponentVisible(comp, dataTree)) {\n          renderContent(comp, dataTree, deep)\n          renderAttributes(comp, dataTree)\n        } else {\n          // el.setAttribute('data-hidden', '')\n          // el.style.display = 'none'\n          // el.innerHTML = 'xxxx'\n          el.remove()\n        }\n      }\n    }\n  } else {\n    if(isComponentVisible(comp, dataTree)) {\n      renderContent(comp, dataTree, deep)\n      renderAttributes(comp, dataTree)\n    } else {\n      el.remove()\n    }\n  }\n}\n\nexport function doRender(editor: Editor, dataTree: DataTree) {\n  if(!editor.getWrapper()?.view?.el) {\n    return\n  }\n  try {\n    editor.trigger(PREVIEW_RENDER_START)\n    renderPreview(editor.getWrapper()!, dataTree)\n\n    requestAnimationFrame(() => {\n      editor.trigger(PREVIEW_RENDER_END)\n    })\n  } catch (err) {\n    editor.trigger(PREVIEW_RENDER_ERROR, err)\n    console.error('Error during preview render:', err)\n  }\n}\n\nlet renderTimeoutId: NodeJS.Timeout | null = null\nlet debounceDelay = 500\nfunction debouncedRender(editor: Editor, dataTree: DataTree) {\n  if (renderTimeoutId) clearTimeout(renderTimeoutId)\n  renderTimeoutId = setTimeout(() => {\n    doRender(editor, dataTree)\n    renderTimeoutId = null\n  }, debounceDelay)\n}\n\nexport default (editor: Editor, opts: DataSourceEditorViewOptions) => {\n  const dataTree = getDataTreeFromUtils()\n  editor.on(opts.previewRefreshEvents!, () => debouncedRender(editor, dataTree))// : doRender(editor, dataTree))\n  setTimeout(() => {\n    debounceDelay = opts.previewDebounceDelay!\n  }, 1000)\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { DATA_SOURCE_CHANGED, DATA_SOURCE_DATA_LOAD_END, DataSourceEditorOptions, DataSourceEditorViewOptions, Properties } from '../types'\nimport { PROPERTY_STYLES } from './defaultStyles'\n\nimport { PropertiesEditor } from './properties-editor'\nimport { CustomStatesEditor } from './custom-states-editor'\n\nimport settings from './settings'\nimport { Editor } from 'grapesjs'\n\nimport '@silexlabs/expression-input'\nimport './properties-editor'\nimport './custom-states-editor'\nimport canvas from './canvas'\nimport { getElementFromOption } from '../utils'\n\nexport default (editor: Editor, opts: DataSourceEditorOptions) => {\n  const options: DataSourceEditorViewOptions = {\n    styles: PROPERTY_STYLES,\n    defaultFixed: false,\n    disableStates: false,\n    disableAttributes: false,\n    disableProperties: false,\n    previewDebounceDelay: 100,\n    previewRefreshEvents: `\n      ${DATA_SOURCE_CHANGED}\n      ${DATA_SOURCE_DATA_LOAD_END}\n      style:change\n      storage:after:load\n      component\n      component:add\n      component:remove\n    `,\n    ...opts.view,\n  }\n\n  if (opts.view.el) {\n    // create a wrapper for our UI\n    const wrapper = document.createElement('section')\n    wrapper.classList.add('gjs-one-bg', 'ds-wrapper')\n\n    // Add the web components\n    const states = options.disableStates ? '' : `\n      <custom-states-editor\n        class=\"ds-states\"\n        title=\"States\"\n        default-fixed=${options.defaultFixed}\n        create-prompt=\"Create a new state\"\n        rename-prompt=\"Rename the state\"\n        default-name=\"New state\"\n        reserved-names=${Object.keys(Properties).join(',')}\n        hide-loop-data\n        help-text=\"\n          Custom states are used to store data in the component.\\n\n          They are useful to store data that is not displayed in the page, but that is used in the expressions everywhere inside the element.\n        \"\n        help-link=\"https://docs.silex.me/en/user/cms-concepts#states\"\n        >\n        <style>\n          ${options.styles}\n        </style>\n      </custom-states-editor>\n    `\n    const attributes = options.disableAttributes ? '' : `\n      <custom-states-editor\n        class=\"ds-attributes\"\n        private-state\n        title=\"Attributes\"\n        default-fixed=${options.defaultFixed}\n        create-prompt=\"Name of the attribute\"\n        rename-prompt=\"Rename the attribute\"\n        default-name=\"New attribute\"\n        reserved-names=${Object.keys(Properties).join(',')}\n        help-text=\"\n          HTML attributes of the element.\\n\n          For example you can set the 'href' attribute of a link, or the 'src' attribute of an image.\n        \"\n        help-link=\"https://docs.silex.me/en/user/cms-concepts#attributes\"\n        >\n        <style>\n          ${options.styles}\n        </style>\n      </custom-states-editor>\n    `\n    const properties = options.disableProperties ? '' : `\n      <properties-editor\n        class=\"ds-properties\"\n        default-fixed=${options.defaultFixed}\n      >\n        <style>\n          ${options.styles}\n        </style>\n      </properties-editor>\n    `\n    wrapper.innerHTML = `\n      ${states}\n      ${attributes}\n      ${properties}\n    `\n\n    // Build the settings view\n    settings(editor, options)\n\n    // The options el and button can be functions which use editor so they need to be called asynchronously\n    editor.onReady(() => {\n      // Get the container element for the UI\n      const el = getElementFromOption(options.el, 'options.el')\n\n      // Append the wrapper to the container\n      el.appendChild(wrapper)\n\n      // Get references to the web components\n      const propertiesUi = wrapper.querySelector('properties-editor.ds-properties') as PropertiesEditor\n      const statesUi = wrapper.querySelector('custom-states-editor.ds-states') as CustomStatesEditor\n      const attributesUi = wrapper.querySelector('custom-states-editor.ds-attributes') as CustomStatesEditor\n\n      // Init web components\n      propertiesUi?.setEditor(editor)\n      statesUi?.setEditor(editor)\n      attributesUi?.setEditor(editor)\n\n      // Show the UI when the button is clicked\n      if (options.button) {\n        const button = typeof options.button === 'function' ? options.button() : options.button\n        if (!button) throw new Error(`Element ${options.button} not found`)\n        button.on('change', () => {\n          if (button.active) {\n            // Move at the bottom\n            el.appendChild(wrapper)\n            // Show the UI\n            wrapper.style.display = 'block'\n            // Change web components state\n            propertiesUi?.removeAttribute('disabled')\n            statesUi?.removeAttribute('disabled')\n            attributesUi?.removeAttribute('disabled')\n          } else {\n            // Hide the UI\n            wrapper.style.display = 'none'\n            // Change web components state\n            propertiesUi?.setAttribute('disabled', '')\n            statesUi?.setAttribute('disabled', '')\n            attributesUi?.setAttribute('disabled', '')\n          }\n        })\n        wrapper.style.display = button.active ? 'block' : 'none'\n      }\n    })\n  } else {\n    console.warn('Dynamic data UI not enabled, please set the el option to enable it')\n  }\n  canvas(editor, options)\n}\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n * Public API for @silexlabs/grapesjs-data-source\n *\n * This file contains all the functions that calling apps should use.\n * It provides clean, simple APIs that hide internal complexity like DataTree management.\n */\n\nimport { Page, Editor, Component } from 'grapesjs'\nimport { DataSourceId, IDataSource, Expression, StateId, StoredToken, Token, Field, Context, TypeId } from './types'\n\n// Internal imports\nimport { getPageQuery as getPageQueryInternal, buildPageQueries as buildPageQueriesInternal } from './model/queryBuilder'\nimport { getDataTree as getDataTreeInternal, refreshDataSources as refreshDataSourcesInternal } from './model/dataSourceManager'\nimport {\n  getAllDataSources as getAllDataSourcesInternal,\n  getDataSource as getDataSourceInternal,\n  addDataSource as addDataSourceInternal,\n  removeDataSource as removeDataSourceInternal\n} from './model/dataSourceRegistry'\nimport {\n  loadPreviewData as loadPreviewDataInternal,\n  getPreviewData as getPreviewDataInternal,\n  clearPreviewData as clearPreviewDataInternal\n} from './model/previewDataLoader'\nimport {\n  fromStored as fromStoredInternal,\n  getExpressionResultType as getExpressionResultTypeInternal\n} from './model/token'\nimport {\n  getPersistantId as getPersistantIdInternal,\n  getOrCreatePersistantId as getOrCreatePersistantIdInternal,\n  getState as getStateInternal,\n  getStateIds as getStateIdsInternal,\n  setState as setStateInternal,\n  removeState as removeStateInternal,\n  getStateVariableName as getStateVariableNameInternal,\n  COMPONENT_NAME_PREFIX as COMPONENT_NAME_PREFIX_INTERNAL,\n  type PersistantId,\n  type StoredState\n} from './model/state'\nimport { NOTIFICATION_GROUP as NOTIFICATION_GROUP_INTERNAL, FIXED_TOKEN_ID as FIXED_TOKEN_ID_INTERNAL, toExpression as toExpressionInternal, createDataSource as createDataSourceInternal } from './utils'\nimport { COMMAND_REFRESH, DATA_SOURCE_CHANGED, DATA_SOURCE_ERROR } from './types'\nimport { GraphQLOptions } from './datasources/GraphQL'\nimport { getCompletion as getCompletionInternal } from './model/completion'\nimport getLiquidFiltersInternal from './filters/liquid'\n\n// ===============================\n// QUERY GENERATION\n// ===============================\n\n/**\n * Generate GraphQL query for a single page\n * Used by both preview and production (11ty site generation)\n *\n * @param page - The GrapesJS page to generate query for\n * @param editor - The GrapesJS editor instance\n * @returns Record of data source ID to GraphQL query string\n */\nexport function getPageQuery(page: Page, editor: Editor): Record<DataSourceId, string> {\n  const dataTree = getDataTreeInternal()\n  return getPageQueryInternal(page, editor, dataTree)\n}\n\n/**\n * Generate queries for multiple pages\n * Useful for batch operations like static site generation\n *\n * @param pages - Array of GrapesJS pages\n * @param editor - The GrapesJS editor instance\n * @returns Record of page ID to data source queries\n */\nexport function buildPageQueries(pages: Page[], editor: Editor): Record<string, Record<DataSourceId, string>> {\n  const dataTree = getDataTreeInternal()\n  return buildPageQueriesInternal(pages, editor, dataTree)\n}\n\n// ===============================\n// DATA SOURCE MANAGEMENT\n// ===============================\n\n/**\n * Get all data sources\n * @returns Array of all registered data sources\n */\nexport function getAllDataSources(): IDataSource[] {\n  return getAllDataSourcesInternal()\n}\n\n/**\n * Get a specific data source by ID\n * @param id - The data source ID\n * @returns The data source or undefined if not found\n */\nexport function getDataSource(id: DataSourceId): IDataSource | undefined {\n  return getDataSourceInternal(id)\n}\n\n/**\n * Add a new data source\n * @param dataSource - The data source to add\n */\nexport function addDataSource(dataSource: IDataSource): void {\n  return addDataSourceInternal(dataSource)\n}\n\n/**\n * Remove a data source\n * @param dataSource - The data source to remove\n */\nexport function removeDataSource(dataSource: IDataSource): void {\n  return removeDataSourceInternal(dataSource)\n}\n\n/**\n * Refresh preview data from all data sources\n * Triggers data loading for the current page\n */\nexport function refreshDataSources(): void {\n  return refreshDataSourcesInternal()\n}\n\n// ===============================\n// PREVIEW DATA MANAGEMENT\n// ===============================\n\n/**\n * Load preview data for the current page\n * @param forceRefresh - If true, bypass query comparison and force refresh\n * @returns Promise that resolves when data is loaded\n */\nexport function loadPreviewData(forceRefresh: boolean = false): Promise<void> {\n  return loadPreviewDataInternal(forceRefresh)\n}\n\n/**\n * Get current preview data\n * @returns Record of data source ID to preview data\n */\nexport function getPreviewData(): Record<DataSourceId, unknown> {\n  return getPreviewDataInternal()\n}\n\n/**\n * Clear all preview data\n */\nexport function clearPreviewData(): void {\n  return clearPreviewDataInternal()\n}\n\n// ===============================\n// DATA TREE OPERATIONS\n// ===============================\n\n\n/**\n * Evaluate an expression with current preview data\n * @param expression - The expression to evaluate\n * @param component - The component context\n * @returns The evaluated result\n */\nexport function getValue(expression: Expression, component: Component, resolvePreviewIndex = true): unknown {\n  const dataTree = getDataTreeInternal()\n  return dataTree.getValue(expression, component, resolvePreviewIndex)\n}\n\n/**\n * Get all expressions used by components on a page\n * @param page - The page to analyze\n * @returns Array of component expressions\n */\nexport function getPageExpressions(page: Page) {\n  const dataTree = getDataTreeInternal()\n  return dataTree.getPageExpressions(page)\n}\n\n/**\n * Get auto-completion options for expressions\n * @param options - Completion options including component, expression, etc.\n * @returns Context with available tokens for completion\n */\nexport function getCompletion(options: { component: Component, expression: Expression, rootType?: TypeId, currentStateId?: StateId, hideLoopData?: boolean}): Context {\n  const dataTree = getDataTreeInternal()\n  return getCompletionInternal({\n    ...options,\n    dataTree\n  })\n}\n\n/**\n * Convert a stored token to its full form with methods and properties\n * @param token - The stored token to convert\n * @param componentId - The component ID for context (can be null)\n * @returns The full token with all properties and methods\n */\nexport function fromStored<T extends Token = Token>(token: StoredToken, componentId: string | null): T {\n  const dataTree = getDataTreeInternal()\n  return fromStoredInternal(token, dataTree, componentId)\n}\n\n/**\n * Get the result type of an expression\n * @param expression - The expression to analyze\n * @param component - The component context\n * @returns The field describing the result type, or null if invalid\n */\nexport function getExpressionResultType(expression: Expression, component: Component): Field | null {\n  const dataTree = getDataTreeInternal()\n  return getExpressionResultTypeInternal(expression, component, dataTree)\n}\n\n// ===============================\n// STATE MANAGEMENT\n// ===============================\n\n/**\n * Get the persistent ID of a component\n * @param component - The component to get ID for\n * @returns The persistent ID or null if not set\n */\nexport function getPersistantId(component: Component): PersistantId | null {\n  return getPersistantIdInternal(component)\n}\n\n/**\n * Get or create the persistent ID of a component\n * @param component - The component to get/create ID for\n * @returns The persistent ID\n */\nexport function getOrCreatePersistantId(component: Component): PersistantId {\n  return getOrCreatePersistantIdInternal(component)\n}\n\n/**\n * Get a state from a component\n * @param component - The component to get state from\n * @param id - The state ID\n * @param exported - Whether to get exported (public) or private state\n * @returns The state or null if not found\n */\nexport function getState(component: Component, id: StateId, exported: boolean = true): StoredState | null {\n  return getStateInternal(component, id, exported)\n}\n\n/**\n * Get all state IDs from a component\n * @param component - The component to get state IDs from\n * @param exported - Whether to get exported (public) or private state IDs\n * @param before - Optional state ID to get IDs before\n * @returns Array of state IDs\n */\nexport function getStateIds(component: Component, exported: boolean = true, before?: StateId): StateId[] {\n  return getStateIdsInternal(component, exported, before)\n}\n\n/**\n * Set a state on a component\n * @param component - The component to set state on\n * @param id - The state ID\n * @param state - The state to set\n * @param exported - Whether to set as exported (public) or private state\n * @param index - Optional index to insert at\n */\nexport function setState(component: Component, id: StateId, state: StoredState, exported: boolean = true, index: number = -1): void {\n  return setStateInternal(component, id, state, exported, index)\n}\n\n/**\n * Remove a state from a component\n * @param component - The component to remove state from\n * @param id - The state ID to remove\n * @param exported - Whether to remove from exported (public) or private states\n */\nexport function removeState(component: Component, id: StateId, exported: boolean = true): void {\n  return removeStateInternal(component, id, exported)\n}\n\n/**\n * Get the variable name for a state\n * @param componentId - The component ID\n * @param stateId - The state ID\n * @returns The variable name\n */\nexport function getStateVariableName(componentId: string, stateId: StateId): string {\n  return getStateVariableNameInternal(componentId, stateId)\n}\n\n// ===============================\n// TOKEN AND EXPRESSION UTILITIES\n// ===============================\n\n/**\n * Convert JSON or string to an Expression object\n * @param json - The JSON or string to convert\n * @returns The Expression object or null if invalid\n */\nexport function toExpression(json: unknown | string): Expression | null {\n  return toExpressionInternal(json)\n}\n\n// ===============================\n// UTILITY FUNCTIONS\n// ===============================\n\n/**\n * Create a data source instance\n * @param options - The data source configuration\n * @returns The created data source\n */\nexport function createDataSource(opts: Partial<GraphQLOptions> = {}): IDataSource {\n  return createDataSourceInternal(opts)\n}\n\nexport function getLiquidFilters(editor: Editor) {\n  return getLiquidFiltersInternal(editor)\n}\n\n// ===============================\n// CONSTANTS\n// ===============================\n\n/**\n * Notification group name for data source notifications\n */\nexport const NOTIFICATION_GROUP = NOTIFICATION_GROUP_INTERNAL\n\n/**\n * Component name prefix for data source components\n */\nexport const COMPONENT_NAME_PREFIX = COMPONENT_NAME_PREFIX_INTERNAL\n\n/**\n * Command name for refreshing data sources\n */\nexport { COMMAND_REFRESH }\n\n/**\n * Event name for data source changes\n */\nexport { DATA_SOURCE_CHANGED }\n\n/**\n * Event name for data source errors\n */\nexport { DATA_SOURCE_ERROR }\n\n/**\n * Fixed token ID for hard-coded values\n */\nexport const FIXED_TOKEN_ID = FIXED_TOKEN_ID_INTERNAL\n","/*\n * Silex website builder, free/libre no-code tool for makers.\n * Copyright (c) 2023 lexoyo and Silex Labs foundation\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport commands from './commands'\nimport { initializeDataSourceManager, refreshDataSources } from './model/dataSourceManager'\nimport storage from './storage'\nimport { DATA_SOURCE_ERROR, DataSourceEditorOptions, IDataSource, IDataSourceOptions } from './types'\nimport { createDataSource, NOTIFICATION_GROUP } from './utils'\nimport view from './view'\nimport { Editor } from 'grapesjs'\n\n/**\n * Export the public API\n */\n// Main public API - this is what apps should use\nexport * from './api'\n\n// Types and interfaces that apps need\nexport * from './types'\n\n/**\n * GrapeJs plugin entry point\n */\nexport default (editor: Editor, opts: Partial<DataSourceEditorOptions> = {}) => {\n  const options: DataSourceEditorOptions = {\n    dataSources: [],\n    filters: [],\n    previewActive: true, // Default to preview active\n    ...opts,\n    view: {\n      el: '.gjs-pn-panel.gjs-pn-views-container',\n      ...opts?.view,\n    },\n  }\n\n  const dataSources = options.dataSources\n    // Make sure the data sources from the config are readonly\n    .map(ds => ({ ...ds, readonly: true }))\n    // Create the data sources from config\n    .map((ds: IDataSourceOptions) => createDataSource(ds))\n\n  // Connect the data sources (async)\n  Promise.all(dataSources\n    .map(ds => ds.connect()))\n    // .then(() => console.info('Data sources connected'))\n    .catch(err => console.error('Error while connecting data sources', err))\n\n  // Initialize the global data source manager\n  initializeDataSourceManager(dataSources, editor, options)\n\n  // Register the UI for component properties\n  view(editor, options)\n\n  // Save and load data sources\n  storage(editor)\n\n  // Register the commands\n  commands(editor, options)\n\n  // Use grapesjs-notifications plugin for errors\n  editor.on(DATA_SOURCE_ERROR, (msg: string, ds: IDataSource) => editor.runCommand('notifications:add', { type: 'error', message: `Data source \\`${ds.id}\\` error: ${msg}`, group: NOTIFICATION_GROUP }))\n\n  // Load data after editor is fully loaded\n  editor.on('load', () => {\n    refreshDataSources()\n  })\n\n  // Also refresh data when storage loads (to handle website data loading)\n  editor.on('storage:end:load', () => {\n    // Use setTimeout to ensure components are fully loaded\n    setTimeout(() => {\n      refreshDataSources()\n    }, 100)\n  })\n}\n\n/**\n * Version of the plugin\n * This is replaced by the build script\n */\nexport const version = '__VERSION__'\n"],"names":["root","factory","exports","module","define","amd","globalThis","window","this","templateStrings","values","_i","arguments","length","matches","strings","slice","replace","i","match","push","apply","size","Math","min","map","value","pattern","RegExp","string","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","DATA_SOURCE_READY","DATA_SOURCE_ERROR","DATA_SOURCE_CHANGED","COMPONENT_STATE_CHANGED","DATA_SOURCE_DATA_LOAD_START","DATA_SOURCE_DATA_LOAD_END","DATA_SOURCE_DATA_LOAD_CANCEL","PREVIEW_RENDER_START","PREVIEW_RENDER_END","PREVIEW_RENDER_ERROR","COMMAND_REFRESH","COMMAND_PREVIEW_ACTIVATE","COMMAND_PREVIEW_DEACTIVATE","COMMAND_PREVIEW_REFRESH","builtinTypeIds","builtinTypes","id","label","fields","UnariOperator","BinariOperator","Properties","EXPORTED_STATES_KEY","PRIVATE_STATES_KEY","PERSISTANT_ID_KEY","COMPONENT_NAME_PREFIX","getPersistantId","component","getOrCreatePersistantId","persistantId","newPersistantId","ccid","round","random","set","getParentByPersistentId","parent","_callbacks","fireChange","state","forEach","callback","getStateIds","exported","before","allStates","sort","hidden","index","indexOf","e","console","error","getStates","expression","getState","find","setState","states","existing","s","splice","removeState","newStates","filter","ShadowRoot","ShadyCSS","nativeShadow","Document","CSSStyleSheet","WeakMap","constructor","t","_$cssResult$","Error","cssText","styleSheet","replaceSync","toString","reduce","c","cssRules","is","getOwnPropertyDescriptor","h","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","trustedTypes","l","emptyScript","p","reactiveElementPolyfillSupport","u","toAttribute","Boolean","Array","JSON","stringify","fromAttribute","Number","parse","f","b","attribute","type","String","converter","reflect","useDefault","hasChanged","metadata","litPropertyMetadata","y","HTMLElement","addInitializer","_$Ei","observedAttributes","finalize","_$Eh","keys","createProperty","create","wrapped","elementProperties","noAccessor","getPropertyDescriptor","requestUpdate","configurable","getPropertyOptions","Map","finalized","properties","_$Eu","elementStyles","finalizeStyles","styles","isArray","Set","flat","reverse","unshift","toLowerCase","super","_$Ep","isUpdatePending","hasUpdated","_$Em","_$Ev","_$ES","Promise","enableUpdating","_$AL","_$E_","addController","_$EO","add","renderRoot","isConnected","hostConnected","removeController","delete","createRenderRoot","shadowRoot","attachShadow","shadowRootOptions","adoptedStyleSheets","document","createElement","litNonce","setAttribute","textContent","appendChild","connectedCallback","disconnectedCallback","hostDisconnected","attributeChangedCallback","_$AK","_$ET","removeAttribute","_$Ej","hasAttribute","C","_$EP","has","_$Eq","reject","scheduleUpdate","performUpdate","shouldUpdate","willUpdate","hostUpdate","update","_$EM","_$AE","hostUpdated","firstUpdated","updated","updateComplete","getUpdateComplete","mode","ReactiveElement","reactiveElementVersions","createPolicy","createHTML","toFixed","createComment","iterator","v","_","m","g","$","_$litType$","x","T","for","E","A","createTreeWalker","P","V","lastIndex","exec","test","startsWith","N","parts","el","currentNode","content","firstChild","replaceWith","childNodes","nextNode","nodeType","hasAttributes","getAttributeNames","endsWith","getAttribute","split","name","ctor","H","I","L","k","tagName","append","data","innerHTML","_$Co","_$Cl","_$litDirective$","_$AO","_$AT","_$AS","M","_$AV","_$AN","_$AD","_$AM","parentNode","_$AU","creationScope","importNode","R","nextSibling","z","_$AI","_$Cv","_$AH","_$AA","_$AB","options","startNode","endNode","_$AR","O","insertBefore","createTextNode","_$AC","_$AP","remove","setConnected","element","fill","j","toggleAttribute","capture","once","passive","removeEventListener","addEventListener","handleEvent","host","Z","D","U","B","F","litHtmlPolyfillSupport","litHtmlVersions","renderBefore","_$litPart$","renderOptions","_$Do","render","_$litElement$","litElementHydrateSupport","LitElement","litElementPolyfillSupport","fromStored","token","dataTree","componentId","optionsForm","original","filters","field","propertyToField","fieldId","getTokenOptions","tokenToField","prev","getFilterFromToken","validate","output","warn","getId","storedStateId","exposed","getExpressionResultType","kind","forceKind","property","typeNames","typeIds","typeId","getType","dataSourceId","args","entries","defaultValue","join","previewIndex","arr","arg","selected","input","getOptionObject","option1","option2","result","isEmpty","keys1","keys2","isString","isJsonString","str","isJson","json","litElementVersions","GraphQL","method","headers","types","queryables","queryType","ready","eventListeners","url","queryable","readonly","on","event","off","cb","trigger","triggerError","message","loadData","__schema","allTypes","concat","query","nonQueryables","graphQLToType","queryableTypes","getOfTypeProp","ofKindToKind","queryableFields","graphQLToField","graphQLToTypes","graphQLToKind","getOfTypePropRecursive","ofType","ofTypeResult","possibleTypes","validKind","includes","ofKind","foundKind","queryableOverride","connect","getTypes","getQueryables","response","fetch","body","ok","status","statusText","getQuery","children","getQueryRecursive","tree","indent","fragment","typeOrFragment","buildArgs","FIXED_TOKEN_ID","fieldTypes","child","fieldType","fragmentsQuery","childQuery","fetchValues","globalRegistry","getRegistry","getAllDataSources","dataSources","addDataSource","dataSource","registry","editor","removeDataSource","getDataSource","ds","setDataSources","NOTIFICATION_GROUP","getDataTreeFromUtils","getComponentDebug","parentName","getName","parentTagName","parentDebug","cid","classes","getClasses","classesStr","getTokenDisplayName","typeIdsStr","getTypeDisplayName","prefix","getStateDisplayName","groupByType","completion","acc","runCommand","group","getFixedToken","propType","toValue","toId","fromString","toExpression","every","isExpression","convertKind","from","to","getElementFromOption","option","optionNameForError","querySelector","getDefaultOptions","postFix","createDataSource","opts","STANDARD_TYPES","DataTree","_allTypes","_queryables","previewData","getAllTypes","getAllQueryables","standardType","flatMap","getValue","resolvePreviewIndex","prevValues","rest","resolvedExpression","resolveState","isItems","prevObj","handlePreviewIndex","valueType","isNull","getAllPagesExpressions","Pages","getAll","page","expressions","getPageExpressions","getComponentExpressionsRecursive","getMainComponent","queries","getComponentExpressions","components","publicStates","privateStates","getTrees","next","trees","isRelative","exp","resolved","parentFieldsTypes","some","toTrees","grouped","mergeTrees","tree1","tree2","errors","child1","child2","different","same","storedState","isNumber","scalarOnly","stateName","item","quotedOptions","optionsKeys","separator","getFieldType","start","end","num","abs","ceil","floor","max","isDate","date","Date","toLocaleDateString","format","timeZone","search","lastIndexOf","toUpperCase","charAt","count","parseInt","log","getPageQuery","dsExpressions","componentExpression","first","globalLoader","getLoader","forceRefresh","loader","getSelected","currentQueries","queriesChanged","queries1","queries2","areQueriesEqual","lastQueries","currentUpdatePid","myPid","results","all","err","fetchPagePreviewData","globalManager","initializeDataSourceManager","initializeFilters","initializeDataSourceRegistry","initializePreviewDataLoader","dataChangedBinded","detail","dataSourceReadyBinded","dataSourceErrorBinded","setupEventListeners","then","getManager","refreshDataSources","getDataTree","manager","isPreviewActive","forceRender","refresh","newDataSources","resetDataSources","PROPERTY_STYLES","_$AQ","_$Ct","_$Ci","reconnected","disconnected","setValue","G","rt","lt","ct","ht","dt","ut","w","customElements","init","COMMON_STYLES","renderSettings","dsSettings","settingsEl","SettingsDataSources","dsDataSource","dispatchEvent","CustomEvent","preventDefault","stopImmediatePropagation","SettingsDataSource","errorMessage","connected","connectDataSource","catch","dsHeaders","target","SettingsHeaders","encodeURI","st","nt","classList","inputChainStyles","popinStyles","__decorate","decorators","desc","Reflect","decorate","InputChain","selectTagName","_selectTagName","newTagName","SELECT_QUERY","OPTION_QUERY","_optionTagName","optionTagName","reactive","_form","onChange_","onChangeValue","bind","onFormdata","formData","redrawing","form","newForm","querySelectorAll","closest","changeAt","stopPropagation","idx","reset","nextIndex","Event","ExpressionInput","allowFixed","_fixed","placeholder","dirty","_a","fixed","getFixedInput","active","PopinOverlay","noAutoClose","resized_","ensureElementInView","blured_","blured","keydown_","keydown","setTimeout","getActiveElementRecursive","activeElement","popin","close","blur","_old","focus","parentStyle","parentElement","getBoundingClientRect","style","left","top","offsetX","offsetY","rect","viewportWidth","innerWidth","viewportHeight","innerHeight","width","height","PopinForm","FormData","onFormdata_","slotChanged_","slotChanged","inputs","updateFormData","fromEntries","submit","change","ft","removeProperty","setProperty","fieldToToken","getCompletion","rootType","currentStateId","hideLoopData","loopProperties","stateId","loopDataState","loopDataField","displayName","fixedValue","getContext","fieldOfField","PREVIEW_INDEX_CHANGED","StateEditor","disabled","showPreviewIndexUi","noFilters","defaultFixed","dismissCurrentComponentStates","_selected","renderBinded","_data","_editor","expressionInputRef","popinsRef","newValue","_currentValue","groupedCompletion","text","currentData","currentDataArrayLength","_c","rangeInputRef","numberInputRef","getOptions","partialExpression","_partialCompletion","partialCompletion","partialGroupedCompletion","partialToken","localeCompare","partialId","display","onChangeOptions","onChangePreview","attributes","bubbles","tokens","PropertiesEditor","condition","condition2","__data","setEditor","head","empty","resetInputs","publicState","renderStateEditor","operator","visible","stateEditor","stateEditorFinally","getTokens","onChange","CustomStatesEditor","privateState","title","createPrompt","renamePrompt","defaultName","helpText","helpLink","_reservedNames","reservedNames","trim","getHead","createCustomState","items","getStateEditor","newItem","renameCustomState","updateOrderCustomStates","prompt","alert","getPrivateState","renderInnerHTML","loopIndex","setPreviewIndex","evaluateCondition","isComponentVisible","condition1State","condition2State","conditionOperator","condition1Value","condition2Value","TRUTHY","FALSY","EMPTY_ARR","NOT_EMPTY_ARR","EQUAL","NOT_EQUAL","GREATER_THAN","LESS_THAN","GREATER_THAN_OR_EQUAL","LESS_THAN_OR_EQUAL","renderAttributes","view","renderContent","comp","deep","innerHtml","renderPreview","dataState","renderLoopData","loop","clone","cloneNode","insertAdjacentElement","renderTimeoutId","debounceDelay","debouncedRender","clearTimeout","getWrapper","requestAnimationFrame","doRender","disableStates","disableAttributes","disableProperties","previewDebounceDelay","previewRefreshEvents","wrapper","settings","onReady","propertiesUi","statesUi","attributesUi","button","canvas","pages","buildPageQueries","getStateVariableName","getLiquidFilters","previewActive","storage","Commands","run","commands","msg","version"],"sourceRoot":""}